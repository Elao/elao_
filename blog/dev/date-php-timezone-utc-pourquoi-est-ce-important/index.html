<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Dates PHP et Timezone UTC, pourquoi est-ce important ?</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/favicon-16x16.png">
        <link rel="manifest" href="/elao_/site.webmanifest">
        <link rel="mask-icon" href="/elao_/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Mise au point sur les problématiques de timezone avec les dates PHP." />
            <link rel="canonical" href="https://elao.github.io/elao_/blog/dev/date-php-timezone-utc-pourquoi-est-ce-important" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Dates PHP et Timezone UTC, pourquoi est-ce important ?" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Mise au point sur les problématiques de timezone avec les dates PHP." />
            <meta property="og:url" content="https://elao.github.io/elao_/blog/dev/date-php-timezone-utc-pourquoi-est-ce-important" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/resized/content/images/blog/thumbnails/time.jpg/9f6692dedb7fd58ab59532e8b8ea49a1.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Dates PHP et Timezone UTC, pourquoi est-ce important ?">
            <meta property="twitter:description" content="Mise au point sur les problématiques de timezone avec les dates PHP.">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/resized/content/images/blog/thumbnails/time.jpg/87879bffe17b0a4a441cbda10dd3e784.jpg">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Dates PHP et Timezone UTC, pourquoi est-ce important ?",
    "image": [
        "https://elao.github.io/elao_/blog/dev/content/images/blog/thumbnails/time.jpg"
    ],
    "datePublished": "2017-11-21T00:00:00+00:00",
    "dateModified": "2017-11-21T00:00:00+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Maxime Colin",
            "url": "https://elao.github.io/elao_/equipe/mcolin"
        }
    ],
    "keywords": [
        "Symfony",
        "Php",
        "Datetime",
        "Timezone"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/build/app.12859ae1.css">
        
                        <script src="/elao_/build/runtime.c3b9d4eb.js" defer></script><script src="/elao_/build/552.3082ae9c.js" defer></script><script src="/elao_/build/769.7dfbbe52.js" defer></script><script src="/elao_/build/app.d906f729.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;build&#x5C;&#x2F;see.ace7bf9f.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/">
                        <span class="screen-reader">Dates PHP et Timezone UTC, pourquoi est-ce important ?</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Dates PHP et Timezone UTC, pourquoi est-ce important ?</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/resized/content/images/blog/headers/time.jpg/ed245ba796b5810e0b2a476f86fa5334.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/resized/content/images/blog/headers/time.jpg/ed245ba796b5810e0b2a476f86fa5334.jpg') 1x,
        url('/elao_/resized/content/images/blog/headers/time.jpg/1b77eb78a0d2d493a9bbb9e781da07f9.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/resized/content/images/blog/headers/time.jpg/ed245ba796b5810e0b2a476f86fa5334.jpg') 1x,
        url('/elao_/resized/content/images/blog/headers/time.jpg/1b77eb78a0d2d493a9bbb9e781da07f9.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/resized/content/images/blog/headers/time.jpg/ed245ba796b5810e0b2a476f86fa5334.jpg') 1x,
        url('/elao_/resized/content/images/blog/headers/time.jpg/1b77eb78a0d2d493a9bbb9e781da07f9.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/resized/content/images/blog/headers/time.jpg/ed245ba796b5810e0b2a476f86fa5334.jpg') 1x,
        url('/elao_/resized/content/images/blog/headers/time.jpg/1b77eb78a0d2d493a9bbb9e781da07f9.jpg') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a href="/elao_/blog/auteur/mcolin">
                                    <img     src="/elao_/resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg"
    srcset="
        /elao_/resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg 1x,
        /elao_/resized/content/images/members/avatars/mcolin.jpg/0899bdf7169af336de983de73d88fa58.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/blog/auteur/mcolin">
                                    <strong>Maxime Colin</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>21 novembre 2017</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Dates PHP et Timezone UTC, pourquoi est-ce important ?</h1>
                <p>Mise au point sur les problématiques de timezone avec les dates PHP.</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/blog/tag/symfony" rel="nofollow">#Symfony</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/blog/tag/php" rel="nofollow">#Php</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/blog/tag/datetime" rel="nofollow">#Datetime</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/blog/tag/timezone" rel="nofollow">#Timezone</a>
                        </li>
                                    </ul>
            </div>
        </div>

                    <ol class="table-of-content" data-aos="fade-up">
                                    <li class="table-of-content__item">
                        <a href="#la-timezone-c-est-quoi">La timezone c&#039;est quoi ?</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#php">PHP</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#les-problemes">Les problèmes</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#la-solution">La solution</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#symfony">Symfony</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#api">API</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#conclusion">Conclusion</a>

                                            </li>
                            </ol>
        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <h2 id="la-timezone-c-est-quoi" class="anchor-title"><a href="#la-timezone-c-est-quoi">La timezone c'est quoi ?</a></h2>
<p>La timezone est une information associée à une date permettant de connaître son fuseau horaire. Cette timezone est décrite par un nom de continent et un nom de ville.</p>
<pre class="code-multiline"><code id="cd7bcb0bba25653f938f9232717351a3">Europe/Paris
Europe/London
America/New_York
Australia/Sydney</code></pre>
<h3 id="dst-rules-daylight-saving-time" class="anchor-title"><em>Daylight Saving Time</em>)<a href="#dst-rules-daylight-saving-time">DST Rules (</a></h3>
<p>La timezone permet également de savoir si on doit appliquer l'heure d'été ou d'hiver. En effet, il peut exister plusieurs timezones correspondant au même fuseau horaire car elles n'appliquent pas l'heure d'été ou d'hiver aux mêmes dates, voir l'une d'elle ne la pratique pas du tout.</p>
<h2 id="php" class="anchor-title"><a href="#php">PHP</a></h2>
<p>Si vous avez déjà travaillé avec des dates en PHP, vous avez surement été confronté à des problèmes de timezone. La plupart du temps, vous avez résolu le problème en remplaçant la timezone par defaut par la vôtre.</p>
<pre class="code-multiline language-ini"><code class="language-ini" id="d06a3a8ea469f18ab96eea52d7040016"><span class="token key attr-name">date.timezone</span> <span class="token punctuation">=</span> <span class="token value attr-value">Europe/Paris</span></code></pre>
<p>Si cette solution règle votre souci immédiatement, nous allons voir que sur le long terme, ce n'est pas forcement une bonne idée.</p>
<h2 id="les-problemes" class="anchor-title"><a href="#les-problemes">Les problèmes</a></h2>
<p>Si vous persistez vos dates dans une base de données, sachez que la plupart des SGBD ne stockent pas la timezone sur les champs de type <code class="code-inline" id="dfeaaeb4316477bd556ea5e8c3295887">datetime</code> ou <code class="code-inline" id="d7e6d55ba379a13d08c25d15faf2a23b">timestamp</code>. Vous perdez donc cette information.</p>
<p>Dans le cas où vos utilisateurs peuvent provenir de plusieurs pays, vous allez être confronté à des incohérences de date. Les heures entrées par un utilisateur dans sa timezone n'auront pas la même signification pour un autre utilisateur ou pour votre système.</p>
<p>Ainsi il sera impossible de faire des comparaisons de dates sans erreur.</p>
<h3 id="franco-francais" class="anchor-title"><a href="#franco-francais">Franco-français</a></h3>
<blockquote>
<p>Mon application est en français, il n'y aura pas d'autre timezone, autant rester en Europe/Paris.</p>
</blockquote>
<p>Le français est parlé dans plus de 50 pays à travers plusieurs continents (dont une trentaine de pays ayant le français comme langue officielle). Le territoire français compte également plusieurs régions d'Outre-mer dans différentes <strong>timezones</strong>.</p>
<p>J'ajouterais que le web est mondial et à l'heure du microservice, du SAAS et du cloud, vous pourrez être amené à interconnecter votre application avec des services internationnaux.</p>
<h2 id="la-solution" class="anchor-title"><a href="#la-solution">La solution</a></h2>
<p>Pour éviter toute sorte de confusion, la norme est de stocker et de ne travailler qu'avec la <strong>timezone UTC</strong> (Temps universel coordonné). Votre serveur et PHP sont configurés en UTC et votre base de données stocke des dates UTC.</p>
<p>Ensuite, il faut permettre à l'utilisateur de saisir des dates dans sa timezone, puis les convertir en UTC une fois envoyées au serveur. De même, à l'affichage, il faut convertir les dates UTC dans la timezone de l'utilisateur.</p>
<p>Il faut donc soit détecter la timezone de votre utilisateur soit la lui demander et la stocker.</p>
<h3 id="toujours-stocker-l-heure" class="anchor-title"><a href="#toujours-stocker-l-heure">Toujours stocker l'heure</a></h3>
<p>Il est important également de toujours adjoindre une heure à vos dates, même si seulement la date vous intéresse. Car à la différence de <code class="code-inline" id="81c3b080dad537de7e10e0987a4bf52e">mysql</code> par exemple qui gère des champs de type <code class="code-inline" id="5fc732311905cb27e82d67f4f6511f7f">date</code> ou <code class="code-inline" id="dfeaaeb4316477bd556ea5e8c3295887">datetime</code>, PHP ne dispose que d'une classe <code class="code-inline" id="8cf10d2341ed01492506085688270c1e">DateTime</code> (ou <code class="code-inline" id="6ffacd918e2f70478d2fd33dcb58c4d4">DateTimeImmutable</code>). Si vous créez un objet <code class="code-inline" id="8cf10d2341ed01492506085688270c1e">DateTime</code> avec seulement une date, PHP utilisera l'heure courante et cela peut être problématique lors du changement de timezone.</p>
<p>Par exemple, imaginons une table avec un champ date  (sans heure donc)</p>
<pre class="code-multiline language-php"><code class="language-php" id="e2b83ea2299a80bebe9d15edb92d3ff6"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token comment">// Il est 10h31, Saisie de la date dans la timezone utilisateur</span>
<span class="token variable">$date</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'2017-10-17'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeZone</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Europe/Paris'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Conversion en UTC</span>
<span class="token variable">$date</span><span class="token operator">-&gt;</span><span class="token function">setTimezone</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeZone</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2017-10-17 10:31 =&gt; 2017-10-17 09:31</span>
<span class="token comment">// enregistrement de 2017-10-17 dans la base de données</span>

<span class="token comment">// Il est 00h17, Saisie de la date dans la timezone utilisateur</span>
<span class="token variable">$date</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'2017-10-17'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeZone</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Europe/Paris'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Conversion en UTC</span>
<span class="token variable">$date</span><span class="token operator">-&gt;</span><span class="token function">setTimezone</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeZone</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2017-10-17 00:17 =&gt; 2017-10-16 23:17</span>
<span class="token comment">// enregistrement de 2017-10-16 dans la base de données</span></span></code></pre>
<p>Dans l'exemple ci-dessus, si en base de données vous ne stockez que la date, vous perdrez l'information vous permettant d'appliquer correctement votre timezone et vous risquez d'avoir des décalages de jour en fonction de l'heure à laquelle votre code est exécuté. Sans heure, il est impossible de changer correctement de timezone.</p>
<h2 id="symfony" class="anchor-title"><a href="#symfony">Symfony</a></h2>
<h3 id="la-saisie" class="anchor-title"><a href="#la-saisie">La saisie</a></h3>
<p>Pour la saisie de date dans vos formulaires, si vous utilisez les formulaires de date natifs de Symfony comme le  <a href="https://symfony.com/doc/current/reference/forms/types/datetime.html" target="_blank">DateTimeType</a>, penchez-vous sur les options <a href="https://symfony.com/doc/current/reference/forms/types/datetime.html#model-timezone" target="_blank"><code class="code-inline" id="f3a978ebd00d2ca47db6ef4f31de9dc4">model_timezone</code></a> et <a href="https://symfony.com/doc/current/reference/forms/types/datetime.html#view-timezone" target="_blank"><code class="code-inline" id="2f4e515f049becdaabb90473387444d6">view_timezone</code></a>.</p>
<p>L'option <code class="code-inline" id="f3a978ebd00d2ca47db6ef4f31de9dc4">model_timezone</code> vous permet de préciser la timezone dans laquelle les dates seront stockées. Normalement pas besoin d'y toucher, sa valeur par defaut correspond à la timezone de PHP.</p>
<p>L'option <code class="code-inline" id="2f4e515f049becdaabb90473387444d6">view_timezone</code> vous permet de préciser la timezone dans laquelle l'utilisateur saisit les dates. Il faut donc la renseigner avec la timezone souhaitée, celle de l'utilisateur que vous stockez sur son profil par exemple.</p>
<pre class="code-multiline language-php"><code class="language-php" id="b595b6b37f8112d7c5bf18544dbb7dab"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">buildForm</span><span class="token punctuation">(</span><span class="token class-name type-declaration">FormBuilderInterface</span> <span class="token variable">$builder</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token variable">$builder</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'datetime'</span><span class="token punctuation">,</span> <span class="token scope">DateTimeType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'view_timezone'</span> <span class="token operator">=&gt;</span> <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">getTimezone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="l-affichage" class="anchor-title"><a href="#l-affichage">L'affichage</a></h3>
<p>Pour l'affichage, vous pouvez configurer la timezone par defaut de Twig. Ainsi toutes les dates passant par le filtre <code class="code-inline" id="2fbafa8f2ac2399e4ce66af7c7d2e7f2">|date</code> seront automatiquement converties dans cette timezone.</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="0ec57349991c9635ac326a164f6adb8c"><span class="token comment"># config.yml</span>
<span class="token key atrule">twig</span><span class="token punctuation">:</span>
    <span class="token key atrule">date</span><span class="token punctuation">:</span>
        <span class="token key atrule">timezone</span><span class="token punctuation">:</span> Europe/Paris</code></pre>
<p>Si la timezone change en fonction de l'utilisateur, vous devez passer la timezone souhaitée au filtre :</p>
<pre class="code-multiline language-twig"><code class="language-twig" id="f3eeec3cc648b2a6f8401a47f82b5c07"><span class="token twig language-twig"><span class="token delimiter punctuation">{{</span> my_date<span class="token operator">|</span>date<span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>d/m/Y<span class="token punctuation">'</span></span><span class="token punctuation">,</span> my_timezone<span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span></code></pre>
<p>Vous pouvez également écrire un mécanisme modifiant la timezone de Twig dynamiquement (un <em>event listener</em> sur la requête par exemple).</p>
<pre class="code-multiline language-php"><code class="language-php" id="0e8bbbfa1aff24d543a6fcf340f1a625"><span class="token variable">$twig</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twig_Environment</span><span class="token punctuation">(</span><span class="token variable">$loader</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$twig</span><span class="token operator">-&gt;</span><span class="token function">getExtension</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Twig_Extension_Core'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setTimezone</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Europe/Paris'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="api" class="anchor-title"><a href="#api">API</a></h2>
<p>Si vous développez une API qui accepte des dates, la meilleure solution est d'utiliser un format de date comprenant les décalages horaires comme la <a href="https://www.ietf.org/rfc/rfc3339.txt" target="_blank"><code class="code-inline" id="660b7644ca474275ff166bd03a754353">RFC3339</code></a> :</p>
<pre class="code-multiline"><code id="398bbd884d1ef92dd70a8aab12eb2200">2017-11-17T12:51:11+00:00</code></pre>
<p>Utilisez ce format pour serializer vos dates en sortie afin d'éviter toute ambiguïté pour les consommateurs de votre API et en entrée afin de permettre la saisie dans n'importe quelle timezone.</p>
<h2 id="conclusion" class="anchor-title"><a href="#conclusion">Conclusion</a></h2>
<p>Ne pas gérer ou mal gérer les <strong>timezones</strong> sur une application manipulant des dates peut entraîner des bugs assez sérieux, difficiles à identifier et couteux à corriger après coup (imaginez migrer les dates de 500k lignes en prod). Prendre en compte cette problématique dès le début des développements vous évitera donc de vous arracher les cheveux ;)</p>
                                                                </main>
            <aside class="article-content__aside">
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a href="/elao_/blog/auteur/mcolin">
                                <img     src="/elao_/resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg"
    srcset="
        /elao_/resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg 1x,
        /elao_/resized/content/images/members/avatars/mcolin.jpg/0899bdf7169af336de983de73d88fa58.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a href="/elao_/blog/auteur/mcolin">
                                <strong>Maxime Colin</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                            <a href="https://twitter.com/colin_maxime" class="social social--small">
                                    <i class="icon icon--x" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Twitter de Maxime Colin</span>
                                </a>
                                                                                        <a href="https://github.com/maximecolin " class="social social--small">
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Maxime Colin</span>
                                </a>
                                                                                        <a href="https://www.maximecolin.fr/" class="social social--small">
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Maxime Colin</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/master/content/blog/dev/date-php-timezone-utc-pourquoi-est-ce-important.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                                                <a href="/elao_/recrutement">
                            Nous recrutons
                                                            <span class="bullet">2</span>
                                                    </a>
                    </li>
                    <li>
                        <a href="/elao_/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            Twitter
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/mycompany/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2024 - ELAO - Tous droits réservés</span>
            <a href="/elao_/legal">Mentions légales</a>
            <a href="/elao_/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
