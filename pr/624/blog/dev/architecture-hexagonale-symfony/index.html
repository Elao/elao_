<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>L&#039;architecture hexagonale avec Symfony</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/624/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/624/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/624/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/624/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/624/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/624/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/624/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Présentation de l&#039;architecture hexagonale et de son implémentation avec le framework Symfony." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/624/blog/dev/architecture-hexagonale-symfony" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="L&#039;architecture hexagonale avec Symfony" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Présentation de l&#039;architecture hexagonale et de son implémentation avec le framework Symfony." />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/624/blog/dev/architecture-hexagonale-symfony" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/pr/624/%2E%2E/../resized/content/images/blog/thumbnails/hexagons.jpg/e8cd016fd57f09a361fa98e795825899.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="L&#039;architecture hexagonale avec Symfony">
            <meta property="twitter:description" content="Présentation de l&#039;architecture hexagonale et de son implémentation avec le framework Symfony.">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/624/%2E%2E/../resized/content/images/blog/thumbnails/hexagons.jpg/29e016c15732132afbcbdfdfaa04dff2.jpg">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/pr/624/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "L'architecture hexagonale avec Symfony",
    "image": [
        "https://elao.github.io/elao_/pr/624/blog/dev/content/images/blog/thumbnails/hexagons.jpg"
    ],
    "datePublished": "2017-06-21T00:00:00+00:00",
    "dateModified": "2017-06-21T00:00:00+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Maxime Colin",
            "url": "https://elao.github.io/elao_/pr/624/equipe/mcolin"
        }
    ],
    "keywords": [
        "Architecture",
        "Conception",
        "Symfony",
        "Php"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/624/build/app.9aee1a38.css">
        
                        <script src="/elao_/pr/624/build/runtime.59d700bb.js" defer></script><script src="/elao_/pr/624/build/552.3082ae9c.js" defer></script><script src="/elao_/pr/624/build/769.7dfbbe52.js" defer></script><script src="/elao_/pr/624/build/app.d906f729.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;624&#x5C;&#x2F;build&#x5C;&#x2F;see.ace7bf9f.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;624&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;624&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;624&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;624&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/624/">
                        <span class="screen-reader">L&#039;architecture hexagonale avec Symfony</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/624/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/624/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/624/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/624/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/624/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/pr/624/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/624/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/624/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/624/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/624/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/624/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/624/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/624/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/pr/624/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/624/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/624/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/624/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/624/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">L&#039;architecture hexagonale avec Symfony</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/93d4604a2fd9da89dbfa5f69ceb03dcb.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/93d4604a2fd9da89dbfa5f69ceb03dcb.jpg') 1x,
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/fe7c1eb08c24d56fa2396dacd7b1b750.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/93d4604a2fd9da89dbfa5f69ceb03dcb.jpg') 1x,
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/fe7c1eb08c24d56fa2396dacd7b1b750.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/93d4604a2fd9da89dbfa5f69ceb03dcb.jpg') 1x,
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/fe7c1eb08c24d56fa2396dacd7b1b750.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/93d4604a2fd9da89dbfa5f69ceb03dcb.jpg') 1x,
        url('/elao_/pr/624/%2E%2E/../resized/content/images/blog/headers/hexagons.jpg/fe7c1eb08c24d56fa2396dacd7b1b750.jpg') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a href="/elao_/pr/624/blog/auteur/mcolin">
                                    <img     src="/elao_/pr/624/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg"
    srcset="
        /elao_/pr/624/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg 1x,
        /elao_/pr/624/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/0899bdf7169af336de983de73d88fa58.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/pr/624/blog/auteur/mcolin">
                                    <strong>Maxime Colin</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>21 juin 2017</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>L&#039;architecture hexagonale avec Symfony</h1>
                <p>Présentation de l&#039;architecture hexagonale et de son implémentation avec le framework Symfony.</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/624/blog/tag/architecture" rel="nofollow">#Architecture</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/624/blog/tag/conception" rel="nofollow">#Conception</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/624/blog/tag/symfony" rel="nofollow">#Symfony</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/624/blog/tag/php" rel="nofollow">#Php</a>
                        </li>
                                    </ul>
            </div>
        </div>

                    <ol class="table-of-content" data-aos="fade-up">
                                    <li class="table-of-content__item">
                        <a href="#introduction">Introduction</a>

                                                    <ol class="table-of-content__sub-level">
                                                                        <li>
                                            <a href="#une-architecture-hexagonale">Une architecture hexagonale</a>
                                        </li>
                                                                        <li>
                                            <a href="#une-architecture-en-couches-ou-en-oignon">Une architecture en couches (ou en oignon)</a>
                                        </li>
                                                                        <li>
                                            <a href="#qu-est-ce-qu-on-met-dedans">Qu&#039;est ce qu&#039;on met dedans ?</a>
                                        </li>
                                                                        <li>
                                            <a href="#pourquoi">Pourquoi ?</a>
                                        </li>
                                                            </ol>
                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#et-symfony-dans-tout-ca">Et Symfony dans tout ça ?</a>

                                                    <ol class="table-of-content__sub-level">
                                                                        <li>
                                            <a href="#framework-agnostique">Framework agnostique</a>
                                        </li>
                                                            </ol>
                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#conclusion">Conclusion</a>

                                            </li>
                            </ol>
        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <h2 id="introduction" class="anchor-title"><a href="#introduction">Introduction</a></h2>
<p>L'architecture hexagonale, également appelée <em>Ports &amp; Adapters</em>, présente deux caratéristiques lorsqu'on la schématise : une forme <strong>hexagonale</strong> (d'où son nom) et une séparation entre l'<strong>application</strong>, l'<strong>extérieur</strong> et une partie contenant des <strong>adapteurs</strong> permettant aux deux de communiquer.</p>
<p>Elle a été pensé par <a href="http://alistair.cockburn.us/Hexagonal+architecture" target="_blank">Alistair Cockburn</a> dans les années 2000. Son but est de permettre à une application d'être pilotée sans distinction par des utilisateurs, des programmes, des tests automatisés ou des scripts ainsi que d'être développée et testée de façon isolée de son contexte d'exécution et de ses bases de données.</p>
<img src="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/hexagonal-architecture.png/3d2a6e06bc4d29cff3f3ed67c151de9f.png" alt="Architecture hexagonale" title="Architecture hexagonale" srcset="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/hexagonal-architecture.png/3d2a6e06bc4d29cff3f3ed67c151de9f.png 1x,
/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/hexagonal-architecture.png/76e9411d763f5c4776c56abcb65aed5e.png 2x," id="architecture-hexagonale">
<h3 id="une-architecture-hexagonale" class="anchor-title"><a href="#une-architecture-hexagonale">Une architecture hexagonale</a></h3>
<p>Les deux grands principes de base de l'architecture hexagonale sont :</p>
<ul>
<li>La <strong>séparation entre le code métier et le code technique</strong>. Le but est de rendre votre code métier <strong>agnostique</strong> de l'architecture technique dans laquelle votre application sera exécutée.</li>
<li>L'<strong>inversion de dépendance</strong> : votre code technique dépend de votre code métier et non l'inverse comme dans une architecture plus classique. Pour cela vous allez massivement utiliser le <strong>design pattern adapter</strong>.</li>
</ul>
<p>La forme hexagonale — qui aurait tout aussi bien pu être octogonale ou pentagonale — est là pour mettre en évidence les différentes facettes par lesquelles votre application communique avec l'extérieur via des adapteurs.</p>
<p>Le <strong>code technique</strong> c'est tout l'environnement nécessaire à votre application sans faire partie de son coeur métier. Tout ou partie de ce code peut être remplacé sans impacter votre métier. Cela comprend — entre autres — la persistance (base de données), le système de fichier, le cache, l'applicatif externe (API, binaires, ...), les bibliothèques et frameworks, etc.</p>
<p>Le <strong>code métier</strong> c'est tout le code qui traduit le métier de votre client. Il s'agit des règles métier, de la logique métier, du code purement applicatif, ... Ce code est irremplaçable et constitue le coeur de votre application.</p>
<h3 id="une-architecture-en-couches-ou-en-oignon" class="anchor-title"><a href="#une-architecture-en-couches-ou-en-oignon">Une architecture en couches (ou en oignon)</a></h3>
<figure>
    <img src="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/onionman.jpg/1b6a9e1b65187cd4b66b0e3acdd4e95f.jpg" alt="Onion man" srcset="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/onionman.jpg/1b6a9e1b65187cd4b66b0e3acdd4e95f.jpg 1x,
/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/onionman.jpg/180c308b11f9b33648566da6f9831894.jpg 2x," id="onion-man">
    <figcaption>
      <span class="figure__legend">Onion man</span>
    </figcaption>
</figure>
<p>Afin d'aller encore un peu plus loin dans le découplage de mon code et de me donner un cadre facilitant la séparation du code technique et du code métier, je me suis également inspiré de deux autres architectures proches dans l'idée :</p>
<ul>
<li><a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" target="_blank">The Clean Architecture</a> de Uncle Bob</li>
<li><a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/" target="_blank">The Onion Architecture</a> de Jeffrey Palermo</li>
</ul>
<p>Ces deux architectures séparent le code en différentes couches imbriquées. Le nombre de couches dépendra de la complexité de votre application et jusqu'où vous souhaitez pousser le découplage.</p>
<p>Pour ma part je suis partie sur les quatres couches suivantes qui représentent assez bien les différentes parties d'une application <strong>Symfony</strong> (de la plus profonde à la moins profonde) :</p>
<ul>
<li>Domain</li>
<li>Application</li>
<li>Infrastructure</li>
<li>Ui</li>
</ul>
<p>L'idée est que chaque couche peut utiliser une couche inférieure mais jamais une couche supérieure, ou en tout cas pas directement.</p>
<figure>
    <img src="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/clean-architecture.png/f0ff1a140e1b411d7ac36e6e3cf59d39.png" alt="Clean architecture" srcset="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/clean-architecture.png/f0ff1a140e1b411d7ac36e6e3cf59d39.png 1x,
/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/clean-architecture.png/fc5e4bbdbdf77d566012f5d5ac5f6c77.png 2x," id="clean-architecture">
    <figcaption>
      <span class="figure__legend">Clean architecture</span>
    </figcaption>
</figure>
<p>Les seuls moyens de traverser une couche supérieure sont les <strong>événements</strong>, les <strong>exceptions</strong> et les <strong>adapteurs</strong>.</p>
<p>Les <strong>événements</strong> et les <strong>exceptions</strong> peuvent être lancés dans une couche inférieure et traités dans une couche supérieure. Quand au design pattern <strong>adapter</strong>, il permet de définir une interface du service dont vous avez besoin mais située dans une couche supérieure. L'adapteur correspondant sera implémenté dans ladite couche et l'injection de dépendances permettra d'assembler le tout en conservant le principe de séparation des couches.</p>
<p>Cette séparation en couches n'est pas indispensable à l'architecture hexagonale mais offre un cadre strict permettant de bien séparer votre code applicatif de votre infrastructure ainsi que les différentes parties de votre code. Vous pouvez vous contenter de séparer Domain/Application (code métier) de Infrastructure/UI (code technique).</p>
<h3 id="qu-est-ce-qu-on-met-dedans" class="anchor-title"><a href="#qu-est-ce-qu-on-met-dedans">Qu'est ce qu'on met dedans ?</a></h3>
<p>Dans la couche <strong>Domain</strong> je mets le coeur métier de mon code. Sans être exhaustif, cela comprend mes modèles, tout ce qui concerne les règles métiers (pour lesquelles vous pouvez utiliser le <a href="https://github.com/maximecolin/satisfaction" target="_blank">pattern specification</a>), les événéments et exceptions métier.</p>
<p>Dans la couche <strong>Application</strong> je place tout mon code applicatif. Généralement cela se traduit par des <em>commands</em> et des <em>queries</em> (cf CQRS et CommandBus). Cette couche se situant au-dessus de la couche Domain, je pourrais utiliser tout ce qui s'y trouve. Si j'ai besoin de faire appel à des composants de l'infrastructure tels que la persistance, une API ou une bibliothèque, je créerai des interfaces pour chacun de ces composants.</p>
<p>La couche <strong>Infrastructure</strong> contient majoritairement toutes les implémentations des adapteurs décrites dans les interfaces des couches inférieures ainsi que tous les services nécessaires pour faire communiquer mon application avec mon infrastructure.</p>
<p>Enfin la couche <strong>Ui</strong> est une couche un peu particulière. Comme on peut le voir sur le schéma au début de l'article, elle occupe une facette de l'hexagone et n'entoure pas les autres couches. Il s'agit d'une sorte d'adapteur géant qui permet à l'utilisateur de communiquer avec votre application. Elle contient donc tout ce qui touche à l'interface utilisateur comme les contrôleurs, les vues, les formulaires, ...</p>
<pre class="code-multiline"><code id="2a95f43b9c8c68c1a0099bfda9ef0e9e">src
|- Application
|  |- Command
|  |- Query
|- Domain
|  |- Model
|  |- Specs
|- Infrastructure
|  |- Adapter
|  |- Repository
|- Ui
|  |- Action
|  |- Form</code></pre>
<h3 id="pourquoi" class="anchor-title"><a href="#pourquoi">Pourquoi ?</a></h3>
<p>Généralement lorsque je présente cette architecture on me fait souvent les remarques suivantes : "C'est compliqué !", "Faut écrire beaucoup plus de code !" (cf. les adapteurs), "Ça prend trop de temps !", ...</p>
<p>Certes cette architecture est plus complexe, implique un peu plus de code et demande un peu plus de réflexion qu'une architecture "classique" mais offre tout de même plusieurs avantages de taille.</p>
<ol>
<li>
<p>Le code (en particulier le code métier) est beaucoup plus facile à tester unitairement. Il s'agit de pur PHP, débarrassé de toute relation à votre framework ou votre architecture. Toutes les dépendances extérieures à votre métier sont des interfaces que vous pouvez facilement mocker ou implémenter pour vos tests. Votre code métier peut être couvert à 100% par les test unitaires.</p>
</li>
<li>
<p>Votre code métier et votre infrastructure étant complétement découplés, vous pouvez aisémenent faire évoluer votre infrastructure (changement de techno, montée de version, ...) sans jamais impacter votre code métier.</p>
</li>
<li>
<p>Vous pouvez décliner simplement l'application — par exemple en version CLI ou API — en conservant votre code metier et en changeant seulement les couches supérieures.</p>
</li>
<li>
<p>Les différentes parties de votre application étant bien découplées, vous pouvez simplement répartir leur développement sur plusieurs équipes.</p>
</li>
<li>
<p>Un code metier plus stable et pérenne.</p>
</li>
<li>
<p>En début de projet, vous pouvez mettre en place une infrastructure simple (persistance en mémoire/fichier, API mockée, ...) afin de vous concentrer sur la valeur ajoutée : les fonctionnalités métier.</p>
</li>
</ol>
<p>Au final, l'investissement de départ est un peu plus grand, quoiqu'avec l'habitude pas tant, mais est largement amorti sur la durée de vie du projet tant les évolutions et la testabilité sont simplifiées.</p>
<figure>
    <img src="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/good-work-chuck-norris.jpg/156614edd698b1e91a8225789a82719b.jpg" alt="Good work" srcset="/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/good-work-chuck-norris.jpg/156614edd698b1e91a8225789a82719b.jpg 1x,
/elao_/pr/624/%2E%2E/../resized/content/images/blog/2017/good-work-chuck-norris.jpg/68018bfc7740016aad1b577b055770e5.jpg 2x," id="good-work">
    <figcaption>
      <span class="figure__legend">Good work</span>
    </figcaption>
</figure>
<h2 id="et-symfony-dans-tout-ca" class="anchor-title"><a href="#et-symfony-dans-tout-ca">Et Symfony dans tout ça ?</a></h2>
<p>Tout d'abord j'essaie de créer le moins possible de bundles, voire pas du tout. Cette fonctionnalité de Symfony n'est d'aucune utilité pour cette architecture, elle reste néanmoins indispensable sur certaines fonctions selon la version du framework.</p>
<p>Symfony tend d'ailleurs vers le <em>no bundle</em> dans ses versions les plus récentes (3.3 sortie dernièrement et 4.0 à venir).</p>
<h3 id="framework-agnostique" class="anchor-title"><a href="#framework-agnostique">Framework agnostique</a></h3>
<p>La première règle est de bien <strong>découpler votre code métier de votre framework</strong>, il faut donc bannir les annotations du code que vous placez dans les couches Domain et Application.</p>
<p>Le mapping Doctrine se retrouvera dans des fichiers <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/yaml-mapping.html" target="_blank"><code class="code-inline" id="176a3b23c5e392bb5c047d481938bd7b">yml</code></a> ou <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/xml-mapping.html" target="_blank"><code class="code-inline" id="0f635d0e0f3874fff8b581c132e6c7a7">xml</code></a>. Pour cela, il y a une petite configuration à mettre en place dans votre fichier <code class="code-inline" id="0f1be8eec416e71c28b41efb0544df26">config.yml</code> pour indiquer à Doctrine où se trouvent votre mapping et vos entitées.</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="56cd164dccba0b5bbc81ba14e3434614"><span class="token key atrule">doctrine</span><span class="token punctuation">:</span>
    <span class="token key atrule">orm</span><span class="token punctuation">:</span>
        <span class="token key atrule">mappings</span><span class="token punctuation">:</span>
            <span class="token key atrule">entity</span><span class="token punctuation">:</span>
                <span class="token key atrule">type</span><span class="token punctuation">:</span> yml
                <span class="token key atrule">prefix</span><span class="token punctuation">:</span> App\Domain\Model
                <span class="token key atrule">dir</span><span class="token punctuation">:</span> <span class="token string">"%kernel.project_dir%/app/config/doctrine/entity"</span>
                <span class="token key atrule">alias</span><span class="token punctuation">:</span> App
                <span class="token key atrule">is_bundle</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></code></pre>
<p>Vous pouvez indiquer le type <code class="code-inline" id="0f635d0e0f3874fff8b581c132e6c7a7">xml</code> si vous préférez ce format.</p>
<p>Pour la validation, nous allons également utiliser des fichiers <a href="https://symfony.com/doc/current/validation.html#the-basics-of-validation" target="_blank"><code class="code-inline" id="176a3b23c5e392bb5c047d481938bd7b">yml</code> ou <code class="code-inline" id="0f635d0e0f3874fff8b581c132e6c7a7">xml</code></a>. A partir de la version 3.3, Symfony permet d'indiquer dans sa configuration les répertoires qui contiennent des fichiers de validation :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="2639751f751422917748ebb9bca7a6c7"><span class="token key atrule">framework</span><span class="token punctuation">:</span>
    <span class="token key atrule">validation</span><span class="token punctuation">:</span>
        <span class="token key atrule">mapping</span><span class="token punctuation">:</span>
            <span class="token key atrule">paths</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">'%kernel.project_dir%/app/config/validation'</span></code></pre>
<p>mais avant 3.3, il vous faudra les mettre dans un bundle qui prendra place dans <code class="code-inline" id="9677cfa9d711ccdb316fa851e2cf4c70">src/Infrastructure</code></p>
<pre class="code-multiline"><code id="f5f62e0b4164fdebcd9d706f5c2b4a68">src
|- Infrastructure
   |- Bundle
      |- Resource
      |  |- config
      |     |- validation
      |        |- ObjetA.yml
      |        |- ObjetB.yml
      |- InfrastructureBundle.php</code></pre>
<p>Une fois fait, vous pouvez désactiver le support des annotations de validation dans <code class="code-inline" id="0f1be8eec416e71c28b41efb0544df26">config.yml</code> :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="fa098360a073b3741afc613eedb7c897"><span class="token key atrule">framework</span><span class="token punctuation">:</span>
    <span class="token key atrule">validation</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">enable_annotations</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token punctuation">}</span></code></pre>
<p>Deuxièmement, <strong>vos contrôleurs ne doivent pas contenir de logique metier</strong> qui doit être restreinte à vos seules couches Domain et Application. Vous devez uniquement faire appel à votre code métier. De fait, vos contrôleurs sont censés être relativement concis.</p>
<p>Troisièmement, faites bien attention à <strong>ne jamais utiliser de code provenant du framework dans votre code métier</strong>. Si vous en avez vraiment besoin, créez une interface dans Domain ou Application puis un adapteur dans l'Infrastructure.</p>
<p>Enfin, <strong>utilisez l'injection de dépendance</strong> de Symfony pour injecter vos adapteurs dans votre code métier.</p>
<h2 id="conclusion" class="anchor-title"><a href="#conclusion">Conclusion</a></h2>
<p>Pour conclure, je dirai que l'architecture hexagonale n'est pas une fin en soi ni l'architecture ultime. Je la vois davantage comme un cadre permettant de se contraindre à respecter le principe de séparation entre le code métier et code technique.</p>
<p>Comme tout paradigme, il a ses faiblesses et ses exceptions, mais pour l'utiliser sur tous mes projets depuis quelques années, il m'a beaucoup fait progresser vers une conception propre, solide, testable et maintenable.</p>
                                                                </main>
            <aside class="article-content__aside">
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a href="/elao_/pr/624/blog/auteur/mcolin">
                                <img     src="/elao_/pr/624/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg"
    srcset="
        /elao_/pr/624/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg 1x,
        /elao_/pr/624/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/0899bdf7169af336de983de73d88fa58.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a href="/elao_/pr/624/blog/auteur/mcolin">
                                <strong>Maxime Colin</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                            <a href="https://twitter.com/colin_maxime" class="social social--small">
                                    <i class="icon icon--x" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Twitter de Maxime Colin</span>
                                </a>
                                                                                        <a href="https://github.com/maximecolin " class="social social--small">
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Maxime Colin</span>
                                </a>
                                                                                        <a href="https://www.maximecolin.fr/" class="social social--small">
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Maxime Colin</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/blog-workflow-git/content/blog/dev/architecture-hexagonale-symfony.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/624/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/624/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/624/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/624/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/624/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/624/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/624/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                                                <a href="/elao_/pr/624/recrutement">
                            Nous recrutons
                                                            <span class="bullet">2</span>
                                                    </a>
                    </li>
                    <li>
                        <a href="/elao_/pr/624/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/624/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            Twitter
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/mycompany/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/pr/624/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2024 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/624/legal">Mentions légales</a>
            <a href="/elao_/pr/624/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
