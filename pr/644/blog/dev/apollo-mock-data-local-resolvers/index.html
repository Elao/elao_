<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Mocker une API GraphQL avec les resolvers locaux du client Apollo</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/644/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/644/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/644/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/644/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/644/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/644/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/644/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Découvrez comment simuler tout ou partie d&#039;une API GraphQL, depuis votre application front, 
sans impacter votre code fonctionnel, grâce aux resolvers locaux Apollo.
" />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/644/blog/dev/apollo-mock-data-local-resolvers" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Mocker une API GraphQL avec les resolvers locaux du client Apollo" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Découvrez comment simuler tout ou partie d&#039;une API GraphQL, depuis votre application front, 
sans impacter votre code fonctionnel, grâce aux resolvers locaux Apollo.
" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/644/blog/dev/apollo-mock-data-local-resolvers" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/63dd8262c4b2e0e83ff24c37477af142.png">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Mocker une API GraphQL avec les resolvers locaux du client Apollo">
            <meta property="twitter:description" content="Découvrez comment simuler tout ou partie d&#039;une API GraphQL, depuis votre application front, 
sans impacter votre code fonctionnel, grâce aux resolvers locaux Apollo.
">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/14750fbc639ee9406b2e0f6ef6f93c56.png">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/pr/644/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Mocker une API GraphQL avec les resolvers locaux du client Apollo",
    "image": [
        "https://elao.github.io/elao_/pr/644/blog/dev/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png"
    ],
    "datePublished": "2024-07-09T00:00:00+00:00",
    "dateModified": "2024-07-09T00:00:00+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Maxime Steinhausser",
            "url": "https://elao.github.io/elao_/pr/644/equipe/msteinhausser"
        }
    ],
    "keywords": [
        "Javascript",
        "Apollo",
        "Graphql",
        "Api"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/644/build/app.1c28df5c.css">
        
                        <script src="/elao_/pr/644/build/runtime.33c836da.js" defer></script><script src="/elao_/pr/644/build/552.3082ae9c.js" defer></script><script src="/elao_/pr/644/build/769.7dfbbe52.js" defer></script><script src="/elao_/pr/644/build/app.d906f729.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;644&#x5C;&#x2F;build&#x5C;&#x2F;see.ace7bf9f.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;644&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;644&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;644&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;644&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/644/">
                        <span class="screen-reader">Mocker une API GraphQL avec les resolvers locaux du client Apollo</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/644/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/644/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/644/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/644/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/644/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/pr/644/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/644/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/644/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/644/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/644/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/644/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/644/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/644/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/pr/644/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/644/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/644/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/644/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/644/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Mocker une API GraphQL avec les resolvers locaux du client Apollo</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6e8971b764abfd4b339fb203f560b0f8.png');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6e8971b764abfd4b339fb203f560b0f8.png') 1x,
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6fef6d38ceb2de6b444b18831705796c.png') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6e8971b764abfd4b339fb203f560b0f8.png') 1x,
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6fef6d38ceb2de6b444b18831705796c.png') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6e8971b764abfd4b339fb203f560b0f8.png') 1x,
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6fef6d38ceb2de6b444b18831705796c.png') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6e8971b764abfd4b339fb203f560b0f8.png') 1x,
        url('/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/apollo-local-resolvers-2.png/6fef6d38ceb2de6b444b18831705796c.png') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a href="/elao_/pr/644/blog/auteur/msteinhausser">
                                    <img     src="/elao_/pr/644/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg"
    srcset="
        /elao_/pr/644/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg 1x,
        /elao_/pr/644/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/079e97b32e0b5c6cbde07e847b4423d4.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/pr/644/blog/auteur/msteinhausser">
                                    <strong>Maxime Steinhausser</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>9 juillet 2024</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Mocker une API GraphQL avec les resolvers locaux du client Apollo</h1>
                <p>Découvrez comment simuler tout ou partie d&#039;une API GraphQL, depuis votre application front, 
sans impacter votre code fonctionnel, grâce aux resolvers locaux Apollo.
</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/644/blog/tag/javascript" rel="nofollow">#Javascript</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/644/blog/tag/apollo" rel="nofollow">#Apollo</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/644/blog/tag/graphql" rel="nofollow">#Graphql</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/644/blog/tag/api" rel="nofollow">#Api</a>
                        </li>
                                    </ul>
            </div>
        </div>

                    <ol class="table-of-content" data-aos="fade-up">
                                    <li class="table-of-content__item">
                        <a href="#contexte">Contexte</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#les-resolvers-locaux-apollo">Les resolvers locaux Apollo</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#cas-d-usage">Cas d&#039;usage</a>

                                                    <ol class="table-of-content__sub-level">
                                                                        <li>
                                            <a href="#simuler-une-query-de-listing">Simuler une query de listing</a>
                                        </li>
                                                                        <li>
                                            <a href="#simuler-le-retour-d-une-mutation">Simuler le retour d&#039;une mutation</a>
                                        </li>
                                                                        <li>
                                            <a href="#simuler-partiellement-des-donnees">Simuler partiellement des données</a>
                                        </li>
                                                                        <li>
                                            <a href="#astuce-ne-simuler-que-les-donnees-absentes">Astuce : ne simuler que les données absentes</a>
                                        </li>
                                                            </ol>
                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#avantages-et-comparaisons">Avantages et comparaisons</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#disclaimer">Disclaimer</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#conclusion">Conclusion</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#liens-annexes">Liens annexes</a>

                                            </li>
                            </ol>
        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <h2 id="contexte" class="anchor-title"><a href="#contexte">Contexte</a></h2>
<p>Dans le développement d'une application web, il est courant que le front-end et le back-end soient développés de
manière indépendante, parfois par deux équipes distinctes.
Il peut alors être difficile de se coordonner sur le développement des fonctionnalités.
En particulier, l'équipe front peut vite être bloquée par le manque de spécifications de l'API, de son implémentation
concrète ou encore de données suffisantes à consommer.</p>
<p>Il convient de se mettre d'accord rapidement sur les principes de fonctionnement du dialogue entre le client et le serveur,
en identifiant les besoins de chacun et en établissant un premier contrat d'API. Pour autant, la capacité de l'équipe
back à fournir à temps tous les éléments nécessaires à ce que le front puisse avancer de façon autonome n'est pas
toujours suffisante.</p>
<div class="admonition note">
<p>
    À Elao, nombreuses de nos applications consistent en un back-end servant une API GraphQL construite avec le framework PHP
    <a href="/elao_/pr/644/glossaire/symfony">Symfony</a> et un front-end en <a href="/elao_/pr/644/glossaire/react">React</a> avec le client Apollo GraphQL.
    Il nous arrive également d'intervenir sur des projets uniquement sur le client front-end et devoir se coordonner avec
    une équipe back-end externe.
</p>
</div>
<p>Dans ce contexte, il est intéressant de pouvoir simuler tout ou partie d'une API GraphQL, en minimisant le plus possible
les impacts sur le code fonctionnel du client front-end. C'est-à-dire en évitant l'introduction de dette technique
induite par <strong>l'entremêlement du code fonctionnel avec du code visant à simuler les appels au serveur</strong>. Code qu'il faudra
revoir avec plus ou moins de difficultés lorsque nous consommerons le véritable serveur.</p>
<p>C'est là qu'interviennent <em>les resolvers locaux Apollo</em>.</p>
<div class="admonition danger">
<p class="admonition-title">Comprendre le cache Apollo</p>
<p>
    La suite de cet article survole des connaissances quant au fonctionnement du cache avec le client GraphQL Apollo.<br>
    Si vous n'êtes pas tout-à-fait à l'aise avec ces principes, je vous invite à lire notre article sur le sujet:
    <a href="/elao_/pr/644/blog/dev/apollo-graphql-cache">Comprendre le cache du client GraphQL Apollo</a>.<br>
    L'article traite d'une ancienne version (2.x) d'Apollo, mais les principes restent les mêmes.
</p>
</div>
<h2 id="les-resolvers-locaux-apollo" class="anchor-title"><a href="#les-resolvers-locaux-apollo">Les resolvers locaux Apollo</a></h2>
<p>Les resolvers locaux (ou resolvers client), sont une fonctionnalité du client
Apollo (<a href="https://www.apollographql.com/blog/announcing-apollo-client-2-5-c12230cabbb7#2-write-a-local-resolver-for-your-data" target="_blank">introduits en 2.5</a>)
permettant d'<strong>interroger et manipuler un état local de votre application</strong>, propre au client et sans lien direct avec
le serveur, comme vous pourriez le faire avec un store tel que Redux.<br>
À la différence que vous utiliserez des <strong>queries et mutations GraphQL</strong> ainsi que l'API Javascript du cache Apollo pour interagir
avec cet état, de la même manière que vous si vous consommiez un serveur.</p>
<p>C'est cette homogénéité d'API qui va nous intéresser particulièrement, puisqu'elle va nous permettre de décrocher
facilement du code jusqu'alors uniquement client vers un échange client/serveur. </p>
<p>Un <code class="code-inline" id="f8609e719e58d9fd43255f51f3b48e8e">resolver</code> GraphQL est une fonction, d'ordinaire exécutée par le serveur, afin de résoudre un champ d'une requête GraphQL.</p>
<blockquote>
<p>A resolver is a function that's responsible for populating the data for a single field in your schema. It can populate
that data in any way you define, such as by fetching data from a back-end database or a third-party API.<br>
<cite>— <a href="https://www.apollographql.com/docs/apollo-server/data/resolvers" target="_blank">documentation Apollo server</a></cite></p>
</blockquote>
<p>Un resolver local est donc une fonction définie et exécutée uniquement par le client pour résoudre les champs d'une
requête GraphQL, annotés d'une directive spéciale : <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code>.</p>
<p>L'exemple donné par la documentation Apollo cherche à fournir un état local pour un panier d'achat, en ajoutant un flag
<code class="code-inline" id="657cad12cc119d1ba80f0f8046731da5">isInCart</code> à une liste de produits. Cela permet de réaliser un système de panier sans avoir à exposer cette donnée sur
chaque produit côté serveur, ni dans un store Redux ou local storage complètement distinct de notre cache Apollo.</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="aae2cbed1601b8cd5dc139b017aa0c46"><span class="token keyword">query</span> <span class="token definition-query function">ProductDetails</span><span class="token punctuation">(</span><span class="token variable">$productId</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">product</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$productId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">name</span>
    <span class="token property">price</span>
    <span class="token property">isInCart</span> <span class="token directive function">@client</span> <span class="token comment"># &lt;- 👀</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>La <strong>directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code></strong> sur le champ <code class="code-inline" id="657cad12cc119d1ba80f0f8046731da5">isInCart</code> indique à Apollo de chercher un resolver local pour résoudre ce champ.
Ce champ ne sera par ailleurs <strong>pas communiqué au serveur</strong> dans la définition de la query lors de son exécution.</p>
<p>Le resolver pour <code class="code-inline" id="657cad12cc119d1ba80f0f8046731da5">isInCart</code> peut être défini ainsi, au niveau du client Apollo:</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="c429a7e08d4174a7235323c57823e923"><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// …</span>
  resolvers<span class="token operator">:</span> <span class="token punctuation">{</span>
    Product<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// On défini un resolver local pour le champ `isInCart` du type `Product`</span>
      <span class="token function-variable function">isInCart</span><span class="token operator">:</span> <span class="token punctuation">(</span>launch<span class="token punctuation">,</span> _args<span class="token punctuation">,</span> <span class="token punctuation">{</span> cache <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Récupère d'une façon quelconque les produits présents dans le panier</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> cartItems <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token comment">// […];</span>

        <span class="token comment">// puis retourne un booléen qui sera sauvegardé dans le cache</span>
        <span class="token keyword">return</span> cartItems<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>launch<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Lors de l'exécution de la query <code class="code-inline" id="684a7f94af7046125f90be3235636181">ProductDetails</code>, <em>qui est un mélange de champs distants et locaux</em>, Apollo récupère la
réponse du serveur, puis essaye de trouver un resolver local pour notre champ <code class="code-inline" id="657cad12cc119d1ba80f0f8046731da5">isInCart</code> annoté avec la
directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code>.<br>
Si un resolver est trouvé, il est exécuté et le champ <code class="code-inline" id="657cad12cc119d1ba80f0f8046731da5">isInCart</code> est <strong>fusionné</strong> avec la réponse du serveur dans le cache.</p>
<p>➜ Nos données distantes et locales cohabitent ainsi au sein d'<strong>un seul et même store de données</strong>.</p>
<p><em>Découvrons maintenant comment nous pouvons utiliser cette fonctionnalité pour simuler tout ou partie d'une API GraphQL
et poursuivre nos développements front sans introduire de dette technique ni de code fonctionnel spécifique à retirer
une fois que nous consommerons le serveur.</em></p>
<h2 id="cas-d-usage" class="anchor-title"><a href="#cas-d-usage">Cas d'usage</a></h2>
<p>Nous illustrerons les cas d'usage suivants au travers d'une application exposant une page de liste d'indicateurs
(KPI &amp; graphiques) personnalisables (a.k.a <code class="code-inline" id="fa07652cb6a5517c5dffb407c8eca014">Widgets</code>).</p>
<img src="/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/widgets.png/e4731decde386b402ad7feac279a4cc0.png" alt="Liste d'indicateurs" title="Liste d'indicateurs" srcset="/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/widgets.png/e4731decde386b402ad7feac279a4cc0.png 1x,
/elao_/pr/644/%2E%2E/../resized/content/images/blog/2024/apollo-mock-data-local-resolvers/widgets.png/65d982318c365af4661e2af320c5cfa4.png 2x," id="liste-d-indicateurs">
<p>Un utilisateur peut ainsi créer son tableau de bord en ajoutant et configurant des indicateurs à partir de modèles
pré-existants. Puis les organiser, supprimer, ou en mettre en favoris.</p>
<h3 id="simuler-une-query-de-listing" class="anchor-title"><a href="#simuler-une-query-de-listing">Simuler une query de listing</a></h3>
<p>Un resolver peut-être utilisé à <strong>n'importe quel niveau du schéma GraphQL</strong>.
Cela veut dire qu'il est possible de surcharger toute une query en définissant une directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code> sur celle-ci et
un resolver sur le champ correspondant de votre objet <code class="code-inline" id="bf1e1e9a52f888f2e473ceaab39689ad">ROOT_QUERY</code> (Généralement <code class="code-inline" id="66c1b4c7f3dc385b68a9fa903ccd016d">Query</code>).</p>
<p>Par exemple, afin de simuler une requête pour obtenir la liste des indicateurs :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="c2eee4748a0cb5d67d6aa7e64abb4452"><span class="token comment"># queries/getWidgets.graphql</span>

<span class="token keyword">query</span> <span class="token definition-query function">GetWidgets</span> <span class="token punctuation">{</span>
  <span class="token comment"># On annote la query avec la directive @client</span>
  <span class="token comment"># pour indiquer qu'on souhaite utiliser un resolver local:</span>
  <span class="token property">getWidgets</span> <span class="token directive function">@client</span> <span class="token punctuation">{</span> <span class="token comment"># &lt;- 👈🏻</span>
    <span class="token property">count</span>
    <span class="token object">rows</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
      <span class="token property">name</span>
      <span class="token keyword">type</span>
      <span class="token property">position</span>
      <span class="token property">starred</span>
      <span class="token property">dataset</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>on définit une liste de resolvers qu'on passera à notre client Apollo :</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="258d1528be9939a4a15397b02fda8bfb"><span class="token comment">// client.ts</span>
<span class="token keyword">import</span> resolvers <span class="token keyword">from</span> <span class="token string">'./resolvers'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  resolvers<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>et on définit le resolver pour le champ <code class="code-inline" id="958ed13ce63d86efb5fcbbe303e48ebb">getWidgets</code> de notre root <code class="code-inline" id="66c1b4c7f3dc385b68a9fa903ccd016d">Query</code> :</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="47ea54a7de01afe54d05dd7254567da9"><span class="token comment">// resolvers.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">type</span> <span class="token class-name">Resolvers</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@apollo/client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fakeWidgetsData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fake/widgets'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  Query<span class="token operator">:</span> <span class="token punctuation">{</span>
    getWidgets<span class="token operator">:</span> fakeWidgetsData<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Resolvers<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> resolvers<span class="token punctuation">;</span></code></pre>
<p>🤲 Voici le code de notre resolver <code class="code-inline" id="f1879903a813f5941141ad4b4731cdbb">fakeWidgetsData</code>:</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="5c9451c112185faf4b8858ff156f2047"><span class="token comment">// hardcoded/widgets.ts</span>

<span class="token comment">// Nos données simulées:</span>
<span class="token keyword">const</span> FakeWidgets <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Widget 1'</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token constant">PIE</span><span class="token punctuation">,</span> position<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> starred<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> dataset<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token comment">/* … */</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// […]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> fakeWidgetsData<span class="token operator">:</span> <span class="token function-variable function">Resolver</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// On retourne une structure correspondant au retour attendu par notre query:</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    __typename<span class="token operator">:</span> <span class="token string">'WidgetList'</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> FakeWidgets<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
    <span class="token comment">// Avec nos lignes de données simulées:</span>
    rows<span class="token operator">:</span> FakeWidgets<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Enfin, nous consommerons cette query dans un composant React, comme nous le ferions pour communiquer avec le serveur:</p>
<pre class="code-multiline language-tsx"><code class="language-tsx" id="8ee0f80f202131a381dab2f9277bdf52"><span class="token comment">// ./pages/widgets.tsx</span>

<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@apollo/client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">GET_WIDGETS</span> <span class="token keyword">from</span> <span class="token string">'./queries/getWidgets.graphql'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Widgets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token constant">GET_WIDGETS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// `data.getWidgets` contient les données simulées</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// […]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<div class="admonition note">
<p>
    Étant donné que nous avons choisi d'annoter l'ensemble de la query <code class="code-inline" id="958ed13ce63d86efb5fcbbe303e48ebb">getWidgets</code> avec la directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code>,
    <strong>aucune requête ne sera envoyée au serveur</strong>.<br>
    Apollo va directement chercher un resolver pour le champ <code class="code-inline" id="958ed13ce63d86efb5fcbbe303e48ebb">getWidgets</code> dans notre objet <code class="code-inline" id="66c1b4c7f3dc385b68a9fa903ccd016d">Query</code> local et retourner
    les données que nous lui avons fournies.
</p>
</div>
<p>Le jour où nous souhaiterons consommer le serveur, <strong>il suffira de retirer la directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code> de notre query</strong>:</p>
<pre class="code-multiline language-diff"><code class="language-diff" id="f291672c0fe7c6012949e307f037cb7f"># queries/getWidgets.graphql

query GetWidgets {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  getWidgets @client {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  getWidgets {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   count
</span><span class="token prefix unchanged"> </span><span class="token line">   rows {
</span><span class="token prefix unchanged"> </span><span class="token line">     …
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>}</code></pre>
<p>✅ La requête sera alors envoyée au serveur et notre resolver local ne sera plus utilisé.</p>
<p>➜ <strong>Cette façon de faire possède ainsi l'avantage de ne pas nécessiter la moindre modification de notre code fonctionnel.</strong></p>
<h3 id="simuler-le-retour-d-une-mutation" class="anchor-title"><a href="#simuler-le-retour-d-une-mutation">Simuler le retour d'une mutation</a></h3>
<p>Imaginons que notre back-end ait défini la mutation pour mettre un widget en favoris, mais que cette fonctionnalité ne
soit pas implémentée. Le serveur accepte un appel à cette mutation, mais n'effectue aucun traitement ni ne retourne
encore aucune donnée.</p>
<p>L'équipe front aimerait néanmoins progresser sur cette fonctionnalité. Elle doit être capable :</p>
<ul>
<li>d'envoyer une mutation</li>
<li>de réagir à la réponse pour refléter les changements dans l'interface </li>
</ul>
<p><em>(à savoir, mettre à jour l'icône d'ajout en favoris et déplacer le widget en haut de liste).</em></p>
<p>Sans que l'implémentation serveur ne soit complétée, nous pouvons fournir nous-mêmes le résultat de cette mutation en
usant de la directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code> :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="5afe0b9420a2e2c559867edc4b6299f3"><span class="token comment"># mutations/toggleWidgetStarred.graphql</span>

<span class="token keyword">mutation</span> <span class="token definition-mutation function">toggleWidgetStarred</span><span class="token punctuation">(</span><span class="token variable variable-input">$widgetId</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment"># Nous allons réellement exécuter cette mutation, </span>
  <span class="token comment"># mais utiliser un resolver local pour définir sa réponse.</span>
  <span class="token property-query property-mutation">toggleWidgetStarred</span><span class="token punctuation">(</span><span class="token attr-name">widgetId</span><span class="token punctuation">:</span> <span class="token variable variable-input">$widgetId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Sur chacun des champs concernés, on ajoute la directive @client:</span>
    <span class="token property">id</span> <span class="token directive function">@client</span>
    <span class="token property">starred</span> <span class="token directive function">@client</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Nous définissons un resolver local pour cette mutation:</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="07a4991069397d6d802b480286d5c75c"><span class="token comment">// resolvers.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toggleWidgetStar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fake/widgets'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// […]</span>
  Mutation<span class="token operator">:</span> <span class="token punctuation">{</span>
    toggleWidgetStar<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Resolvers<span class="token punctuation">;</span></code></pre>
<p>Le resolver prend en paramètre quelques variables utiles, que nous allons utiliser pour générer notre réponse:</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="d6dbdae7da8945c8ced13c11f5413a48"><span class="token keyword">export</span> <span class="token keyword">const</span> toggleWidgetStar<span class="token operator">:</span> <span class="token function-variable function">Resolver</span> <span class="token operator">=</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> variables<span class="token punctuation">,</span> <span class="token punctuation">{</span> cache <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// À partir des données existantes dans le cache, </span>
  <span class="token comment">// on va chercher le widget correspondant à l'ID fourni:</span>
  <span class="token keyword">const</span> widget <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">readFragment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> cache<span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      __typename<span class="token operator">:</span> <span class="token string">'Widget'</span><span class="token punctuation">,</span>
      id<span class="token operator">:</span> variables<span class="token punctuation">.</span>input<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fragment<span class="token operator">:</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token graphql language-graphql">
      <span class="token keyword">fragment</span> <span class="token fragment function">MyWidget</span> <span class="token keyword">on</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
        <span class="token property">id</span>
        <span class="token property">starred</span>
      <span class="token punctuation">}</span>
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// et retourner la réponse attendue avec la nouvelle valeur du champs `starred`:</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>widget<span class="token punctuation">,</span>
    starred<span class="token operator">:</span> <span class="token operator">!</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>starred <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Non seulement nous pouvons alors utiliser cette mutation dans notre application, mais nous pouvons également réagir en
conséquence pour mettre à jour notre cache:</p>
<pre class="code-multiline language-tsx"><code class="language-tsx" id="44dcd2a9e8ed8f638079d55e6e4417f8"><span class="token comment">// ./pages/widgets.tsx</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> useMutation<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">ApolloCache</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@apollo/client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">TOGGLE_WIDGET_STAR</span> <span class="token keyword">from</span> <span class="token string">'./mutations/toggleWidgetStarred.graphql'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Widgets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// […]</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>toggleStarred<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span><span class="token constant">TOGGLE_WIDGET_STAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Au clic sur l'icône de favoris</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleToggleStarred</span> <span class="token operator">=</span> <span class="token punctuation">(</span>widgetId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// on appelle la mutation:</span>
    <span class="token function">toggleStarred</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
      variables<span class="token operator">:</span> <span class="token punctuation">{</span> widgetId <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span>cache<span class="token operator">:</span> <span class="token maybe-class-name">ApolloCache</span><span class="token operator">&lt;</span><span class="token maybe-class-name">GetWidgetsQuery</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Lorsqu'un indicateur passe en favoris,</span>
        <span class="token comment">// on récupère les données présentes dans le cache</span>
        <span class="token keyword">const</span> query <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token method function property-access">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">GET_WIDGETS</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// et on ré-ordonne la liste pour mettre les favoris en haut:</span>
        cache<span class="token punctuation">.</span><span class="token method function property-access">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          query<span class="token operator">:</span> <span class="token constant">GET_WIDGETS</span><span class="token punctuation">,</span>
          data<span class="token operator">:</span> <span class="token punctuation">{</span>
            getWidgets<span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token spread operator">...</span>query<span class="token punctuation">.</span><span class="token property-access">getWidgets</span><span class="token punctuation">,</span>
              rows<span class="token operator">:</span> <span class="token function">sortedWidgets</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token property-access">getWidgets</span><span class="token punctuation">.</span><span class="token property-access">rows</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// […]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>Notre mutation est reçue et exécutée par le serveur, <strong>omettant les champs avec la directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code></strong></li>
<li>Bien que le serveur ne retourne aucune donnée, notre resolver local est appelé car la directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code> est présente
sur l'un des champs attendus en retour de la mutation</li>
<li>Notre resolver accède au cache et s'en sert pour retourner une réponse qui sera <strong>fusionnée</strong> avec l'état existant du
cache Apollo</li>
<li>L'instance de l'indicateur, <em>identifiée et tracée par Apollo via son <code class="code-inline" id="b80bb7740288fda1f201890375a60c8f">id</code></em>, est automatiquement mise à jour dans le
cache. En conséquence, son nouvel état est reflété dans l'interface (<em>l'icône change</em>).</li>
<li>Nous pouvons également réagir suite à la mutation grâce à la clé <code class="code-inline" id="3ac340832f29c11538fbe2d6f75e8bcc">update</code> pour réordonner les indicateurs présents
dans le cache afin de placer les favoris en haut de la liste.</li>
</ul>
<div class="admonition note">
<p>
    <em>Notez au passage cette particularité :</em> nous avons annoté les champs <code class="code-inline" id="b80bb7740288fda1f201890375a60c8f">id</code> et <code class="code-inline" id="dd68bf97c522179d38337a47626e8e47">starred</code> de notre mutation avec la
    directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code>. Pourtant, nous n'avons pas défini de resolver local pour ces champs et c'est à la place le
    resolver de la mutation <code class="code-inline" id="201153965340874427ca398a54d49ece">toggleWidgetStarred</code> qui a été appelé.<br>
    Il aurait tout à fait été possible de définir un resolver pour chacun de ces champs comme nous le verrons dans le
    prochain exemple. Mais nous souhaitons ici réagir à cette mutation précisément.
</p>
</div>
<p><em>De la même façon, nous pourrions simuler le retour de mutations pour ajouter ou supprimer un indicateur et modifier la
liste en cache. Ce qui sera automatiquement reflété dans l'interface avec l'apparition ou la disparition de l'indicateur.</em></p>
<p>Le jour où l'implémentation serveur sera complétée, <strong>il suffira de retirer les directives <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code></strong>.</p>
<p>➜ <strong>Aucun autre changement sur le code fonctionnel ne sera nécessaire et les mises à jour du cache auront été prévues
en amont.</strong></p>
<h3 id="simuler-partiellement-des-donnees" class="anchor-title"><a href="#simuler-partiellement-des-donnees">Simuler partiellement des données</a></h3>
<p>Nous venons de voir qu'il était possible de faire cohabiter des données distantes et locales dans une même query ou
mutation.</p>
<p>Il est possible de profiter de cette fonctionnalité pour surcharger uniquement certains champs d'une query.
Ou encore, de réagir à la présence de certains champs distants pour simuler des données ou non.</p>
<p>Afin d'afficher un graphique représentatif de nos indicateurs, nous allons avoir besoin de données dans le champs
<code class="code-inline" id="3c4d09e4ef50b370ae0efacdb43ec2dd">dataset</code> de chacun d'entre eux.<br>
Il existe en réalité plusieurs types d'indicateurs, avec leur dataset et rendus spécifiques. Mais le back-end — <em>bien
qu'ayant entre-temps mis à jour la query de liste des widgets pour nous retourner des données</em> — ne retourne pour
l'instant rien dans le champ <code class="code-inline" id="3c4d09e4ef50b370ae0efacdb43ec2dd">dataset</code>.</p>
<p>Or l'équipe front aimerait pouvoir avancer sur l'affichage de chacun de ces types de graphiques, sans attendre
l'implémentation du serveur.</p>
<p>Nous allons donc déplacer notre directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code> sur le champ <code class="code-inline" id="3c4d09e4ef50b370ae0efacdb43ec2dd">dataset</code> de notre query <code class="code-inline" id="958ed13ce63d86efb5fcbbe303e48ebb">getWidgets</code> :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="bbc84d657985e6108709cf9b680959a6"><span class="token comment"># queries/getWidgets.graphql</span>

<span class="token keyword">query</span> <span class="token definition-query function">getWidgets</span> <span class="token punctuation">{</span>
  <span class="token object">getWidgets</span> <span class="token punctuation">{</span>
    <span class="token property">count</span>
    <span class="token object">rows</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
      <span class="token property">name</span>
      <span class="token keyword">type</span>
      <span class="token property">position</span>
      <span class="token property">starred</span>
      <span class="token property">dataset</span> <span class="token directive function">@client</span> <span class="token comment"># &lt;- 👈🏻</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>A partir de là, différentes solutions s'offrent à nous 👇🏻</p>
<h4 id="surcharge-par-champs" class="anchor-title"><a href="#surcharge-par-champs">Surcharge par champs</a></h4>
<p>Cette fois-ci, nous allons définir un resolver pour les champs du type <code class="code-inline" id="6ed562a0d4381eef12d92c87520f3208">Widget</code> et non pour une query ou une mutation :</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="2514c9466a69021e850f5470d2c9e311"><span class="token comment">// resolvers.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">type</span> <span class="token class-name">Resolvers</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@apollo/client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fakeWidgetsDataset <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fake/widgets'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  Widget<span class="token operator">:</span> <span class="token punctuation">{</span>
    dataset<span class="token operator">:</span> fakeWidgetsDataset<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Resolvers<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> resolvers<span class="token punctuation">;</span></code></pre>
<p>Le resolver ainsi appelé accède aux données transmises par le serveur et peut retourner un dataset simulé :</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="edddf0e6714daa4ed8e9a02184815fac"><span class="token keyword">export</span> <span class="token keyword">const</span> fakeWidgetsDataset<span class="token operator">:</span> Resolver <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token comment">// le 1er argument fourni à notre resolver est l'objet retourné par le resolver du champ parent.</span>
  <span class="token comment">// Dans notre cas, il s'agit du widget retourné par le serveur dans notre query.</span>
  widget<span class="token operator">:</span> Widget<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span>type <span class="token operator">===</span> WidgetType<span class="token punctuation">.</span><span class="token constant">COMPLEX</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// On retourne un dataset spécifique pour les indicateurs de type complexe</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      __typename<span class="token operator">:</span> <span class="token string">'ComplexDataset'</span><span class="token punctuation">,</span>
      <span class="token comment">// données simulées pour un dataset complexe</span>
      <span class="token comment">// […]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Autrement, on retourne un dataset simple</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    __typename<span class="token operator">:</span> <span class="token string">'SimpleDataset'</span><span class="token punctuation">,</span>
    <span class="token comment">// données simulées pour un dataset simple</span>
    labels<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Nombre de visites'</span><span class="token punctuation">,</span> <span class="token string">'Nombre de conversions'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">524</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<ul>
<li>Tous les indicateurs affichés dans notre liste auront désormais un dataset fictif</li>
<li>Il est possible de réagir en fonction d'autres champs de l'objet parent (<em>ici, l'indicateur</em>) pour retourner des données
différentes (<em>par exemple en fonction de son <code class="code-inline" id="599dcce2998a6b40b1e38e8c6006cb0a">type</code></em>).</li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Attention</p>
<p>
    Cependant, le champ <code class="code-inline" id="3c4d09e4ef50b370ae0efacdb43ec2dd">dataset</code> de notre query <code class="code-inline" id="958ed13ce63d86efb5fcbbe303e48ebb">getWidgets</code> étant annoté avec la directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code>, <strong>celui-ci n'a
    jamais été transmis au serveur</strong>. Ainsi, même si le serveur était en mesure de nous retourner des données pour ce
    champ, elles n'arriveront jamais jusqu'à notre client et au sein de l'argument <code class="code-inline" id="9d2b1ad5bbc16c44d49116dc213c53f2">widget</code> de notre resolver.
</p>
</div>
<h4 id="surcharge-d-une-partie-de-la-query" class="anchor-title"><a href="#surcharge-d-une-partie-de-la-query">Surcharge d'une partie de la query</a></h4>
<p>Comme pour notre mutation, nous pourrions également définir un resolver pour notre query <code class="code-inline" id="958ed13ce63d86efb5fcbbe303e48ebb">getWidgets</code> :</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="18a6ba0151ecd014aaec32de057fbc35"><span class="token comment">// resolvers.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">type</span> <span class="token class-name">Resolvers</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@apollo/client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> partiallyFakedWidgetsData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fake/widgets'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  Query<span class="token operator">:</span> <span class="token punctuation">{</span>
    getWidgets<span class="token operator">:</span> partiallyFakedWidgetsData<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Resolvers<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> resolvers<span class="token punctuation">;</span></code></pre>
<p>et dans notre resolver, compléter la réponse du serveur:</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="74ce3e7f0713422e8da7c9ddde9b1f11"><span class="token keyword">export</span> <span class="token keyword">const</span> partiallyFakedWidgetsData<span class="token operator">:</span> Resolver <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token comment">// le 1er argument fourni à notre resolver est la réponse de notre query.</span>
  <span class="token comment">// Dans notre cas, il s'agit du widget retourné par le serveur dans notre query.</span>
  data<span class="token operator">:</span> GetWidgetsQuery<span class="token punctuation">,</span>
  variables<span class="token punctuation">,</span> <span class="token comment">// les variables de la query</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Nous devons retourner la structure attendue par notre query, </span>
  <span class="token comment">// à savoir le contenu de `data.getWidgets`:</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>data<span class="token punctuation">.</span>getWidgets<span class="token punctuation">,</span>
    <span class="token comment">// Complété avec des datasets simulés pour chaque widget:</span>
    rows<span class="token operator">:</span> data<span class="token punctuation">.</span>getWidgets<span class="token punctuation">.</span>rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>widget<span class="token punctuation">,</span>
      dataset<span class="token operator">:</span> <span class="token function">fakeDatasetForType</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<ul>
<li>Cette façon de faire nous permet d'accéder à davantage de niveaux d'éléments de données</li>
<li>Il est possible de fournir plusieurs champs locaux à la fois et gérer d'éventuelles résolutions de dépendances entre eux.</li>
<li>Le second argument fourni à notre resolver est l'ensemble des variables de la query.</li>
</ul>
<p>Enfin, il est possible au travers d'une petite astuce de ne simuler des données que pour les champs absents de la réponse
du serveur.  </p>
<h3 id="astuce-ne-simuler-que-les-donnees-absentes" class="anchor-title"><a href="#astuce-ne-simuler-que-les-donnees-absentes">Astuce : ne simuler que les données absentes</a></h3>
<p>Comme évoqué précédemment, le champ <code class="code-inline" id="3c4d09e4ef50b370ae0efacdb43ec2dd">dataset</code> de notre query <code class="code-inline" id="958ed13ce63d86efb5fcbbe303e48ebb">getWidgets</code> étant annoté avec la directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code>,
celui-ci n'a jamais été transmis au serveur et ses données n'aboutiront donc jamais dans notre resolver.</p>
<p>Nous pourrions alors requêter à la fois un champ <code class="code-inline" id="3c4d09e4ef50b370ae0efacdb43ec2dd">dataset</code> local et un champ distant :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="a22f6d7dfbafbb68db22579836393e6a"><span class="token comment"># queries/getWidgets.graphql</span>

<span class="token keyword">query</span> <span class="token definition-query function">getWidgets</span> <span class="token punctuation">{</span>
  <span class="token object">getWidgets</span> <span class="token punctuation">{</span>
    <span class="token property">count</span>
    <span class="token object">rows</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
      <span class="token property">name</span>
      <span class="token keyword">type</span>
      <span class="token property">position</span>
      <span class="token property">starred</span>
      <span class="token property">dataset</span> <span class="token comment"># &lt;- 👈🏻 Les données peuvent être présent ou absentes selon la progression de l'équipe back</span>
      <span class="token property">hardcodedDataset</span> <span class="token directive function">@client</span> <span class="token comment"># &lt;- 👈🏻 Nous utilisons un resolver local pour fournir des données simulées</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>et surcharger le champ <code class="code-inline" id="3c4d09e4ef50b370ae0efacdb43ec2dd">dataset</code> avec nos données simulées si et seulement si celui-ci est absent de la réponse du
serveur :</p>
<pre class="code-multiline language-typescript"><code class="language-typescript" id="996e2b8f454525f4def8d4f4966f9e58"><span class="token keyword">export</span> <span class="token keyword">const</span> partiallyFakedWidgetsData<span class="token operator">:</span> <span class="token function-variable function">Resolver</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  data<span class="token operator">:</span> GetWidgetsQuery<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>data<span class="token punctuation">.</span>getWidgets<span class="token punctuation">,</span>
    rows<span class="token operator">:</span> data<span class="token punctuation">.</span>getWidgets<span class="token punctuation">.</span>rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>widget<span class="token punctuation">,</span>
      <span class="token comment">// Le champ `dataset` fait partie des champs distants potentiellement retournés par le serveur,</span>
      <span class="token comment">// suivant l'état d'avancement de son implémentation.</span>
      <span class="token comment">// Mais si celui-ci est absent, on retourne un dataset simulé:</span>
      dataset<span class="token operator">:</span> widget<span class="token punctuation">.</span>dataset <span class="token operator">??</span> <span class="token function">fakeDatasetForType</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>➜ Une fois l'entièreté des données retournées par le serveur, il suffira de retirer le champ dupliqué et sa
directive <code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code> de notre query.</p>
<h2 id="avantages-et-comparaisons" class="anchor-title"><a href="#avantages-et-comparaisons">Avantages et comparaisons</a></h2>
<ul>
<li>Les resolvers locaux offrent à une équipe front la possibilité de <strong>simuler tout ou partie d'une API</strong> et de
poursuivre le développement de son fonctionnel <strong>sans attendre que le serveur ait finalisé son implémentation</strong>.</li>
<li>Ils permettent de faire cohabiter des données simulées pour une portion de l'API tout en utilisant le véritable
serveur pour d'autres.</li>
<li>Ils ne requièrent <strong>aucun changement structurel</strong> notable dans l'application et ne rentrent pas en conflit avec le
<strong>code fonctionnel</strong>.</li>
<li>Les effets des interactions avec les données et l'UI sont répercutés et testables avant même que le serveur ne soit
prêt, grâce aux mises à jour des données dans le cache Apollo.</li>
<li>Le code produit est <strong>facilement débrayable</strong> une fois le serveur prêt, simplement en supprimant les directives
<code class="code-inline" id="bf8e6a25e328d202e9f1634545f3575a">@client</code> des queries et mutations.</li>
</ul>
<p>D'autres solutions peuvent répondre au besoin de simuler des données :</p>
<ul>
<li>Le <a href="https://www.apollographql.com/docs/react/development-testing/testing/" target="_blank">composant <code class="code-inline" id="2883c7e166533aad5f822233c93550b4">MockedProvider</code></a> d'Apollo, qui
permet de fournir des données fictives en réponse à des queries dans les tests.<br>
Celui-ci remplace entièrement le provider habituel et ne permet pas de faire cohabiter des portions d'API simulées
avec une API réelle.<br>
En outre, ce provider n'a été pensé qu'à des fins de tests unitaires.</li>
<li>Il est possible d'<a href="https://www.apollographql.com/docs/react/local-state/local-resolvers/#initializing-the-cache" target="_blank">initialiser un cache pré-peuplé</a> au démarrage de l'application.<br>
Cela permet de fournir un état initial de l'application avec des données fictives, mais ne permet pas à lui seul de répondre dynamiquement à des interactions, notamment des mutations.</li>
</ul>
<p>Aucune de ces solutions n'est aussi complète, flexible et peu intrusive que les resolvers locaux Apollo.</p>
<h2 id="disclaimer" class="anchor-title"><a href="#disclaimer">Disclaimer</a></h2>
<p>Bon… il y a un hic. 😬</p>
<p>Les resolvers locaux sont une fonctionnalité <a href="https://github.com/apollographql/apollo-client/issues/10061" target="_blank"><strong>dépréciée</strong></a>
d'Apollo Client 3.
Cela veut dire que la prochaine version majeure, Apollo Client 4, a toutes les chances de ne plus les inclure de base.</p>
<p>Cette <a href="https://github.com/apollographql/apollo-client/issues/7072" target="_blank">décision est débattue</a> depuis un long moment par la
communauté et certains usages repensés. La documentation officielle suggère notamment de remplacer les resolvers locaux
par des <a href="https://www.apollographql.com/docs/react/local-state/managing-state-with-field-policies" target="_blank">field policies</a> et
<a href="https://www.apollographql.com/docs/react/local-state/reactive-variables/" target="_blank">reactive variables</a> pour ce qui est de
définir un état purement local.</p>
<p>La fonctionnalité de resolver côté client devrait néanmoins aboutir en un <a href="https://github.com/apollographql/apollo-client/issues/10060" target="_blank"><code class="code-inline" id="2a304a1348456ccd2234cd71a81bd338">link</code> spécifique</a>
permettant les mêmes usages et assurant malgré tout un avenir à ce concept.</p>
<div class="admonition note">
<p class="admonition-title">« My 2 cents »</p>
<p>
    Quoiqu'il advienne, cela ne devrait néanmoins pas vous prévenir d'utiliser cette fonctionnalité <strong>pour le cas
    d'usage spécifique visant à temporairement simuler une partie de votre API</strong>. En effet, ces resolvers sont un tel
    atout qu'il serait dommage de s'en priver et ils n'entâchent en rien la pérennité de votre code dans la mesure où
    leur utilisation est non intrusive et temporaire.
</p>
</div>
<h2 id="conclusion" class="anchor-title"><a href="#conclusion">Conclusion</a></h2>
<p>Les resolvers locaux sont un outil formidable pour les équipes front-end qui souhaitent avancer de manière autonome et
produire rapidement du code pérenne malgré l'utilisation de données fictives.</p>
<p>Pour certains, il s'agit d'un moyen de prototyper entièrement une application en concevant directement un client
encore agnostique de son serveur GraphQL :</p>
<blockquote>
<p>The reason I find local resolvers such a powerful and preferential solution is that it allows me to build my client (
almost entirely) agnostic of where the graphql service exists.
<cite>— <a href="https://github.com/apollographql/apollo-client/issues/7072#issue-708534612" target="_blank">Vigie (comment)</a></cite></p>
</blockquote>
<p>Pour <a href="https://trello.com/" target="_blank">Trello</a>, c'est une façon élégante de migrer progressivement d'une API Rest vers GraphQL, en
écrivant un schéma GraphQL client et des resolvers faisant le pont avec l'API Rest existante :</p>
<blockquote>
<p>This approach is far more flexible than apollo-link-rest, and allows you to encapsulate all knowledge of the REST API
to your resolvers. Additionally, if your server implementation is based on JavaScript, this can become a great starting
point for a Node-based GraphQL server.
<cite>— <a href="https://www.atlassian.com/engineering/a-look-at-trello-adopting-graphql-and-apollo-in-a-legacy-application#achieving-greater-flexibility-with-local-resolvers" target="_blank">Cameron Fletcher - Trello</a></cite></p>
</blockquote>
<h2 id="liens-annexes" class="anchor-title"><a href="#liens-annexes">Liens annexes</a></h2>
<p>Les sources, documentations et discussions suivantes ont été consultées pour la rédaction de cet article :</p>
<ul>
<li><a href="https://www.apollographql.com/blog/announcing-apollo-client-2-5-c12230cabbb7" target="_blank">Apollo dev blog: Announcing Apollo Client 2.5</a></li>
<li><a href="https://gbenussi.medium.com/how-to-mock-fields-using-apollo-client-%EF%B8%8F-7dba9112453" target="_blank">How to mock fields using Apollo client ⚡️</a></li>
<li><a href="https://www.north-47.com/graphql-mock-data-using-apollo-local-resolvers-apollo-inmemory-cache/" target="_blank">Graphql - Mock data using apollo local resolvers &amp; apollo inmemory cache</a></li>
<li><a href="https://www.atlassian.com/engineering/a-look-at-trello-adopting-graphql-and-apollo-in-a-legacy-application" target="_blank">A look at Trello: adopting GraphQL and Apollo in a legacy application</a></li>
</ul>
<p>Pour aller plus loin quant à l'avenir des resolvers locaux :</p>
<ul>
<li><a href="https://github.com/apollographql/apollo-client/issues/10061" target="_blank">Remove Local resolver support from the core of Apollo Client #10061</a></li>
<li><a href="https://github.com/apollographql/apollo-client/issues/7072" target="_blank">Deprecation of local resolvers makes adopting GQL more difficult #7072</a></li>
<li><a href="https://github.com/apollographql/apollo-client/issues/10060" target="_blank">Release local resolvers back into the link chain #10060</a></li>
<li><a href="https://github.com/apollographql/apollo-feature-requests/issues/383" target="_blank">Read method on field's TypePolicy should allow async behaviour #383</a></li>
</ul>
                                                                </main>
            <aside class="article-content__aside">
                                    <a href="https://twitter.com/intent/like?tweet_id=1810590609163309213" class="kudo" target="_blank">
                        <span class="kudo__button" aria-hidden="true"></span>
                        <span class="screen-reader">Cet article m’a été utile</span>
                        <span class="kudo__label" aria-hidden="true">Kudos</span>
                    </a>
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a href="/elao_/pr/644/blog/auteur/msteinhausser">
                                <img     src="/elao_/pr/644/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg"
    srcset="
        /elao_/pr/644/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg 1x,
        /elao_/pr/644/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/079e97b32e0b5c6cbde07e847b4423d4.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a href="/elao_/pr/644/blog/auteur/msteinhausser">
                                <strong>Maxime Steinhausser</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                            <a href="https://twitter.com/ogizanagi" class="social social--small">
                                    <i class="icon icon--x" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Twitter de Maxime Steinhausser</span>
                                </a>
                                                                                        <a href="https://github.com/ogizanagi " class="social social--small">
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Maxime Steinhausser</span>
                                </a>
                                                                                        <a href="https://shiningame.maxime-steinhausser.fr/" class="social social--small">
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Maxime Steinhausser</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
                            <div class="brick-comment">
                    <p class="title">Commenter</p>
                    <p>
                        Des commentaires ?
                        <a href="https://twitter.com/Elao/status/1810590609163309213" target="_blank" class="animated-link animated-link--light">
                            Poursuivons la discussion sur twitter !
                        </a>
                    </p>
                    <div id="tweet-container" class="tweet-container" data-tweet-id="1810590609163309213"></div>
                </div>
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/node22/content/blog/dev/apollo-mock-data-local-resolvers.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/644/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/644/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/644/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/644/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/644/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/644/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/644/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                                                <a href="/elao_/pr/644/recrutement">
                            Nous recrutons
                                                            <span class="bullet">2</span>
                                                    </a>
                    </li>
                    <li>
                        <a href="/elao_/pr/644/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/644/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            Twitter
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/mycompany/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/pr/644/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2024 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/644/legal">Mentions légales</a>
            <a href="/elao_/pr/644/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
