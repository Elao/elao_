<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Symfony 2 – L’injection de dépendances</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/652/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/652/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/652/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/652/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/652/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/652/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/652/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Symfony 2 – L’injection de dépendances" />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/652/blog/dev/symfony-2-linjection-de-dependances" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Symfony 2 – L’injection de dépendances" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Symfony 2 – L’injection de dépendances" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/652/blog/dev/symfony-2-linjection-de-dependances" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/d4c6da7a57203cee1bab2b115c6b6c66.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Symfony 2 – L’injection de dépendances">
            <meta property="twitter:description" content="Symfony 2 – L’injection de dépendances">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/c6b428e00dc9710a5975341d3cc767a3.jpg">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/pr/652/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Symfony 2 – L’injection de dépendances",
    "image": [
        "https://elao.github.io/elao_/pr/652/blog/dev/content/images/blog/thumbnails/event-dispatcher.jpg"
    ],
    "datePublished": "2010-06-03T00:00:00+00:00",
    "dateModified": "2010-06-03T00:00:00+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Vincent Bouzeran",
            "url": "https://elao.github.io/elao_/pr/652/equipe"
        }
    ],
    "keywords": [
        "Symfony",
        "Php"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/652/build/app.1d0f6170.css">
        
                        <script src="/elao_/pr/652/build/runtime.fb7e722e.js" defer></script><script src="/elao_/pr/652/build/552.3082ae9c.js" defer></script><script src="/elao_/pr/652/build/769.7dfbbe52.js" defer></script><script src="/elao_/pr/652/build/app.d906f729.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;652&#x5C;&#x2F;build&#x5C;&#x2F;see.ace7bf9f.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;652&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;652&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;652&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;652&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/652/">
                        <span class="screen-reader">Symfony 2 – L’injection de dépendances</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/652/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/652/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/652/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/652/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/652/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/pr/652/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/652/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/652/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/652/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/652/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/652/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/652/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/652/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/pr/652/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/652/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/652/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/652/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/652/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Symfony 2 – L’injection de dépendances</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/d3a4fc477efb142aba91b2caef57c31e.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/d3a4fc477efb142aba91b2caef57c31e.jpg') 1x,
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/68cf96e15c212d77a344fed9e884d264.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/d3a4fc477efb142aba91b2caef57c31e.jpg') 1x,
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/68cf96e15c212d77a344fed9e884d264.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/d3a4fc477efb142aba91b2caef57c31e.jpg') 1x,
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/68cf96e15c212d77a344fed9e884d264.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/d3a4fc477efb142aba91b2caef57c31e.jpg') 1x,
        url('/elao_/pr/652/%2E%2E/../resized/content/images/blog/thumbnails/event-dispatcher.jpg/68cf96e15c212d77a344fed9e884d264.jpg') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a>
                                    <img     src="/elao_/pr/652/%2E%2E/../resized/content/images/members/avatars/vbouzeran.jpg/279a73f5865daa35af3ee9a0d54c28e8.jpg"
    srcset="
        /elao_/pr/652/%2E%2E/../resized/content/images/members/avatars/vbouzeran.jpg/279a73f5865daa35af3ee9a0d54c28e8.jpg 1x,
        /elao_/pr/652/%2E%2E/../resized/content/images/members/avatars/vbouzeran.jpg/3021268503945d1bdd2cc815a27de002.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/pr/652/blog/auteur/vbouzeran">
                                    <strong>Vincent Bouzeran</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>3 juin 2010</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Symfony 2 – L’injection de dépendances</h1>
                <p>Symfony 2 – L’injection de dépendances</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/652/blog/tag/symfony" rel="nofollow">#Symfony</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/652/blog/tag/php" rel="nofollow">#Php</a>
                        </li>
                                    </ul>
            </div>
        </div>

        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <p><strong>Avertissement :</strong>
Depuis la rédaction de cet article sur l'injection de dépendances, le coeur de Symfony2 a évolué de façon notable, en particulier certaines classes du répertoire <strong>DependencyInjection</strong> mentionnées dans cet article ont été renommées, révisées, ou refondues. Toutefois, les principes généraux décrits dans cet article restent d'actualité.</p>
<img src="/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/dependency-injection-symfony.png/1a494928b4f8dc7699626d61ac59cff9.png" alt='dependency injection symfony Symfony 2 Linjection de dépendances" width="278" height="236' title='dependency injection symfony Symfony 2 Linjection de dépendances" width="278" height="236' srcset="/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/dependency-injection-symfony.png/1a494928b4f8dc7699626d61ac59cff9.png 1x,
/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/dependency-injection-symfony.png/f5aae7e59bd125429b42a74171636056.png 2x," id="dependency-injection-symfony-symfony-2-linjection-de-dependances-width-278-height-236">
<p>Cet article est le premier d'une série à venir sur Symfony 2. Pour commencer, je vous invite à télécharger la <a href="http://symfony-reloaded.org/code" target="_blank">sandbox</a> de Symfony 2. J'ai décidé de commencer par l'injection de dépendances car il s'agit d'un composant clé de Symfony 2, et que la bonne compréhension de cette nouvelle version du Framework doit forcément en passer par là. L'injection de dépendance est réellement au coeur du Framework.</p>
<p>Nous allons commencer par tenter d'éclaircir cette notion (ou ce design pattern), puis nous verrons plus concrètement l'implémentation qui en est faite au sein de Symfony 2. Commençons par une petite définition.</p>
<blockquote>
<p>Définition Wikipedia:</p>
<p>"<strong>L'injection de dépendances</strong> (Dependency Injection) est un mécanisme qui permet d'implanter le principe de l'Inversion de contrôle. Il consiste à créer dynamiquement (injecter) les dépendances entre les différentes classes en s'appuyant généralement sur une description (fichier de configuration). Ainsi les dépendances entre composants logiciels ne sont plus exprimées dans le code de manière statique mais déterminées dynamiquement à l'exécution."</p>
</blockquote>
<h3 id="qu-est-ce-que-l-injection-de-dependances" class="anchor-title"><a href="#qu-est-ce-que-l-injection-de-dependances">Qu'est ce que l'injection de dépendances ?</a></h3>
<p>En programmation objet, et particulièrement avec les Frameworks, nous sommes souvent amenés à manipuler un grand nombre de classes d'objet différentes. Ces différents objets sont chargés de fournir une fonctionnalité ou un "service". Dans une application standard, nous serons par exemple amenés à manipuler :</p>
<ul>
<li>Un objet <strong>User</strong>, supposé représenter l'utilisateur connecté à l'application</li>
<li>Un objet <strong>Session</strong>, pour la gestion de la session de l'utilisateur</li>
<li>Un objet <strong>Requete</strong>, représentant la requête envoyée par un client</li>
<li>Un objet <strong>Réponse</strong>, pour la réponse que l'application va renvoyer</li>
<li>Un objet <strong>Log</strong>, pour pouvoir gérer des logs</li>
<li>Un objet <strong>Mailer</strong>, pour pouvoir envoyer des mails</li>
<li>etc ...</li>
</ul>
<p>La nécessité de l'injecteur de dépendances provient, d'une part, du fait que certains de ces objets sont liés entre eux, ou plutôt "dépendants" les uns des autres, d'autre part, que les objets sont de plus en plus découplés et scindés en classes bien particulières. Par exemple, le service "<strong>Mailer</strong>" utilisera peut être le service "<strong>Log</strong>" pour enregistrer les mails qui sont envoyés par l'application.</p>
<p>L'idée de l'injection de dépendances est d'utiliser un fichier de configuration pour auto-générer une classe (un "container") qui contiendra des méthodes nous permettant d'accéder à ces services ; elle contiendra l'initialisation des services (via l'instanciation de la classe qui les représente), gérera les dépendances de ces services (via les constructeurs ou l'appel de méthodes), la configuration des services, etc....</p>
<p>Pour illustrer ce concept, voyons un petit exemple.</p>
<p>Imaginons que nous ayons trois services :</p>
<ul>
<li>un mailer (chargé d'envoyer des mails)</li>
<li>un logger (chargé d'enregistrer des logs)</li>
<li>un router (chargé du routing)</li>
</ul>
<p>L'injecteur de dépendances pourrait ressembler à quelque chose comme ça :</p>
<h4 id="fichier-de-configuration" class="anchor-title"><a href="#fichier-de-configuration">Fichier de configuration</a></h4>
<pre class="code-multiline"><code id="f794ccffe4fc5f9fe5f66c00566abb74">* Service 'mailer'
- Utiliser la classe 'MonMailer'
- Passer le service 'logger' dans son constructeur
- Appeler la méthode 'initialiser'* Service 'logger'
- Utiliser la classe 'MonLogger'* Service 'routeur'
- Utiliser la classe 'MonRouteur'
- Appeler la méthode 'setLogger' en lui passant le service 'logger' en paramètre</code></pre>
<h4 id="container-genere" class="anchor-title"><a href="#container-genere">Container généré</a></h4>
<pre class="code-multiline language-php"><code class="language-php" id="6ba0a394293d1c77f83955b213eb6dc3"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getServiceMailer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token variable">$service</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MonMailer</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getServiceLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$service</span><span class="token operator">-&gt;</span><span class="token function">initialiser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$mailer</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getServiceLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token variable">$service</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MonLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$service</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getServiceRouteur</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token variable">$service</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MonRouteur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$service</span><span class="token operator">-&gt;</span><span class="token function">setLogger</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getServiceLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$service</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>L'injection de dépendances permet donc une gestion beaucoup plus claire et souple de ces différents "services". En modifiant ce fichier de configuration nous pourrions très simplement :</p>
<ul>
<li>Changer la classe utilisée pour représenter un service</li>
<li>Ajouter un service</li>
<li>Modifier / Ajouter des dépendances</li>
</ul>
<h3 id="symfony-1-x-et-le-factories-yml" class="anchor-title"><a href="#symfony-1-x-et-le-factories-yml">Symfony 1.x et le factories.yml</a></h3>
<p>A l'origine, sous Symfony 1.x, ce qui remplaçait plus ou moins l'injecteur de dépendances était le fichier <strong>factories.yml</strong> avec comme container l'objet <strong>sfContext</strong>. Ce fichier était chargé en cache (<strong>factories.yml.php</strong>) et les différents 'services' inclus dans l'objet <strong>sfContext</strong> au travers de sa propriété <strong>factories</strong>.</p>
<pre class="code-multiline language-php"><code class="language-php" id="1b093262e3737cf80bc6bf23d11346f1"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">sfContext</span> <span class="token keyword">implements</span> <span class="token class-name">ArrayAccess</span>
<span class="token punctuation">{</span>
  <span class="token keyword">protected</span>
  <span class="token variable">$dispatcher</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">,</span>
  <span class="token variable">$configuration</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">,</span>
  <span class="token variable">$mailerConfiguration</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token variable">$factories</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">.</span>
  <span class="token doc-comment comment">/**
  * Loads the symfony factories.
  */</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">loadFactories</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token operator">.</span>
    <span class="token comment">// include the factories configuration</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">configuration</span><span class="token operator">-&gt;</span><span class="token function">getConfigCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">checkConfig</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config/factories.yml'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Le fichier <strong>factories.yml</strong> était géré par la classe <strong>sfFactoryConfigHandler</strong> et aboutissait dans le cache au fichier <strong>factories.yml.php</strong> qui se contentait d'enrichir le tableau <strong>$factories</strong> du <strong>sfContext</strong>.</p>
<pre class="code-multiline language-php"><code class="language-php" id="1ee1f57367f6f6394f4d7b64a202a26c"><span class="token variable">$class</span> <span class="token operator">=</span> <span class="token scope">sfConfig<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sf_factory_controller'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sfFrontWebController'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">factories</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'controller'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$class</span> <span class="token operator">=</span> <span class="token scope">sfConfig<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sf_factory_request'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sfWebRequest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">factories</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span></code></pre>
<p>Les différents services étaient ensuite accessibles au travers du *sfContext :</p>
<pre class="code-multiline language-php"><code class="language-php" id="ac713d12390dbbde68633120ea8805a4"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">sfContext</span> <span class="token keyword">implements</span> <span class="token class-name">ArrayAccess</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">...</span><span class="token operator">.</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></span></code></pre>
<h3 id="symfony-2-et-l-injection-de-dependances" class="anchor-title"><a href="#symfony-2-et-l-injection-de-dependances">Symfony 2 et l'injection de dépendances</a></h3>
<p>Nous arrivons maintenant à la partie intéressante: L'implémentation de l'injection de dépendances dans Symfony 2.
En premier lieu, je vous conseille vivement la lecture de la documentation de Fabien Potencier dédiée au composant:
<a href="http://components.symfony-project.org/dependency-injection/trunk/book/00-Introduction" target="_blank">Symfony Dependency Injection</a> (il s'agit du composant php 5.2, mais la documentation est toujours d'actualité dans le sens où le fonctionnement est identique).</p>
<p>Jetons un oeil aux sources du composant (<em>/sandbox/src/vendor/symfony/src/Symfony/Components/DependencyInjection</em>) :</p>
<img src="/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/di-folder.png/913e46bf3ada1347c4bb359dac1f0b19.png" alt='di folder Symfony 2   Linjection de dépendances" width="284" height="253' title='di folder Symfony 2   Linjection de dépendances" width="284" height="253' srcset="/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/di-folder.png/913e46bf3ada1347c4bb359dac1f0b19.png 1x,
/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/di-folder.png/41b539f822c66f11775ba7b2f4d6bf75.png 2x," id="di-folder-symfony-2-linjection-de-dependances-width-284-height-253">
<ul>
<li>Le répertoire <strong>*Dumper<strong> <em>va contenir les classes permettant de dumper un </em></strong>Builder*</strong> sous un format spécifique (Yaml, Xml, PHP, Graphviz).</li>
<li>Le répertoire <strong><em>Loader</em></strong> var contenir les classes permettant de charger des <strong><em>BuilderConfiguration</em></strong> à partir de formats spécifiques (Yaml, Xml, Ini)</li>
<li><strong><em>Container</em></strong> est notre classe de base, ie le container qui va contenir les différents services et les paramètres associés.</li>
<li><strong><em>Builder</em></strong> est une classe qui étend <strong><em>Container</em></strong> et qui va permettre d'auto-générer le <strong><em>Container</em></strong> à partir de la configuration, elle va consommer des objets de la classe <strong><em>BuilderConfiguration</em></strong> afin d'enrichir le <strong><em>Container</em></strong>.</li>
<li><strong><em>BuilderConfiguration</em></strong> est la classe qui permet de configurer le <strong><em>Builder</em></strong>. Les objets <strong><em>BuilderConfiguration</em></strong> vont contenir des définitions de services, des ressources nécessaires au fonctionnement des services déclarés, etc...</li>
<li><strong><em>Definition</em></strong> est la classe qui représente la définition d'un service. C'est à partir des objets de cette classe que le builder va pouvoir construire les services.</li>
</ul>
<p>Le fonctionnement est somme toute assez simple. Les différents loaders vont permettre de générer des objets du type BuilderConfiguration (qui contiendront des objets Definition) qui seront mergés au sein du Builder pour aboutir à notre Container. Les dumpers permettront de faire l'opération inverse, à savoir : générer un fichier de définitions pour les formats Yaml et Xml, un output Graphviz et enfin un objet php Container en ce qui concerne le dumper PHP.
Un schéma valant mieux qu'un long discours, on peut synthétiser le fonctionnement comme suit :
Note: Le loader de fichiers .ini n'a pas été représenté puisqu'il ne permet que de définir des paramètres.</p>
<img src="/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/injection-dependances.png/464d090d7ab98e700f02b95d372865a1.png" alt='injection dependances Symfony 2   Linjection de dépendances" width="846" height="468' title='injection dependances Symfony 2   Linjection de dépendances" width="846" height="468' srcset="/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/injection-dependances.png/464d090d7ab98e700f02b95d372865a1.png 1x,
/elao_/pr/652/%2E%2E/../resized/content/images/blog/2010/injection-dependances.png/c8330e3c2de1b08ee4238da356176b4b.png 2x," id="injection-dependances-symfony-2-linjection-de-dependances-width-846-height-468">
<p><strong>Le dumper Graphviz</strong>: Ce dumper a pour objectif de générer un dump exploitable par le logiciel <a href="http://graphviz.org/" target="_blank">Graphviz</a> ; il va nous permettre d'obtenir un graphique représentant nos services et leurs dépendances.
<strong><strong>Le cache:</strong></strong> Afin d'accélérer le fonctionnement des applications utilisant l'injection de dépendances, il est évident que les différents fichiers de configuration ne seront pas reparsés à chaque appel. En réalité, le container sera dumpé sous la forme d'une classe PHP et mise en cache.</p>
<p>Attardons nous un peu sur ces fameuses définitions de services qui sont un peu la pierre angulaire de l'injection de dépendances.</p>
<table style="width: 100%;" border="0">
  <tr>
    <th colspan="2">
      Définition d'un service (La classe Definition)
    </th>
  </tr>

  <tr>
    <td>
      <span style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 13px; line-height: 19px;">$class</span>
    </td>

    <td>
      Il s'agit de la classe de base représentant le service
    </td>
  </tr>

  <tr>
    <td>
      <span style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 13px; line-height: 19px;">$file</span>
    </td>

    <td>
      Eventuel fichier à inclure avant de déclarer le fichier
    </td>
  </tr>

  <tr>
    <td>
      <span style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 13px; line-height: 19px;">$constructor</span>
    </td>

    <td>
      Le constructeur de la classe représentant le service
    </td>
  </tr>

  <tr>
    <td>
      <span style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 13px; line-height: 19px;">$arguments</span>
    </td>

    <td>
      Les arguments à passer au constructeur
    </td>
  </tr>

  <tr>
    <td>
      <span style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 13px; line-height: 19px;">$shared</span>
    </td>

    <td>
      Booléen définissant si le service est partagé (singleton) ou réinstancié quand on y accède
    </td>
  </tr>

  <tr>
    <td>
      <span style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 13px; line-height: 19px;">$calls</span>
    </td>

    <td>
      Des éventuelles méthodes et leurs paramètres à appeler après avoir initialisé le service
    </td>
  </tr>

  <tr>
    <td>
      <span style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 13px; line-height: 19px;">$annotations</span>
    </td>

    <td>
      Annotations associées au service (nous y reviendrons plus tard)
    </td>
  </tr>
</table>
<p>A partir de ces informations, le builder sera capable de recréer la méthode permettant d'accéder au service.
De façon très synthétique et grossière, la définition nous permettrait d'aboutir à une méthode comme ceci:</p>
<pre class="code-multiline language-php"><code class="language-php" id="3ab82ac5281b69656e9032b652ba4861"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getServiceXXX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">require</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
  <span class="token variable">$service</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$service</span><span class="token operator">-&gt;</span><span class="token variable">$constructor</span><span class="token punctuation">(</span><span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$calls</span> <span class="token keyword">as</span> <span class="token variable">$call</span><span class="token punctuation">)</span>
  <span class="token variable">$service</span><span class="token operator">-&gt;</span><span class="token variable">$call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token variable">$service</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<p><strong>Note: </strong>Dans Symfony 2, les bundles de base utilisent le loader XML pour définir leurs services. Le format XML a l'avantage de pouvoir être validé via <strong>Components/DependencyInjection/Loader/schema/dic/services/services-1.0.xsd</strong></p>
<h3 id="exemple-de-service-le-logger-du-zendbundle" class="anchor-title"><a href="#exemple-de-service-le-logger-du-zendbundle">Exemple de service: le logger du ZendBundle</a></h3>
<p>Dans le répertoire Ressources/config/ du Bundle (<strong> /sandbox/src/vendor/symfony/src/Symfony/Framework/ZendBundle</strong>), on trouve le fichier : logger.xml. Il s'agit de notre fichier de configuration. Notre fichier qui sera chargé par le loader pour enrichir notre container.</p>
<pre class="code-multiline language-xml"><code class="language-xml" id="7b3f845590cde9ce25358a1809956cf1"><span class="token comment">&lt;!--?xml version="1.0" ?--&gt;</span>

Symfony\Framework\ZendBundle\Logger\LoggerZend_Log::CRITSymfony\Framework\ZendBundle\Logger\DebugLoggerZend_Log_Writer_StreamZend_Log_Formatter_Simple%%timestamp%% %%priorityName%%: %%message%%

%zend.logger.path%

%zend.formatter.filesystem.format%

%zend.logger.priority%</code></pre>
<p>5 services sont définis: zend.logger, zend.logger.writer.filesystem, zend.formatter.filesystem, zend.logger.writer.debug et zend.logger.filter.
Les paramètres sont également définis dans le fichier.</p>
<p>Ces différentes déclaration aboutiront à la création de méthodes de ce type dans le container généré par le Dumper PHP.</p>
<pre class="code-multiline language-php"><code class="language-php" id="efad2403edfb1336d9c2f4c175c90378"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getZend_LoggerService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Symfony<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>ZendBundle<span class="token punctuation">\</span>Logger<span class="token punctuation">\</span>Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">addWriter</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getZend_Logger_Writer_FilesystemService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">addWriter</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getZend_Logger_Writer_DebugService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getZend_Logger_Writer_FilesystemService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.writer.filesystem'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.writer.filesystem'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Zend_Log_Writer_Stream</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'zend.logger.path'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getZend_Logger_FilterService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">setFormatter</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getZend_Formatter_FilesystemService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.writer.filesystem'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getZend_Formatter_FilesystemService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.formatter.filesystem'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.formatter.filesystem'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Zend_Log_Formatter_Simple</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'zend.formatter.filesystem.format'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.formatter.filesystem'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getZend_Logger_Writer_DebugService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.writer.debug'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.writer.debug'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Symfony<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>ZendBundle<span class="token punctuation">\</span>Logger<span class="token punctuation">\</span>DebugLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getZend_Logger_FilterService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.writer.debug'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getZend_Logger_FilterService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.filter'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.filter'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Zend_Log_Filter_Priority</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'zend.logger.priority'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zend.logger.filter'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getLoggerService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getZend_LoggerService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Comme vous pouvez le constater, une méthode getLoggerService est générée. Cette méthode est générée car un alias a été défini lors de la configuration du builder (ligne 59 du fichier ZendExtension.php).</p>
<pre class="code-multiline language-php"><code class="language-php" id="6ecc4e0bcecbb878ec6790beaee60106"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$configuration</span><span class="token operator">-&gt;</span><span class="token function">setAlias</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'logger'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'zend.logger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<h4 id="les-annotations" class="anchor-title"><a href="#les-annotations">Les annotations</a></h4>
<p>Les annotations permettent de rajouter des propriétés à un service. Ces annotations ne sont pas exploitées directement par l'injecteur de dépendances mais par des composants tierces. Une annotation possède un nom et des attributs. Par exemple, dans le fichier de définitions: Framework/WebBundle/Resources/config/web.xml, on trouve la définition suivante sur le service <strong>request_parser</strong>:</p>
<p>Cette définition rajoute donc une annotation "<strong>kernel.listener</strong>" sur le service <strong>request_parser</strong> avec comme attributs <strong>event</strong> et <strong>method</strong>.
Dans l'exemple précédent, le <strong>Kernel</strong> se servira de cette annotation pour définir le service en tant qu'écouteur (listener) sur l'event "core.request" (nous y reviendrons dans le prochain article).</p>
<h4 id="les-extensions" class="anchor-title"><a href="#les-extensions">Les extensions :</a></h4>
<p>Lorsque les différents Bundles vont définir leurs services, ceux-ci ne seront pas directement chargés dans la configuration du Builder global. Au lieu de ça, les Bundles vont définir des extensions. Les extensions ne sont qu'un wrapper permettant de charger la configuration d'un bundle "à la demande". Les extensions vont permettre de mieux organiser les différents services. Pour expliquer le fonctionnement des extensions, nous allons étudier le Bundle Web (Framework/WebBundle).</p>
<p>Le fichier Bundle.php du WebBundle ressemble à ceci:</p>
<pre class="code-multiline language-php"><code class="language-php" id="bd7695f02b66c9e9789f6f9800f837d2"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Bundle</span> <span class="token keyword">extends</span> <span class="token class-name">BaseBundle</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">buildContainer</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ContainerInterface</span> <span class="token variable">$container</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token scope">Loader<span class="token punctuation">::</span></span><span class="token function">registerExtension</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>La méthode <strong>buildContainer()</strong> définie sur chaque Bundle permet d'indiquer au <strong>Kernel</strong> comment configurer le Container pour ce Bundle. Ici, le Bundle va se contenter de déclarer une extension sur le loader. Il enregistre donc l'extension <strong>WebExtension</strong> dans le loader.
Voyons maintenant le fichier WebExtension.php</p>
<pre class="code-multiline language-php"><code class="language-php" id="69a45ee5de2f4e2c337fb8623dd32a9b"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">WebExtension</span> <span class="token keyword">extends</span> <span class="token class-name">LoaderExtension</span>
<span class="token punctuation">{</span>
  <span class="token keyword">protected</span> <span class="token variable">$resources</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
  <span class="token string single-quoted-string">'templating'</span><span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'templating.xml'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'web'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'web.xml'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'debug'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'debug.xml'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'user'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'user.xml'</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">webLoad</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token variable">$configuration</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BuilderConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$loader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlFileLoader</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span><span class="token operator">.</span><span class="token string single-quoted-string">'/../Resources/config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$configuration</span><span class="token operator">-&gt;</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token variable">$loader</span><span class="token operator">-&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">resources</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'web'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$configuration</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">userLoad</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span><span class="token operator">...</span><span class="token operator">.</span><span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">templatingLoad</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span><span class="token operator">...</span><span class="token operator">.</span><span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">debugLoad</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span><span class="token operator">...</span><span class="token operator">.</span><span class="token punctuation">}</span>
  <span class="token operator">...</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string single-quoted-string">'web'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>On voit que les extensions permettent de charger des configurations de Builder un peu différemment. Dans les différents fichiers de configuration manipulés, quel que soit le format du loader utilisé, on se contente de déclarer des services. Cependant, il faut savoir qu'il est également possible de charger et configurer des extensions ainsi définies.
Ce qu'on trouve en général dans les fichiers config.yml / config_dev.yml / config_prod.yml d'une application utilise principalement la déclaration des extensions prédéfinies par les Bundles et ne déclare pas de nouveaux services.
Exemple:</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="e9545752e3ca8bcfedf45726d005ea36"><span class="token key atrule">kernel.config</span><span class="token punctuation">:</span> <span class="token null important">~</span>
<span class="token key atrule">web.web</span><span class="token punctuation">:</span> <span class="token null important">~</span>
<span class="token key atrule">web.templating</span><span class="token punctuation">:</span> <span class="token null important">~</span>
<span class="token key atrule">web.debug</span><span class="token punctuation">:</span>
<span class="token key atrule">exception</span><span class="token punctuation">:</span> %kernel.debug%
<span class="token key atrule">toolbar</span><span class="token punctuation">:</span> %kernel.debug%
<span class="token key atrule">zend.logger</span><span class="token punctuation">:</span>
<span class="token key atrule">priority</span><span class="token punctuation">:</span> info
<span class="token key atrule">path</span><span class="token punctuation">:</span> %kernel.root_dir%/logs/%kernel.environment%.log
<span class="token key atrule">swift.mailer</span><span class="token punctuation">:</span>
<span class="token key atrule">transport</span><span class="token punctuation">:</span> gmail</code></pre>
<p>Dans ce fichier de configuration, seules des extensions sont déclarées. A noter que si une extension n'est pas déclarée dans le fichier de configuration d'un Container, ses services ne seront pas inclus dans le Container final.
Le but des extensions est de fournir une méthode plus "propre" pour déclarer ses services, mais le fonctionnement reste identique, les Bundles vont déclarer des services comme vu précédemment, les extensions ne fournissant qu'un moyen de charger ou configurer ces déclarations.</p>
<h3 id="mise-en-pratique" class="anchor-title"><a href="#mise-en-pratique">Mise en pratique</a></h3>
<p>Afin de bien comprendre le fonctionnement, je vous propose une petite mise en pratique au travers de quelques exemples. Les exemples seront basés sur la sandbox proposée sur le site de <a href="http://www.symfony-reloaded.org" target="_blank">Symfony 2</a> et l'application Hello World !</p>
<p>Au niveau de la sandbox, les fichiers de configuration du Builder sont : config.yml, config_dev.yml et config_prod.yml. La méthode qui va charger ces fichiers est la méthode registerContainerConfiguration() de la classe HelloKernel. Nous allons travailler dans le cadre de nos exemples sur l'environnement de production. Le Container final généré se trouve dans le cache hello/cache/prod/helloProjectContainer.php</p>
<pre class="code-multiline language-php"><code class="language-php" id="42ac61852b48a9e921f8db817058b896"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloKernel</span> <span class="token keyword">extends</span> <span class="token class-name">Kernel</span>
<span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">registerContainerConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token variable">$loader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContainerLoader</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getBundleDirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$configuration</span> <span class="token operator">=</span> <span class="token variable">$loader</span><span class="token operator">-&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span><span class="token operator">.</span><span class="token string single-quoted-string">'/config/config_'</span><span class="token operator">.</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.yml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$configuration</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></span></code></pre>
<p>C'est au niveau de cette méthode que nous allons intervenir dans un premier temps.</p>
<h4 id="modifier-la-classe-d-un-service" class="anchor-title"><a href="#modifier-la-classe-d-un-service">Modifier la classe d'un service</a></h4>
<p>Dans notre premier exemple, nous allons tenter de modifier un service. En l'occurrence, le service représentant la requête, le bien nommé "RequestService". Notre container (HelloProjectContainer.php) définit le service ainsi:</p>
<pre class="code-multiline language-php"><code class="language-php" id="402dbff5fba94ce910a2c86a76e6596b"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getRequestService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Symfony<span class="token punctuation">\</span>Components<span class="token punctuation">\</span>RequestHandler<span class="token punctuation">\</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Pour modifier la classe utilisée pour ce service, rien de plus simple, il nous suffit de modifier la configuration du container.
Nous allons simplement modifier la classe associée dans la définition de ce service de cette façon :</p>
<pre class="code-multiline language-php"><code class="language-php" id="66e755e6c8ec07cb8b30e5d470241df0"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">registerContainerConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token variable">$loader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContainerLoader</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getBundleDirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$configuration</span> <span class="token operator">=</span> <span class="token variable">$loader</span><span class="token operator">-&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span><span class="token operator">.</span><span class="token string single-quoted-string">'/config/config_'</span><span class="token operator">.</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.yml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$configuration</span><span class="token operator">-&gt;</span><span class="token function">getDefinition</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setClass</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'MaClasseRequest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Nous modifions la définition du service "request"</span>
  <span class="token keyword">return</span> <span class="token variable">$configuration</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<p>C'est fait ! Si on vide le cache et que l'on rappelle une url sur le projet, la définition de notre service dans le container ressemble maintenant à ça:</p>
<pre class="code-multiline language-php"><code class="language-php" id="d4de141992e983d93778578b86e57b63"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getRequestService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MaClasseRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<h4 id="creer-un-service" class="anchor-title"><a href="#creer-un-service">Créer un service</a></h4>
<p>Dans cette exemple, nous allons voir comment déclarer un nouveau service. Nous allons tenter de déclarer le service "Monservice", utilisant la classe "Maclasse", dépendante du service "logger" sur laquelle on appellera les méthodes init1() et init2() à qui on passera le paramètre "coucou". Nous avions vu que le fichier config.yml déclarait les extensions à utiliser, mais c'est un fichier de configuration de Container comme un autre, nous pouvons donc y définir des services.</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="3c71d34661ecacab2855d84559152ba1"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">monservice</span><span class="token punctuation">:</span>
    <span class="token key atrule">id</span><span class="token punctuation">:</span> monservice
    <span class="token key atrule">class</span><span class="token punctuation">:</span> Maclasse
    <span class="token key atrule">arguments</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> @logger
    <span class="token key atrule">calls</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token punctuation">[</span>init1<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token punctuation">-</span> <span class="token punctuation">[</span>init2<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'coucou'</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre>
<p>C'est tout. Nous venons de déclarer un nouveau service dans notre application. Si nous jetons un oeil au Container généré:</p>
<pre class="code-multiline language-php"><code class="language-php" id="272af7ea5056f520b2ba3c0b119d267d"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getMonserviceService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'monservice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'monservice'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Maclasse</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'logger'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">init1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">init2</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'coucou'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">shared</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'monservice'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<h3 id="en-conclusion" class="anchor-title"><a href="#en-conclusion">En conclusion</a></h3>
<p>Comme vous avez pu le découvrir dans cet article, l'injecteur de dépendances de Symfony 2 est vraiment puissant. Nous pouvons customizer, tweaker, étendre le fonctionnement du coeur même du Framework par ce biais.</p>
<p>L'injection de dépendances ne devrait plus avoir de secrets pour vous !</p>
<p>PS: Merci à Xavier R pour sa relecture et ses remarques avisées.</p>
                                                                </main>
            <aside class="article-content__aside">
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a>
                                <img     src="/elao_/pr/652/%2E%2E/../resized/content/images/members/avatars/vbouzeran.jpg/279a73f5865daa35af3ee9a0d54c28e8.jpg"
    srcset="
        /elao_/pr/652/%2E%2E/../resized/content/images/members/avatars/vbouzeran.jpg/279a73f5865daa35af3ee9a0d54c28e8.jpg 1x,
        /elao_/pr/652/%2E%2E/../resized/content/images/members/avatars/vbouzeran.jpg/3021268503945d1bdd2cc815a27de002.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a>
                                <strong>Vincent Bouzeran</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                                                        <a href="https://github.com/Vincz " class="social social--small">
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Vincent Bouzeran</span>
                                </a>
                                                                                        <a href="http://www.elao.com" class="social social--small">
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Vincent Bouzeran</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/remove_jobs_team/content/blog/dev/symfony-2-linjection-de-dependances.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/652/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/652/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/652/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/652/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/652/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/652/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/652/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                                                <a href="/elao_/pr/652/recrutement">
                            Nous recrutons
                                                            <span class="bullet">1</span>
                                                    </a>
                    </li>
                    <li>
                        <a href="/elao_/pr/652/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/652/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            Twitter
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/mycompany/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/pr/652/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2025 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/652/legal">Mentions légales</a>
            <a href="/elao_/pr/652/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
