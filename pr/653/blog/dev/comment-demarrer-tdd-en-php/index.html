<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Comment démarrer en TDD en PHP ?</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/653/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/653/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/653/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/653/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/653/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/653/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/653/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Test Driven Development c&#039;est bien mais comment commencer à en faire ?" />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/653/blog/dev/comment-demarrer-tdd-en-php" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Comment démarrer en TDD en PHP ?" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Test Driven Development c&#039;est bien mais comment commencer à en faire ?" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/653/blog/dev/comment-demarrer-tdd-en-php" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/pr/653/%2E%2E/../resized/content/images/blog/thumbnails/tdd.jpg/f35716c1b8a2898bc2d1bff885113960.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Comment démarrer en TDD en PHP ?">
            <meta property="twitter:description" content="Test Driven Development c&#039;est bien mais comment commencer à en faire ?">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/653/%2E%2E/../resized/content/images/blog/thumbnails/tdd.jpg/2bea48929a3bb8b4995210ee4553e563.jpg">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/pr/653/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Comment démarrer en TDD en PHP ?",
    "image": [
        "https://elao.github.io/elao_/pr/653/blog/dev/content/images/blog/thumbnails/tdd.jpg"
    ],
    "datePublished": "2018-10-30T00:00:00+00:00",
    "dateModified": "2018-10-30T00:00:00+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Richard Hanna",
            "url": "https://elao.github.io/elao_/pr/653/equipe"
        }
    ],
    "keywords": [
        "Php",
        "Test",
        "Tdd"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/653/build/app.a4f836be.css">
        
                        <script src="/elao_/pr/653/build/runtime.a06d8768.js" defer></script><script src="/elao_/pr/653/build/552.3082ae9c.js" defer></script><script src="/elao_/pr/653/build/769.7dfbbe52.js" defer></script><script src="/elao_/pr/653/build/app.d906f729.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;653&#x5C;&#x2F;build&#x5C;&#x2F;see.ace7bf9f.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;653&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;653&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;653&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;653&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/653/">
                        <span class="screen-reader">Comment démarrer en TDD en PHP ?</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/653/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/653/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/653/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/653/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/653/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/pr/653/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/653/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/653/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/653/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/653/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/653/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/653/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/653/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/pr/653/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/653/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/653/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/653/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/653/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Comment démarrer en TDD en PHP ?</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/7e836ddbaf4da774f174ee3e0f6d5099.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/7e836ddbaf4da774f174ee3e0f6d5099.jpg') 1x,
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/6f564ece7208e96cf7597f830a2b437e.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/7e836ddbaf4da774f174ee3e0f6d5099.jpg') 1x,
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/6f564ece7208e96cf7597f830a2b437e.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/7e836ddbaf4da774f174ee3e0f6d5099.jpg') 1x,
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/6f564ece7208e96cf7597f830a2b437e.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/7e836ddbaf4da774f174ee3e0f6d5099.jpg') 1x,
        url('/elao_/pr/653/%2E%2E/../resized/content/images/blog/headers/tdd.jpg/6f564ece7208e96cf7597f830a2b437e.jpg') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a>
                                    <img     src="/elao_/pr/653/%2E%2E/../resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg"
    srcset="
        /elao_/pr/653/%2E%2E/../resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg 1x,
        /elao_/pr/653/%2E%2E/../resized/content/images/members/avatars/rhanna.jpg/595ecfd31fcd439bed40e88acab04bb4.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/pr/653/blog/auteur/rhanna">
                                    <strong>Richard Hanna</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>30 octobre 2018</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Comment démarrer en TDD en PHP ?</h1>
                <p>Test Driven Development c&#039;est bien mais comment commencer à en faire ?</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/653/blog/tag/php" rel="nofollow">#Php</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/653/blog/tag/test" rel="nofollow">#Test</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/653/blog/tag/tdd" rel="nofollow">#Tdd</a>
                        </li>
                                    </ul>
            </div>
        </div>

                    <ol class="table-of-content" data-aos="fade-up">
                                    <li class="table-of-content__item">
                        <a href="#pourquoi-faire-du-test-driven-development">Pourquoi faire du Test Driven Development</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#outillage">Outillage</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#notre-exemple">Notre exemple</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#le-service-a-tester">Le service à tester</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#conclusion">Conclusion</a>

                                            </li>
                            </ol>
        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <p><strong>Test Driven Development</strong> ou le développement guidé par les tests, n'est clairement pas une méthode triviale.
N'ayez pas honte de ne pas savoir par où commencer.
Beaucoup de personnes parlent de « déclic » lorsqu'il s'agit d'appréhender le TDD.
L'ambition de cet article est d'essayer de créer ce déclic.</p>
<h2 id="pourquoi-faire-du-test-driven-development" class="anchor-title"><a href="#pourquoi-faire-du-test-driven-development">Pourquoi faire du Test Driven Development</a></h2>
<p>On trouve pléthore de littérature à ce sujet et voici selon nous les avantages à faire du TDD en vrac :</p>
<ul>
<li>tester les différents cas de figure,</li>
<li>le plus souvent les tests s'appuient sur les spécifications et cela permet donc de conserver la documentation dans le code (<em>live documentation</em>),</li>
<li>permet de mieux découper le code (notion de <em>clean code</em>),</li>
<li>poser une première implémentation puis optimiser ou/et refactoriser et à chaque fois la valider grâce aux tests,</li>
<li>gain de temps en validant l'implémentation via la console sans passer par les tests dans le navigateur.</li>
</ul>
<img src="https://media.giphy.com/media/iKbUlFbs77oI0/giphy.gif" id="giphy-gif">
<h2 id="outillage" class="anchor-title"><a href="#outillage">Outillage</a></h2>
<p>Installons le framework de test PHPUnit :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="e292e56a981e7c5f29b48b89e328df80">$ <span class="token function">composer</span> require <span class="token parameter variable">--dev</span> phpunit/phpunit ^7</code></pre>
<p>En considérant que notre namespace est <code class="code-inline" id="98832bd23a1a4e070b40c19a58c363c0">MyCompany\App</code> on devrait avoir ceci dans notre composer.json :</p>
<pre class="code-multiline language-json"><code class="language-json" id="dd2ac14e20e33e5f3c13e253fbeabc8e"><span class="token punctuation">{</span>
  <span class="token property">"autoload"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"psr-4"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"MyCompany\\App\\"</span><span class="token operator">:</span> <span class="token string">"src"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"autoload-dev"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"psr-4"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"MyCompany\\App\\Tests\\"</span><span class="token operator">:</span> <span class="token string">"tests"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"require-dev"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"phpunit/phpunit"</span><span class="token operator">:</span> <span class="token string">"^7.0"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Vérifions que tout est en place en lançant :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="cd2e415c782a0d71567e030ca0a1efba">./vendor/bin/phpunit</code></pre>
<p>Nous devrions avoir quelque chose comme ça :</p>
<pre class="code-multiline"><code id="98187fc43eb5a5751aa6f9916a778ec8">&gt; No tests executed!</code></pre>
<h2 id="notre-exemple" class="anchor-title"><a href="#notre-exemple">Notre exemple</a></h2>
<p>Imaginons que nous intervenons sur un blog.
Les utilisateurs de ce blog ont besoin de voir la liste des articles.
Pour chaque article, on voit un titre et le nombre de commentaires laissés.
Si un article a été publié il y a moins d'une semaine, le titre de l'article contient "Nouveau !" en préfixe.</p>
<h3 id="hypotheses" class="anchor-title"><a href="#hypotheses">Hypothèses</a></h3>
<p>Les articles sont stockés quelque part, en base de données, fichiers, peu importe...
Il me faut donc un service qui récupère les données puis les prépare pour être affichées.</p>
<p>On va considérer que :</p>
<ul>
<li>le ou les services pour récupérer les données existent déjà,</li>
<li>l'affichage sera géré par autre chose, par le <em>controller</em> et le <em>templating</em> de notre application.</li>
</ul>
<p>On va uniquement se focaliser pour cet exemple sur un service qui va préparer les données souhaitées.</p>
<p>Imaginer quelle est la plus petite entité logique à tester et faire cet effort de réflexion est finalement la
premère étape en TDD.</p>
<h3 id="entite" class="anchor-title"><a href="#entite">Entité</a></h3>
<p>Nous allons uniquement utiliser l'entité suivante <code class="code-inline" id="03d947a2158373c3b9d74325850cb8b9">Post</code> représentant un article du blog :</p>
<pre class="code-multiline language-php"><code class="language-php" id="bcc87acaf570f24692dcc35c0e6c8e62"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Post</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name"><span class="token keyword">string</span></span> */</span>
    <span class="token keyword">public</span> <span class="token variable">$title</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name"><span class="token punctuation">\</span>DateTime</span> */</span>
    <span class="token keyword">public</span> <span class="token variable">$publishedAt</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token class-name class-name-fully-qualified type-declaration"><span class="token punctuation">\</span>DateTime</span> <span class="token variable">$publishedAt</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">title</span> <span class="token operator">=</span> <span class="token variable">$title</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">publishedAt</span> <span class="token operator">=</span> <span class="token variable">$publishedAt</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<h3 id="dependances" class="anchor-title"><a href="#dependances">Dépendances</a></h3>
<p>Considérons que nous avons les deux interfaces suivantes permettant d'accéder aux articles
et au nombre de commentaires par articles.</p>
<p><code class="code-inline" id="c217921c976603f2f662ed76f16f60ef">PostRepository</code>:</p>
<pre class="code-multiline language-php"><code class="language-php" id="616f4418d993938c418c34aa8f27d2a9"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Repository</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name-definition class-name">PostRepository</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@return</span> <span class="token class-name">Post<span class="token punctuation">[</span><span class="token punctuation">]</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<p><code class="code-inline" id="7f2c2dae0da64c4e29698b0a02084fa0">CommentRepository</code>:</p>
<pre class="code-multiline language-php"><code class="language-php" id="4640ace2c39a732d059094af225730aa"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Repository</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name-definition class-name">CommentRepository</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">countByPost</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Post</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre>
<h3 id="la-plomberie" class="anchor-title"><a href="#la-plomberie">La plomberie</a></h3>
<p>Créons une classe <code class="code-inline" id="9bf6839f16a04a883768f5c536b2161d">PostView</code> qu'on appelle communément un DTO (data transfer object), un objet de transfert de données
qui ne contient aucun comportement, que des valeurs :</p>
<pre class="code-multiline language-php"><code class="language-php" id="0a720120fc3eb466fb3ea3fc92fca898"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">PostView</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name"><span class="token keyword">string</span></span> */</span>
    <span class="token keyword">public</span> <span class="token variable">$title</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name"><span class="token keyword">int</span></span> */</span>
    <span class="token keyword">public</span> <span class="token variable">$commentsNumber</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name"><span class="token keyword">bool</span></span> */</span>
    <span class="token keyword">public</span> <span class="token variable">$isNew</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$commentsNumber</span><span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$isNew</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">title</span> <span class="token operator">=</span> <span class="token variable">$title</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">commentsNumber</span> <span class="token operator">=</span> <span class="token variable">$commentsNumber</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">isNew</span> <span class="token operator">=</span> <span class="token variable">$isNew</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<h2 id="le-service-a-tester" class="anchor-title"><a href="#le-service-a-tester">Le service à tester</a></h2>
<p>Créons notre service <code class="code-inline" id="4e74d55162d9b39c9ad96294764293ff">GetPostsList</code> qui ne fait en réalité qu'une seule chose, une seule méthode publique, <code class="code-inline" id="41694f07cc1d4017d0ba996850f58e33">_invoke</code> :</p>
<pre class="code-multiline language-php"><code class="language-php" id="972e3d83ad52eeef3c5d5e8661411cdb"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">GetPostsList</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<h3 id="les-enfants-et-les-tests-d-abord" class="anchor-title"><a href="#les-enfants-et-les-tests-d-abord">Les enfants et les tests d'abord !</a></h3>
<p>Créons maintenant un test de <code class="code-inline" id="4e74d55162d9b39c9ad96294764293ff">GetPostsList</code> qui est censé nous envoyer deux articles, l'un marqué nouveau, l'autre non.
Il est important de tester tous les cas. Cela tombe bien, notre besoin est simple, on a que deux cas.</p>
<p>Dans : <code class="code-inline" id="7c85117bec6526ed4f958c8c7cd55358">tests/Post/GetPostsListTest.php</code> :</p>
<pre class="code-multiline language-php"><code class="language-php" id="3bf4ea3c294e644ffcba7b8796ca2594"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Tests<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>GetPostsList</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>PostView</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">GetPostsListTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test_get_new_and_old_posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$getPostsList</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetPostsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span>
                <span class="token keyword">new</span> <span class="token class-name">PostView</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'TDD c\'est bien'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// is new</span>
                <span class="token keyword">new</span> <span class="token function">PostView</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Tester ce n\'est pas douter'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// is not new</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token variable">$getPostsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Lançons les tests :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="ae4f2158f270248ecfd998371868baac">$ ./vendor/bin/phpunit</code></pre>
<p>Bien sûr, cela échoue :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="04b56864d7a3be5f917b1465316d24a6">There was <span class="token number">1</span> failure:

    <span class="token number">1</span><span class="token punctuation">)</span> MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Tests<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>GetPostsListTest::test_get_new_and_old_posts
    Failed asserting that two arrays are equal.
    --- Expected
    +++ Actual
    @@ @@
     Array <span class="token punctuation">(</span>
    -    <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">&gt;</span> MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>PostView Object <span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
    -    <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">&gt;</span> MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>PostView Object <span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
     <span class="token punctuation">)</span></code></pre>
<p>Mais pas de panique. Au contraire, faire échouer les tests est la 1ère étape en TDD !</p>
<p>Complétons le test en faisant un <em>mock</em> de chaque dépendance.
Le <em>mock</em> nous permet de s'affranchir de l'implémentation de la dépendance et de décider ce que celle-ci renvoie comme
données.</p>
<pre class="code-multiline language-php"><code class="language-php" id="b9621748175f85f2f8027d363230e36d"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Tests<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>GetPostsList</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post<span class="token punctuation">\</span>PostView</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>CommentRepository</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>PostRepository</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">GetPostsListTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test_get_new_and_old_posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$post1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'TDD c\'est bien'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'2018-10-29'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$post2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Tester ce n\'est pas douter'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'2018-10-01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// mock of PostRepository interface</span>
        <span class="token variable">$postRepository</span> <span class="token operator">=</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">prophesize</span><span class="token punctuation">(</span><span class="token scope">PostRepository<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$postRepository</span><span class="token operator">-&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">shouldBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$post1</span><span class="token punctuation">,</span> <span class="token variable">$post2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// mock of CommentRepository interface</span>
        <span class="token variable">$commentRepository</span> <span class="token operator">=</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">prophesize</span><span class="token punctuation">(</span><span class="token scope">CommentRepository<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$commentRepository</span><span class="token operator">-&gt;</span><span class="token function">countByPost</span><span class="token punctuation">(</span><span class="token variable">$post1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">shouldBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$commentRepository</span><span class="token operator">-&gt;</span><span class="token function">countByPost</span><span class="token punctuation">(</span><span class="token variable">$post2</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">shouldBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$getPostsList</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetPostsList</span><span class="token punctuation">(</span><span class="token variable">$postRepository</span><span class="token operator">-&gt;</span><span class="token function">reveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$commentRepository</span><span class="token operator">-&gt;</span><span class="token function">reveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span>
                <span class="token keyword">new</span> <span class="token class-name">PostView</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'TDD c\'est bien'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">PostView</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Tester ce n\'est pas douter'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token variable">$getPostsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<h3 id="enfin-l-implementation" class="anchor-title"><a href="#enfin-l-implementation">Enfin, l'implémentation</a></h3>
<p>Nous avons tout ce qu'il faut pour implémenter notre code :</p>
<pre class="code-multiline language-php"><code class="language-php" id="c95953cd07a13f4581ddfee73b231f30"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>CommentRepository</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">MyCompany<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>PostRepository</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">GetPostsList</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name">PostRepository</span> */</span>
    <span class="token keyword">private</span> <span class="token variable">$postRepository</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name">CommentRepository</span> */</span>
    <span class="token keyword">private</span> <span class="token variable">$commentRepository</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">PostRepository</span> <span class="token variable">$postRepository</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">CommentRepository</span> <span class="token variable">$commentRepository</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">postRepository</span> <span class="token operator">=</span> <span class="token variable">$postRepository</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">commentRepository</span> <span class="token operator">=</span> <span class="token variable">$commentRepository</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$postViews</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">postRepository</span><span class="token operator">-&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$isLessThanAWeekOld</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">clone</span> <span class="token variable">$post</span><span class="token operator">-&gt;</span><span class="token property">publishedAt</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateInterval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'P1W'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token variable">$postViews</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PostView</span><span class="token punctuation">(</span>
                <span class="token variable">$post</span><span class="token operator">-&gt;</span><span class="token property">title</span><span class="token punctuation">,</span>
                <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">commentRepository</span><span class="token operator">-&gt;</span><span class="token function">countByPost</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token variable">$isLessThanAWeekOld</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$postViews</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Enfin, lançons les tests :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="ae4f2158f270248ecfd998371868baac">$ ./vendor/bin/phpunit</code></pre>
<pre class="code-multiline"><code id="d864fa1de40a8e770149019f7439139c">&gt; OK (1 test, 4 assertions)</code></pre>
<h3 id="le-temps-n-attend-pas" class="anchor-title"><a href="#le-temps-n-attend-pas">Le temps n'attend pas</a></h3>
<p>Attention, il y a un piège. Désolé mais ce test ne fonctionnera plus dans quelques jours.
Pourquoi ?
Nous avons une comparaison avec la date "système" dans l'implémentation (<code class="code-inline" id="1ef9214848bdfb5133edf6959967edc5">new \DateTime</code>)
alors que les dates sont fixes dans les tests.</p>
<p>La date courante est une... dépendance. Modifions notre test pour fixer la date courante pour qu'elle ne bouge plus et
ne fasse plus échouer les tests dans quelques jours !</p>
<pre class="code-multiline language-php"><code class="language-php" id="87a58a21342be75c54c359a034f38869"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// ...</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">GetPostsListTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test_get_new_and_old_posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$now</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'2018-10-30'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>

        <span class="token variable">$getPostsList</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetPostsList</span><span class="token punctuation">(</span><span class="token variable">$postRepository</span><span class="token operator">-&gt;</span><span class="token function">reveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$commentRepository</span><span class="token operator">-&gt;</span><span class="token function">reveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$now</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p>Supprimons maintenant le <code class="code-inline" id="1ef9214848bdfb5133edf6959967edc5">new \DateTime</code> dans la class GetPostsList et utilisons la date en dépendance :</p>
<pre class="code-multiline language-php"><code class="language-php" id="9a14db50129055475b638fa1c71aac51"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// ...</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">GetPostsList</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name"><span class="token punctuation">\</span>DateTime</span> */</span>
    <span class="token keyword">private</span> <span class="token variable">$now</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">PostRepository</span> <span class="token variable">$postRepository</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">CommentRepository</span> <span class="token variable">$commentRepository</span><span class="token punctuation">,</span> <span class="token class-name class-name-fully-qualified type-declaration"><span class="token punctuation">\</span>DateTime</span> <span class="token variable">$now</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">postRepository</span> <span class="token operator">=</span> <span class="token variable">$postRepository</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">commentRepository</span> <span class="token operator">=</span> <span class="token variable">$commentRepository</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">now</span> <span class="token operator">=</span> <span class="token variable">$now</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$postViews</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">postRepository</span><span class="token operator">-&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$isLessThanAWeekOld</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">clone</span> <span class="token variable">$post</span><span class="token operator">-&gt;</span><span class="token property">publishedAt</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateInterval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'P1W'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">now</span><span class="token punctuation">;</span>
            <span class="token comment">// ...</span></span></code></pre>
<p>Vérifions :</p>
<pre class="code-multiline"><code id="ae4f2158f270248ecfd998371868baac">    $ ./vendor/bin/phpunit</code></pre>
<pre class="code-multiline"><code id="d864fa1de40a8e770149019f7439139c">&gt; OK (1 test, 4 assertions)</code></pre>
<p>Super !</p>
<p>Vous trouverez le code de cet exemple ici : <a href="https://github.com/supertanuki/TDD-en-PHP" target="_blank">https://github.com/supertanuki/TDD-en-PHP</a></p>
<h2 id="conclusion" class="anchor-title"><a href="#conclusion">Conclusion</a></h2>
<img src="https://media.giphy.com/media/ds9RZ7gATF0wo/giphy.gif" id="giphy-gif">
<p>J'espère que cet exemple vous aura convaincu des avantages du <em>Test Driven Development</em>.
Pour finir, un dernier conseil pour mettre le pied à l'étrier : sur votre projet en cours,
dès que vous devez faire un service qui fait quelque chose
d'assez simple avec une ou deux conditions, posez d'abord des tests vérifiant chacune des conditions avant d'implémenter
ledit service.</p>
<p>À vos marques, prêts, <strong>testez</strong> !</p>
<p>PS : si vous souhaitez vous éclater en faisant du TDD et du code de qualité,
<a href="/contact">rejoignez-nous !</a></p>
                                                                </main>
            <aside class="article-content__aside">
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a>
                                <img     src="/elao_/pr/653/%2E%2E/../resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg"
    srcset="
        /elao_/pr/653/%2E%2E/../resized/content/images/members/avatars/rhanna.jpg/48b4d8efbc2f597dab26fcb1ed88d540.jpg 1x,
        /elao_/pr/653/%2E%2E/../resized/content/images/members/avatars/rhanna.jpg/595ecfd31fcd439bed40e88acab04bb4.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a>
                                <strong>Richard Hanna</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                            <a href="https://twitter.com/richardhanna" class="social social--small">
                                    <i class="icon icon--x" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Twitter de Richard Hanna</span>
                                </a>
                                                                                        <a href="https://github.com/supertanuki " class="social social--small">
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Richard Hanna</span>
                                </a>
                                                                                        <a href="http://www.elao.com" class="social social--small">
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Richard Hanna</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/social-bluesky-link/content/blog/dev/comment-demarrer-tdd-en-php.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/653/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/653/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/653/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/653/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/653/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/653/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/653/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                                                <a href="/elao_/pr/653/recrutement">
                            Nous recrutons
                                                            <span class="bullet">1</span>
                                                    </a>
                    </li>
                    <li>
                        <a href="/elao_/pr/653/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/653/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                    <li>
                        <a href="https://bsky.app/profile/elao.com" target="_blank">
                            <i class="icon icon--bluesky"></i>
                            Bluesky
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            Twitter / X
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/pr/653/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2025 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/653/legal">Mentions légales</a>
            <a href="/elao_/pr/653/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
