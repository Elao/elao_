<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Comprendre le cache du client Graphql Apollo</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/660/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/660/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/660/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/660/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/660/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/660/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/660/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Découverte du fonctionnement du cache du client GraphQL Apollo." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/660/blog/dev/apollo-graphql-cache" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Comprendre le cache du client Graphql Apollo" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Découverte du fonctionnement du cache du client GraphQL Apollo." />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/660/blog/dev/apollo-graphql-cache" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/pr/660/%2E%2E/../resized/content/images/blog/thumbnails/graphql-apollo.jpg/074d4b47e298f359a8b68c7be63e1426.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Comprendre le cache du client Graphql Apollo">
            <meta property="twitter:description" content="Découverte du fonctionnement du cache du client GraphQL Apollo.">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/660/%2E%2E/../resized/content/images/blog/thumbnails/graphql-apollo.jpg/4f2ed3c73dafe43826a386353cac3e5c.jpg">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/pr/660/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Comprendre le cache du client Graphql Apollo",
    "image": [
        "https://elao.github.io/elao_/pr/660/blog/dev/content/images/blog/thumbnails/graphql-apollo.jpg"
    ],
    "datePublished": "2020-02-17T00:00:00+00:00",
    "dateModified": "2020-02-17T00:00:00+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Maxime Colin",
            "url": "https://elao.github.io/elao_/pr/660/equipe/mcolin"
        }
    ],
    "keywords": [
        "Graphql",
        "Cache",
        "Apollo",
        "Javascript",
        "Api"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/660/build/app.3f8f2bcf.css">
        
                        <script src="/elao_/pr/660/build/runtime.3c4e92bc.js" defer></script><script src="/elao_/pr/660/build/947.b56b79b1.js" defer></script><script src="/elao_/pr/660/build/769.7dfbbe52.js" defer></script><script src="/elao_/pr/660/build/app.e47fd89c.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;660&#x5C;&#x2F;build&#x5C;&#x2F;see.80fe75b7.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;660&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;660&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;660&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;660&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/660/">
                        <span class="screen-reader">Comprendre le cache du client Graphql Apollo</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/660/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/660/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/660/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/660/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/660/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/pr/660/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/660/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/660/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/660/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/660/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/660/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/660/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/660/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/pr/660/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/660/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/660/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/660/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/660/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Comprendre le cache du client Graphql Apollo</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/534a15b222cf4b76a91ac20637af9c0c.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/534a15b222cf4b76a91ac20637af9c0c.jpg') 1x,
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/c80f3d56815e1c71a277336772856623.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/534a15b222cf4b76a91ac20637af9c0c.jpg') 1x,
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/c80f3d56815e1c71a277336772856623.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/534a15b222cf4b76a91ac20637af9c0c.jpg') 1x,
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/c80f3d56815e1c71a277336772856623.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/534a15b222cf4b76a91ac20637af9c0c.jpg') 1x,
        url('/elao_/pr/660/%2E%2E/../resized/content/images/blog/headers/graphql-apollo.jpg/c80f3d56815e1c71a277336772856623.jpg') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a href="/elao_/pr/660/blog/auteur/mcolin">
                                    <img     src="/elao_/pr/660/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg"
    srcset="
        /elao_/pr/660/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg 1x,
        /elao_/pr/660/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/0899bdf7169af336de983de73d88fa58.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/pr/660/blog/auteur/mcolin">
                                    <strong>Maxime Colin</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>17 février 2020</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Comprendre le cache du client Graphql Apollo</h1>
                <p>Découverte du fonctionnement du cache du client GraphQL Apollo.</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/660/blog/tag/graphql" rel="nofollow">#Graphql</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/660/blog/tag/cache" rel="nofollow">#Cache</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/660/blog/tag/apollo" rel="nofollow">#Apollo</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/660/blog/tag/javascript" rel="nofollow">#Javascript</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/660/blog/tag/api" rel="nofollow">#Api</a>
                        </li>
                                    </ul>
            </div>
        </div>

                    <ol class="table-of-content" data-aos="fade-up">
                                    <li class="table-of-content__item">
                        <a href="#introduction">Introduction</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#premiere-requete">Première requête</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#mutations">Mutations</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#lire-et-ecrire-dans-le-cache">Lire et écrire dans le cache</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#fragments">Fragments</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#mise-a-jour-automatique">Mise à jour automatique</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#configurer-le-cache">Configurer le cache</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#redirection-de-cache">Redirection de cache</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#gerer-la-suppression-de-donnees">Gérer la suppression de données</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#fetch-policy">Fetch policy</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#persistence">Persistence</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#conclusion">Conclusion</a>

                                            </li>
                            </ol>
        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <h2 id="introduction" class="anchor-title"><a href="#introduction">Introduction</a></h2>
<p>GraphQL est un standard qui s'impose peu à peu dans le monde des API. Comme tout protocole API, il vient avec différents clients facilitant le dialogue avec le serveur.</p>
<p><a href="https://www.apollographql.com/" target="_blank">Apollo GraphQL</a> est un service SAAS proposant une solution serveur GraphQL qui fournit également un très bon <a href="https://github.com/apollographql/apollo-client" target="_blank">client GraphQL Javascript</a>. Le client est open source et fonctionne avec n'importe quel serveur GraphQL.</p>
<p>GraphQL propose beaucoup d'avantages par rapport à d'autres protocoles API <em>over HTTP</em> comme REST par exemple (batching de query, sélection des données à retourner, format des données, ...) mais souffre d'un défaut si l'on peut dire : comme toutes les requêtes sont effectuées en POST sur le même endpoint, il est impossible de poser un simple <strong>cache</strong> HTTP en amont. Pas de Varnish, pas de <strong>cache</strong> navigateur, etc.</p>
<p>Si l'on veut mettre du <strong>cache</strong> côté client, il sera forcement applicatif. C'est justement l'une des grandes forces d'<strong>ApolloClient</strong>, il propose un <strong>cache très performant</strong>, chose qui va nous intéresser dans cet article.</p>
<h2 id="premiere-requete" class="anchor-title"><a href="#premiere-requete">Première requête</a></h2>
<p>L'utilisation basique du client est très simple et dans la veine de ce qu'on retrouve dans n'importe quel client API.</p>
<p>L'installation :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="42811a453950a92201a490b8c574ed2a"><span class="token comment"># installing the preset package</span>
<span class="token function">yarn</span> <span class="token function">add</span> apollo-boost graphql-tag graphql
<span class="token comment"># installing each piece independently</span>
<span class="token function">yarn</span> <span class="token function">add</span> apollo-client apollo-cache-inmemory apollo-link-http graphql-tag graphql</code></pre>
<p>On instancie le client avec l'url du endpoint GraphQL :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="b126761a2d2637e8e882402fa056d923"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ApolloClient</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-boost'</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">uri</span><span class="token operator">:</span> <span class="token string">'https://graphql.example.com'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Et c'est parti, on peut lancer nos requêtes GraphQL :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="e0bd0a297085019d626babffa541bad1"><span class="token keyword module">import</span> <span class="token imports">gql</span> <span class="token keyword module">from</span> <span class="token string">'graphql-tag'</span>

client
  <span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">query</span><span class="token operator">:</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token graphql language-graphql">
      <span class="token keyword">query</span> <span class="token definition-query function">Todos</span> <span class="token punctuation">{</span>
        <span class="token object">todos</span> <span class="token punctuation">{</span>
          <span class="token property">id</span>
          <span class="token property">text</span>
          <span class="token property">completed</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    </span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>A partir de ce moment, cette requête est cachée en mémoire. Vous pouvez la relancer autant de fois que vous le souhaitez, aucun appel réseau ne sera fait.</p>
<h2 id="mutations" class="anchor-title"><a href="#mutations">Mutations</a></h2>
<p>Le client permet évidemment d'exécuter des mutations (modifications de données) :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="0aa3a1c5320db418254ab780e5acdfcf"><span class="token keyword module">import</span> <span class="token imports">gql</span> <span class="token keyword module">from</span> <span class="token string">'graphql-tag'</span><span class="token punctuation">;</span>

client
  <span class="token punctuation">.</span><span class="token method function property-access">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mutation</span><span class="token operator">:</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token graphql language-graphql">
      <span class="token keyword">mutation</span> <span class="token definition-mutation function">AddTodo</span><span class="token punctuation">(</span><span class="token variable variable-input">$text</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token property-query property-mutation">addTodo</span><span class="token punctuation">(</span><span class="token attr-name">text</span><span class="token punctuation">:</span> <span class="token variable variable-input">$text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token property">id</span>
          <span class="token property">completed</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">variables</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Foobar'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>Grâce à cette mutation, nos données on été mise à jour sur notre serveur. Par contre par la même notre cache n'est plus à jour, et comme dit précédement, Apollo ne refera pas l'appel à l'API pour la requête.</p>
<blockquote>
<p>Il y a seulement 2 problèmes compliqués en informatique : nommer les choses, et l’invalidation de cache.</p>
</blockquote>
<p>Nous allons donc devoir mettre à jour ce cache, et pour le coup, c'est plutôt simple.</p>
<h2 id="lire-et-ecrire-dans-le-cache" class="anchor-title"><a href="#lire-et-ecrire-dans-le-cache">Lire et écrire dans le cache</a></h2>
<p>Le cache d'Apollo et son paradygme est un peu spécial. Il ne s'agit pas seulement d'un simple cache de requête. Il agit comme un <em>state manager</em> à l'instar de <a href="https://redux.js.org/" target="_blank">Redux</a> ou <a href="https://vuex.vuejs.org/" target="_blank">Vuex</a>. Les données récupérées via une requête sont automatiquement stockées dans le cache mais il nous est possible d'y accéder et même d'y inserer ou d'y modifier de données sans refaire de requête.</p>
<p>Pour cela nous allons utiliser les méthodes <code class="code-inline" id="6049d14e5ad8b9569d7bfc875e1e19f5">readQuery</code> et <code class="code-inline" id="487ef08341270e780f4c1f508fdb096a">writeQuery</code>. Attention, il faut appeler ces méthodes avec exactement la même requête GraphQL (variables inclues) que celle utilisée pour recupérer les données.</p>
<p>Pour cela nous allons utliser la méthode <code class="code-inline" id="6049d14e5ad8b9569d7bfc875e1e19f5">readQuery</code> pour lire les données attaché à la requête :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="c3d8b40b54d5343066b9f93ab6f68026"><span class="token keyword">const</span> <span class="token constant">TODOS</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token graphql language-graphql">
  <span class="token keyword">query</span> <span class="token definition-query function">Todos</span> <span class="token punctuation">{</span>
    <span class="token object">todos</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
      <span class="token property">text</span>
      <span class="token property">completed</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> data <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token method function property-access">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">TODOS</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Nous pouvons modifier ces données puis utiliser la méthode <code class="code-inline" id="487ef08341270e780f4c1f508fdb096a">writeQuery</code> pour les insérer dans le cache :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="4b3685594bee6a23a72ec81ed8e865e6">client<span class="token punctuation">.</span><span class="token method function property-access">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">TODOS</span>
  data
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>En combinant l'utilisation de ce deux méthodes dans l'<code class="code-inline" id="3ac340832f29c11538fbe2d6f75e8bcc">update</code> de la mutation, nous pouvons ainsi mettre à jour notre cache :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="812eaf42575a8940e5beae696df6c371"><span class="token keyword">const</span> <span class="token constant">ADD_TODO</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token graphql language-graphql">
  <span class="token keyword">mutation</span> <span class="token definition-mutation function">AddTodo</span><span class="token punctuation">(</span><span class="token variable variable-input">$text</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property-query property-mutation">addTodo</span><span class="token punctuation">(</span><span class="token attr-name">text</span><span class="token punctuation">:</span> <span class="token variable variable-input">$text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
      <span class="token property">text</span>
      <span class="token property">completed</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span><span class="token template-punctuation string">`</span></span>

client
  <span class="token punctuation">.</span><span class="token method function property-access">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mutation</span><span class="token operator">:</span> <span class="token constant">ADD_TODO</span><span class="token punctuation">,</span>
    <span class="token literal-property property">variables</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Foobar'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">cache<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token maybe-class-name">AddTodo</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Todos</span> <span class="token punctuation">}</span> <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token method function property-access">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">TODOS</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> <span class="token maybe-class-name">NewTodos</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token maybe-class-name">Todos</span><span class="token punctuation">,</span> <span class="token maybe-class-name">AddTodo</span><span class="token punctuation">]</span>

      cache<span class="token punctuation">.</span><span class="token method function property-access">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">TODOS</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">Todos</span><span class="token operator">:</span> <span class="token maybe-class-name">NewTodos</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2 id="fragments" class="anchor-title"><a href="#fragments">Fragments</a></h2>
<p>De la même manière qu'avec <code class="code-inline" id="6049d14e5ad8b9569d7bfc875e1e19f5">readQuery</code> et <code class="code-inline" id="487ef08341270e780f4c1f508fdb096a">writeQuery</code>, il est possible de mettre à jour des portions de requêtes utilisant le même fragment avec les méthodes <code class="code-inline" id="2bd958871bf3808abd7ce8a031471b3e">readFragment</code> et <code class="code-inline" id="154246f31f1ad6339c54f814319845e6">writeFragment</code>.</p>
<p>Par exemple avec les requêtes suivantes :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="2d22997fc5d2e3057a10684ea59b5160"><span class="token keyword">fragment</span> <span class="token fragment function">TodoFields</span> <span class="token keyword">on</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
  <span class="token property">id</span>
  <span class="token property">text</span>
  <span class="token property">completed</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> <span class="token definition-query function">Todo</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">todo</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">TodoFields</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> <span class="token definition-query function">Todos</span> <span class="token punctuation">{</span>
  <span class="token object">todos</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">TodoFields</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Le même fragment est utilisé dans deux requêtes, il est possible de mettre à jour le fragment dans les deux requêtes en une fois à condition qu'il contienne l'identifiant d'un objet.</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="0eaa6085e29a43587ea3c14eca591b43"><span class="token keyword">const</span> <span class="token maybe-class-name">TodoFields</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token graphql language-graphql">
  <span class="token keyword">fragment</span> <span class="token fragment function">TodoFields</span> <span class="token keyword">on</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">text</span>
    <span class="token property">completed</span>
  <span class="token punctuation">}</span>
</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> todo <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token method function property-access">readFragment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// identifiant de l'objet</span>
  <span class="token literal-property property">fragment</span><span class="token operator">:</span> <span class="token maybe-class-name">TodoFields</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="60b2f1fc0df54762aa0fbd7741bc07b0">client<span class="token punctuation">.</span><span class="token method function property-access">writeFragment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// identifiant de l'objet</span>
  <span class="token literal-property property">fragment</span><span class="token operator">:</span> <span class="token maybe-class-name">TodoFields</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>todo<span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2 id="mise-a-jour-automatique" class="anchor-title"><a href="#mise-a-jour-automatique">Mise à jour automatique</a></h2>
<p>Heureusement, il n'est pas toujours obligatoire de mettre manuellement à jour le cache comme ci-dessus. Il y a certains cas où le cache est automatiquement mis à jour par Apollo.</p>
<p>Lorsque vous réalisez une requête récupérant des données contenant un <code class="code-inline" id="b80bb7740288fda1f201890375a60c8f">id</code>, par exemple :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="964c827ae030b525dbe7c35cd91eadf1"><span class="token keyword">query</span> <span class="token punctuation">{</span>
  <span class="token property-query">Foobar</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Puis une mutation utilisante le même <code class="code-inline" id="b80bb7740288fda1f201890375a60c8f">id</code> :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="a44cf8166e9b714e21778608ecb99831"><span class="token keyword">mutation</span> <span class="token punctuation">{</span>
  <span class="token property-query property-mutation">UpdateFoobar</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token string">"Updated name"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Apollo a compris que vous intervenez sur le même objet (même type et meme id). Le cache sera alors automatiquement mis à jour et la propriété <code class="code-inline" id="b068931cc450442b63f5b3d276ea4297">name</code> sera modifiée partout. Attention par contre, le cache sera mis à jour avec les données renvoyées par la mutation, il faut donc bien faire attention à sélectionner les données que l'on souhaite modifier dans le cache.</p>
<p>Je vous parlais du côté <em>state manager</em> du cache, et bien c'est ce qui se passe ici. Les objets y sont stockés avec une clé de cache de façon à pouvoir mettre à jour tous les résultats de requête concernés en une fois lorsque que l'un d'eux est modifié (sous couvert qu'ils soient identifiables par un <code class="code-inline" id="b80bb7740288fda1f201890375a60c8f">id</code> évidemment).</p>
<h2 id="configurer-le-cache" class="anchor-title"><a href="#configurer-le-cache">Configurer le cache</a></h2>
<p>Si vos objets n'ont pas de propriété <code class="code-inline" id="b80bb7740288fda1f201890375a60c8f">id</code> mais une propriété <code class="code-inline" id="ef7c876f00f3acddd00fa671f52d0b1f">uuid</code> par exemple, il est possible de configurer le cache pour l'utiliser et conserver la mise à jour automatique :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="b175c489f59df8e8479ce6756e136b46"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">InMemoryCache</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-cache-inmemory'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">HttpLink</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-link-http'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ApolloClient</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-client'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> link <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">dataIdFromObject</span><span class="token operator">:</span> <span class="token parameter">object</span> <span class="token arrow operator">=&gt;</span> object<span class="token punctuation">.</span><span class="token property-access">uuid</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span> link<span class="token punctuation">,</span> cache <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Il est également possible de définir cet identifiant selon le type de l'objet :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="f6d138920fb87d5128798cf7baef04d8"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">InMemoryCache</span><span class="token punctuation">,</span> defaultDataIdFromObject <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-cache-inmemory'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">dataIdFromObject</span><span class="token operator">:</span> <span class="token parameter">object</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token property-access">__typename</span> <span class="token operator">===</span> <span class="token string">'Todo'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> object<span class="token punctuation">.</span><span class="token property-access">uuid</span>
    <span class="token punctuation">}</span>

    <span class="token keyword control-flow">return</span> <span class="token function">defaultDataIdFromObject</span><span class="token punctuation">(</span>ojbect<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>D'autres configurations sont possibles, je vous encourage à lire <a href="https://www.apollographql.com/docs/react/caching/cache-configuration/" target="_blank">la documentation à ce sujet</a> pour les découvrir.</p>
<h2 id="redirection-de-cache" class="anchor-title"><a href="#redirection-de-cache">Redirection de cache</a></h2>
<p>Dans certains cas, les données que vous requêtez peuvent déjà être présentes dans le cache d'une autre requête. L'exemple typique est lorsque vous fait un requête listant des objets, puis plus tard une requête avec les mêmes données retournant l'un de ces objets.</p>
<p>Par exemple pour la liste :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="fcb50093e482c3648ce36593546aabbf"><span class="token keyword">query</span> <span class="token definition-query function">Todos</span> <span class="token punctuation">{</span>
  <span class="token object">todos</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">text</span>
    <span class="token property">completed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Puis pour les détails :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="50b5f800bf6d61baf71ee6269a8627f2"><span class="token keyword">query</span> <span class="token definition-query function">Todo</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">todo</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">text</span>
    <span class="token property">completed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Les deux requêtes utilisent les même données mais Apollo fera la seconde requête même si l'objet est déjà dans le cache de la première car les données ne sont pas stockées avec la même clé de cache.</p>
<p>La redirection de cache permettra d'aller chercher ces données dans le cache d'une autre requête.</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="395d3fcfc81c38e4d143ad0342829c32"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">InMemoryCache</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-cache-inmemory'</span>

<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">cacheRedirects</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">Query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function"><span class="token maybe-class-name">Todo</span></span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span> getCacheKey <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
        <span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">__typename</span><span class="token operator">:</span> <span class="token string">'Todo'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> args<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2 id="gerer-la-suppression-de-donnees" class="anchor-title"><a href="#gerer-la-suppression-de-donnees">Gérer la suppression de données</a></h2>
<p>Si la mise à jour automatique est simple (un objet identifié par son ID peut être mise à jour automatiquement pour toutes les requêtes dans le cache), c'est un peu plus compliqué pour les suppressions.</p>
<p>Comme pour l'ajout, vous allez devoir mettre à jour manuellement le cache de chaque requête retournant la donnée supprimée.</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="d6e8c8cd16f739f59b5c3b9899bae2bc"><span class="token keyword">const</span> <span class="token constant">REMOVE_TODO</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token graphql language-graphql">
  <span class="token keyword">mutation</span> <span class="token definition-mutation function">RemoveTodo</span><span class="token punctuation">(</span><span class="token variable variable-input">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property-query property-mutation">RemoveTodo</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable variable-input">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span><span class="token template-punctuation string">`</span></span>

client
  <span class="token punctuation">.</span><span class="token method function property-access">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mutation</span><span class="token operator">:</span> <span class="token constant">REMOVE_TODO</span><span class="token punctuation">,</span>
    <span class="token literal-property property">variables</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">cache<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token maybe-class-name">RemoveTodo</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Mise à jour du cache de la requête TODOS</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Todos</span> <span class="token punctuation">}</span> <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token method function property-access">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">TODOS</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token maybe-class-name">NewTodos</span> <span class="token operator">=</span> <span class="token maybe-class-name">Todos</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=&gt;</span> todo<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> <span class="token maybe-class-name">RemoveTodo</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span>

      cache<span class="token punctuation">.</span><span class="token method function property-access">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">TODOS</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">Todos</span><span class="token operator">:</span> <span class="token maybe-class-name">NewTodos</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// Mise à jour du cache de la requête TODO(3)</span>
      cache<span class="token punctuation">.</span><span class="token method function property-access">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">TODO</span><span class="token punctuation">,</span>
        <span class="token literal-property property">variables</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">Todo</span><span class="token operator">:</span> <span class="token keyword null nil">null</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Avouons le, cela peut vite devenir long et fastidieux si une ressource apparaît dans beaucoup de requêtes différentes. Il existe actuellement <a href="https://github.com/apollographql/apollo-feature-requests/issues/4" target="_blank">une <em>feature request</em></a> pour palier à cela et proposer un moyen de supprimer simplement un objet dans l'ensemble du cache. La fonctionnalité semble prévue dans la <em>roadmap</em> de version 3.0 du client.</p>
<p>En attendant, plusieurs <em>workarounds</em> temporaires sont proposés dans ce même post, j'utilise <a href="https://github.com/apollographql/apollo-feature-requests/issues/4#issuecomment-437041503" target="_blank">celui-ci</a> :</p>
<p>Dans le fichier instanciant votre cache, ajoutez la fonction suivante :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="41753cb8799b23cc6ce2066867e95a55"><span class="token doc-comment comment">/**
 * Recursively delete all properties matching with the given predicate function in the given value
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> <span class="token parameter">value</span>
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Function<span class="token punctuation">}</span></span> <span class="token parameter">predicate</span>
 * <span class="token keyword">@return</span> the number of deleted properties or indexes
 */</span>
<span class="token keyword">function</span> <span class="token function">deepDeleteAll</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> predicate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">predicate</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">.</span><span class="token method function property-access">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        count<span class="token operator">++</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        count <span class="token operator">+=</span> <span class="token function">deepDeleteAll</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> predicate<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">predicate</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">delete</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        count<span class="token operator">++</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        count <span class="token operator">+=</span> <span class="token function">deepDeleteAll</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> predicate<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> count
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Improve InMemoryCache prototype with a function deleting an entry and all its
 * references in cache.
 */</span>
<span class="token class-name">InMemoryCache</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">delete</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// get entry id</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token method function property-access">dataIdFromObject</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>

  <span class="token comment">// delete all entry references from cache</span>
  <span class="token function">deepDeleteAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">,</span> <span class="token parameter">ref</span> <span class="token arrow operator">=&gt;</span> ref <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ref<span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'id'</span> <span class="token operator">&amp;&amp;</span> ref<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// delete entry from cache (and trigger UI refresh)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>Ainsi, pour vous simplement appeler la méthode <code class="code-inline" id="52a6a5acdd1c6a1a48c21bcf6eeb124a">cache.delete(entry)</code> dans l'<code class="code-inline" id="3ac340832f29c11538fbe2d6f75e8bcc">update</code> de votre mutation pour supprimer totalement l'objet du cache.</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="c3c8e592b9d55eb0f2c53aa101b4831b">client
  <span class="token punctuation">.</span><span class="token method function property-access">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mutation</span><span class="token operator">:</span> <span class="token constant">REMOVE_TODO</span><span class="token punctuation">,</span>
    <span class="token literal-property property">variables</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> todo<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token parameter">cache</span> <span class="token arrow operator">=&gt;</span> cache<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2 id="fetch-policy" class="anchor-title"><a href="#fetch-policy">Fetch policy</a></h2>
<p>Pour chaque requête vous pouvez configurer l'option <code class="code-inline" id="756c4ea0f96895611e6721021bca7112">fetchPolicy</code> afin d'indiquer à Apollo comment utiliser le cache.</p>
<ul>
<li><code class="code-inline" id="ae90bbf1549b5dc9ad755458a2d09cf2">cache-first</code> : c'est la valeur par défaut, le client recherche le résultat dans le cache avant de faire une requête.</li>
<li><code class="code-inline" id="55e6be0c60b430d2c54d3d8e104735d4">cache-and-network</code> : le client retournera le contenu du cache mais fera tout de même la requête afin de le mettre à jour, permet d'avoir une réponse rapide.</li>
<li><code class="code-inline" id="9dfabc18d8b0830701675915eacda927">network-only</code> : le client ne retournera jamais le contenu du cache pour cette requête et fera systématiquement un appel réseau.</li>
<li><code class="code-inline" id="d08cccb388110b519688b7d507db8a0b">cache-only</code> : le client ne fera aucun appel réseau et se contentera de lire le cache.</li>
<li><code class="code-inline" id="00bc63c3a47875d37eb7004340988ca4">no-cache</code> : le client fera un appel réseau et ne lira pas le cache, mais au contraire de <code class="code-inline" id="9dfabc18d8b0830701675915eacda927">network-only</code>, le résultat de la requête ne sera pas écrit dans le cache.</li>
</ul>
<h2 id="persistence" class="anchor-title"><a href="#persistence">Persistence</a></h2>
<p>Par défaut, le cache Apollo utilise l'adapteur <code class="code-inline" id="e7e257ea4465b7f923b3e2b116f1782e">InMemoryCache</code> qui comme son nom l'indique, stocke le cache en mémoire. Dans le cas d'une application web, chaque actualisation de la page ou nouvel onglet remet le cache à zéro. En cas d'app native, cela se fera à chaque fermeture de l'app.</p>
<p>Heureusement il est possible de <a href="https://github.com/apollographql/apollo-cache-persist#storage-providers" target="_blank">persister le cache</a> de façon non volatile en fournissant un <em>storage provider</em>. En <em>local storage</em> pour du web par exemple, ou encore dans une base <em>SQLite</em> ou en fichier pour les app natives.</p>
<p>Par exemple avec du <em>local storage</em> :</p>
<pre class="code-multiline language-javascript"><code class="language-javascript" id="8da84f138f73c2596fe9e84f286652e2"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">InMemoryCache</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-cache-inmemory'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> persistCache <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-cache-persist'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">persistCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token punctuation">,</span>
  <span class="token literal-property property">storage</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">localStorage</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2 id="conclusion" class="anchor-title"><a href="#conclusion">Conclusion</a></h2>
<p>Cet article n'est qu'un petit aperçu des possibilités offertes par le cache Apollo. Pour plus de détails, je vous conseille de lire attentivement les documentations très complètes sur la <a href="https://www.apollographql.com/docs/react/caching/cache-configuration/" target="_blank">configuration du cache</a> et la <a href="https://www.apollographql.com/docs/react/caching/cache-interaction/" target="_blank">manipulation de cache</a> qui ont inspiré cet article.</p>
                                                                </main>
            <aside class="article-content__aside">
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a href="/elao_/pr/660/blog/auteur/mcolin">
                                <img     src="/elao_/pr/660/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg"
    srcset="
        /elao_/pr/660/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/cb69b0afe176d65ea7c1da7e712cac13.jpg 1x,
        /elao_/pr/660/%2E%2E/../resized/content/images/members/avatars/mcolin.jpg/0899bdf7169af336de983de73d88fa58.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a href="/elao_/pr/660/blog/auteur/mcolin">
                                <strong>Maxime Colin</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                            <a
                                    href="https://twitter.com/colin_maxime"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--x" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Twitter de Maxime Colin</span>
                                </a>
                                                                                        <a
                                    href="https://bsky.app/profile/maximecolin.bsky.social"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--bluesky" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Bluesky de Maxime Colin</span>
                                </a>
                                                                                        <a
                                    href="https://github.com/maximecolin"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Maxime Colin</span>
                                </a>
                                                                                        <a href="https://www.maximecolin.fr/"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Maxime Colin</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/feature/add-carriere-page/content/blog/dev/apollo-graphql-cache.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/660/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/660/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/660/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/660/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/660/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/660/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/660/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                                                <a href="/elao_/pr/660/recrutement">
                            Nous recrutons
                                                            <span class="bullet">1</span>
                                                    </a>
                    </li>
                    <li>
                        <a href="/elao_/pr/660/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/660/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                    <li>
                        <a href="https://bsky.app/profile/elao.com" target="_blank">
                            <i class="icon icon--bluesky"></i>
                            Bluesky
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            X
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/pr/660/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2025 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/660/legal">Mentions légales</a>
            <a href="/elao_/pr/660/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
