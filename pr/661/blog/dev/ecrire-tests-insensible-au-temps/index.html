<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Guide pratique pour l&#039;écriture de tests sensibles au temps</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/661/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/661/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/661/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/661/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/661/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/661/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/661/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Une logique basée sur des éléments temporels complique la rédaction de scénarios fiables dans le temps.
Heureusement, des solutions existent. Démonstration avec Symfony, PHPUnit et Foundry.
" />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/661/blog/dev/ecrire-tests-insensible-au-temps" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Guide pratique pour l&#039;écriture de tests sensibles au temps" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Une logique basée sur des éléments temporels complique la rédaction de scénarios fiables dans le temps.
Heureusement, des solutions existent. Démonstration avec Symfony, PHPUnit et Foundry.
" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/661/blog/dev/ecrire-tests-insensible-au-temps" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/6d7e2adc0f256610ecb3bb2ba91da452.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Guide pratique pour l&#039;écriture de tests sensibles au temps">
            <meta property="twitter:description" content="Une logique basée sur des éléments temporels complique la rédaction de scénarios fiables dans le temps.
Heureusement, des solutions existent. Démonstration avec Symfony, PHPUnit et Foundry.
">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/69fa902f4a3dcea40f40eeb43551695b.jpg">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/pr/661/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Guide pratique pour l'écriture de tests sensibles au temps",
    "image": [
        "https://elao.github.io/elao_/pr/661/blog/dev/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg"
    ],
    "datePublished": "2025-04-08T00:00:00+00:00",
    "dateModified": "2025-06-19T11:25:26+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Maxime Steinhausser",
            "url": "https://elao.github.io/elao_/pr/661/equipe/msteinhausser"
        }
    ],
    "keywords": [
        "Php",
        "Tests",
        "Clock",
        "Symfony"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/661/build/app.aecfe014.css">
        
                        <script src="/elao_/pr/661/build/runtime.3f493997.js" defer></script><script src="/elao_/pr/661/build/947.b56b79b1.js" defer></script><script src="/elao_/pr/661/build/769.7dfbbe52.js" defer></script><script src="/elao_/pr/661/build/app.e47fd89c.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;661&#x5C;&#x2F;build&#x5C;&#x2F;see.80fe75b7.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;661&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;661&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;661&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;661&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/661/">
                        <span class="screen-reader">Guide pratique pour l&#039;écriture de tests sensibles au temps</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/pr/661/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/661/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/pr/661/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/661/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/661/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/661/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/661/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Guide pratique pour l&#039;écriture de tests sensibles au temps</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/7d97a423042832c7bcf7d8089aed5335.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/7d97a423042832c7bcf7d8089aed5335.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/2648562c93ee51110cdb21b57793d161.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/7d97a423042832c7bcf7d8089aed5335.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/2648562c93ee51110cdb21b57793d161.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/7d97a423042832c7bcf7d8089aed5335.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/2648562c93ee51110cdb21b57793d161.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/7d97a423042832c7bcf7d8089aed5335.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/thumbnail-cm8olxtb700072y22fq10ubtr.jpg/2648562c93ee51110cdb21b57793d161.jpg') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a href="/elao_/pr/661/blog/auteur/msteinhausser">
                                    <img     src="/elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg"
    srcset="
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg 1x,
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/079e97b32e0b5c6cbde07e847b4423d4.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/pr/661/blog/auteur/msteinhausser">
                                    <strong>Maxime Steinhausser</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>8 avril 2025</strong></span>
                                                                <span>Modification <strong>19 juin 2025</strong></span>
                                    </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Guide pratique pour l&#039;écriture de tests sensibles au temps</h1>
                <p>Une logique basée sur des éléments temporels complique la rédaction de scénarios fiables dans le temps.
Heureusement, des solutions existent. Démonstration avec Symfony, PHPUnit et Foundry.
</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/661/blog/tag/php" rel="nofollow">#Php</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/661/blog/tag/tests" rel="nofollow">#Tests</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/661/blog/tag/clock" rel="nofollow">#Clock</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/661/blog/tag/symfony" rel="nofollow">#Symfony</a>
                        </li>
                                    </ul>
            </div>
        </div>

                    <ol class="table-of-content" data-aos="fade-up">
                                    <li class="table-of-content__item">
                        <a href="#contexte">Contexte</a>

                                                    <ol class="table-of-content__sub-level">
                                                                        <li>
                                            <a href="#le-projet">Le projet</a>
                                        </li>
                                                                        <li>
                                            <a href="#les-tests">Les tests</a>
                                        </li>
                                                                        <li>
                                            <a href="#les-donnees-de-test">Les données de test</a>
                                        </li>
                                                                        <li>
                                            <a href="#les-snapshots">Les snapshots</a>
                                        </li>
                                                            </ol>
                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#solutions">Solutions</a>

                                                    <ol class="table-of-content__sub-level">
                                                                        <li>
                                            <a href="#modifications-dans-le-code">Modifications dans le code</a>
                                        </li>
                                                                        <li>
                                            <a href="#modifications-dans-les-tests">Modifications dans les tests</a>
                                        </li>
                                                            </ol>
                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#historique">Historique</a>

                                            </li>
                                    <li class="table-of-content__item">
                        <a href="#liens-references">Liens &amp; références</a>

                                            </li>
                            </ol>
        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <p>Tester du code dont la logique repose sur le temps peut compliquer l'écriture de scénarios de tests. Il s'agit de l'une
des erreurs les plus courantes pouvant mener à des tests fragiles et produisant des échecs hasardeux.<br>
Cette typologie de tests menant à des erreurs "aléatoires" est appelée <dfn>transient tests</dfn> car ceux-ci dépendent
d'un ou plusieurs facteurs parasites et non-maitrisés. Ici, l'élément parasite est le temps et l'horloge système.</p>
<h2 id="contexte" class="anchor-title"><a href="#contexte">Contexte</a></h2>
<p>Au travers d'un exemple concret au sein d'une application Symfony, nous allons voir comment écrire des tests insensibles
au temps avec PHPUnit et Foundry.</p>
<h3 id="le-projet" class="anchor-title"><a href="#le-projet">Le projet</a></h3>
<p>L'un de nos projets est connecté à un CRM externe et récupère une liste d'opportunités pour lesquelles les utilisateurs
de notre application pourront créer une ou plusieurs simulations. Ces opportunités sont ensuite exposées au sein de
différentes listes.
L'une d'entre elle consiste en un historique des "dossiers clients" des X derniers mois.</p>
<p>Notre application Symfony consiste en une API GraphQL, consommée par une application front en React. La liste de
dossiers client est alors disponible au travers de la requête GraphQL suivante :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="5897ab6215fd88f1a0c18412fc4b86e7"><span class="token keyword">query</span> <span class="token definition-query function">ListOpportunities</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">:</span> <span class="token class-name">ListOpportunitiesQueryLimit</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">listOpportunities</span><span class="token punctuation">(</span><span class="token attr-name">limit</span><span class="token punctuation">:</span> <span class="token variable">$limit</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">uid</span>
    <span class="token property">crmId</span> <span class="token comment"># Identifiant sur le CRM</span>
    <span class="token property">firstAppointmentDate</span> <span class="token comment"># Date de 1er RDV</span>
    <span class="token property">createdAt</span> <span class="token comment"># Date de création de l'opportunité</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>où <code class="code-inline" id="d66edb341fae53c54a93f8a6a6dd081e">ListOpportunitiesQueryLimit</code> correspond à :</p>
<pre class="code-multiline language-graphql"><code class="language-graphql" id="6b11c74b716ea52975eaf7c1f15c9d98"><span class="token keyword">input</span> <span class="token object">ListOpportunitiesQueryLimit</span> <span class="token punctuation">{</span>
  <span class="token description string">"""<span class="token language-markdown">
  Nombre de mois à remonter.
  Par défaut, les 6 derniers mois.
  </span>"""</span>
  <span class="token attr-name">months</span><span class="token punctuation">:</span> <span class="token scalar">Int</span>
<span class="token punctuation">}</span></code></pre>
<p>Dans cette liste, nous espérons retrouver l'ensemble des opportunités pour lesquelles un critère ou une activité
significative a été réalisé dans les 6 derniers mois :</p>
<ul>
<li>l'opportunité a été créée dans les 6 derniers mois</li>
<li>la date de premier rendez-vous est dans les 6 derniers mois</li>
<li>une simulation a été créée dans les 6 derniers mois (<em>pour simplifier ici, nous omettrons ce cas de la démonstration</em>)</li>
</ul>
<p>Notre <em>repository</em> ressemble alors à ceci :</p>
<pre class="code-multiline language-php"><code class="language-php" id="fbb69a791803ac831c714f368b351d2e"><span class="token keyword">interface</span> <span class="token class-name-definition class-name">OpportunityRepositoryInterface</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * List all opportunities for the customer records listing, i.e. opportunities that:
     * - are created within
     * - with an appointment date within
     * - or with simulations created during
     * the last X months.
     *
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token keyword">int</span></span> <span class="token parameter">$months</span> The number of months to look back.
     *
     * <span class="token keyword">@return</span> <span class="token class-name">Opportunity<span class="token punctuation">[</span><span class="token punctuation">]</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">findAllForRecords</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$months</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>et son implémentation :</p>
<pre class="code-multiline language-php"><code class="language-php" id="26b9360457ba1b46bf300d6b6bdfcea4"><span class="token keyword">class</span> <span class="token class-name-definition class-name">OpportunityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceEntityRepository</span> <span class="token keyword">implements</span> <span class="token class-name">OpportunityRepositoryInterface</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ManagerRegistry</span> <span class="token variable">$registry</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token scope"><span class="token keyword">parent</span><span class="token punctuation">::</span></span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$registry</span><span class="token punctuation">,</span> <span class="token scope">Opportunity<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">findAllForRecords</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$months</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$since</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeImmutable</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"-<span class="token interpolation"><span class="token variable">$months</span></span> months"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">(</span><span class="token variable">$qb</span> <span class="token operator">=</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'opportunity'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// […]</span>
            <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$qb</span><span class="token operator">-&gt;</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">orX</span><span class="token punctuation">(</span>
                <span class="token string single-quoted-string">'opportunity.createdAt &gt;= :since'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'opportunity.firstAppointmentDate &gt;= :since'</span><span class="token punctuation">,</span>
                <span class="token comment">// […]</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'since'</span><span class="token punctuation">,</span> <span class="token variable">$since</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token variable">$qb</span><span class="token operator">-&gt;</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="les-tests" class="anchor-title"><a href="#les-tests">Les tests</a></h3>
<p>Pour tester ce fonctionnel API, nous avons pour habitude d'opter pour des tests fonctionnels, en utilisant PHPUnit avec
un boilerplate personnalisé basé sur le <code class="code-inline" id="b14eeed2817c718fb8c990fcc8c5ab0d">WebTestCase</code> de Symfony :</p>
<pre class="code-multiline language-php"><code class="language-php" id="78f26c9f9aeb3971300facc04b12bbd6"><span class="token keyword">class</span> <span class="token class-name-definition class-name">OpportunityTest</span> <span class="token keyword">extends</span> <span class="token class-name">GraphQLTestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">ResetDatabase</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@dataProvider</span> provide testListAsCustomerRecords data
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testListAsCustomerRecords</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token keyword type-hint">array</span> <span class="token variable">$limit</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Chargement des données de test</span>
        <span class="token scope">ListAsCustomerRecordsStory<span class="token punctuation">::</span></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Execution de la requête GraphQL</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">executeGraphQL</span><span class="token punctuation">(</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getTestCaseInputContent</span><span class="token punctuation">(</span><span class="token argument-name">withDataSetName</span><span class="token punctuation">:</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assertions</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">assertValidGraphQLResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">assertJsonResponseMatchesExpectations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> provide testListAsCustomerRecords <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">iterable</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token string single-quoted-string">'use default month limit'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token constant">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token string single-quoted-string">'last 6 months'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'months'</span> <span class="token operator">=&gt;</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token string single-quoted-string">'last month'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'months'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>L'expression de nos scénarios de tests GraphQL est relativement concise et uniforme : nous chargeons des données de
test, exécutons une requête et vérifions la validité de la réponse. Enfin, nous faisons une assertion sur le
contenu de la réponse sur le principe du <strong>« Snapshot testing »</strong>, c'est-à-dire en comparant le contenu de la réponse
avec un fichier de référence, préalablement enregistré.  </p>
<p>Ici, un fichier par jeu retourné par le fournisseur de données (<code class="code-inline" id="a482093bd4fce9e33252356b4ad1cfa7">dataProvider</code>):</p>
<ul>
<li><code class="code-inline" id="87bca798fce7c28bf946ec216b44d52e">./expected/testListAsCustomerRecords with data set "use default month limit".json</code></li>
<li><code class="code-inline" id="a0d77337e9a9e2db911638573df2ba7a">./expected/testListAsCustomerRecords with data set "last 6 months".json</code></li>
<li><code class="code-inline" id="4044319a977098e7a607190b40ffb5bf">./expected/testListAsCustomerRecords with data set "last month".json</code></li>
</ul>
<figure style="max-width: 700px; margin-left: auto; margin-right: auto">
    <img src="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/snapshot-testing-cm8na7g4c00002y22z6a4vmkm.png/37ef5d02c45b63853795d42555484526.png" alt="Principe de nos tests fonctionnels avec snapshot testing" srcset="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/snapshot-testing-cm8na7g4c00002y22z6a4vmkm.png/37ef5d02c45b63853795d42555484526.png 1x,
/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/snapshot-testing-cm8na7g4c00002y22z6a4vmkm.png/ae452c016d1282b7ac13a3111c1ff18e.png 2x," id="principe-de-nos-tests-fonctionnels-avec-snapshot-testing">
    <figcaption>
        <span class="figure__legend">
            Principe de nos tests fonctionnels avec snapshot testing <br>
            — <a href="https://x.com/Milidru/status/1698346706926993550" target="_blank">Illustration de Romane LEDRU, sur X</a>
        </span>
    </figcaption>
</figure>
<div class="admonition note">
<p>
    Nous ferons l'impasse sur le détail des méthodes <code class="code-inline" id="063fab832f8954ef0573bad1d1fe9ca5">executeGraphQL</code>, <code class="code-inline" id="cb1447d30ada6402caa4ea8f66a91b99">assertValidGraphQLResponse</code> et
    <code class="code-inline" id="0536133b831d9f370d617d162ccd018e">assertJsonResponseMatchesExpectations</code> qui sont propres à notre <code class="code-inline" id="09260b4233dabf42f5ff1268fe52094d">GraphQLTestCase</code>.
    Elles permettent de rédiger succinctement des tests en se basant sur quelques conventions.<br>
    Notamment, le fichier <code class="code-inline" id="5815b324f80d0c48389c5e726f43edd1">./inputs/testListAsCustomerRecords.graphql</code> est automatiquement utilisé en tant que
    requête GraphQL à exécuter. Les fichiers de référence (nos <em>snapshots</em>, ou <em>expectations</em>) sont chargés depuis
    <code class="code-inline" id="a1208b350b582d5156e22ebd8870d2be">./expected/&lt;nom-du-test-case&gt;.json</code> et comparés avec le contenu réel de la réponse au moment de l'exécution du test.
</p>
</div>
<div class="admonition success">
<p class="admonition-title">Pour aller plus loin</p>
<p>
    Il existe aussi des bibliothèques clé en main pour gérer ce type de tests, telles que <a href="https://github.com/spatie/phpunit-snapshot-assertions" target="_blank">spatie/phpunit-snapshot-assertions</a> ou <a href="https://pestphp.com/docs/snapshot-testing" target="_blank">Pest PHP</a>.
</p>
</div>
<h3 id="les-donnees-de-test" class="anchor-title"><a href="#les-donnees-de-test">Les données de test</a></h3>
<p>Le plus gros du travail dans l'écriture de tests fonctionnels consiste à rédiger les données de test. Pour ce faire,
nous utilisons <a href="https://symfony.com/bundles/ZenstruckFoundryBundle/current/index.html" target="_blank">Foundry</a> et des
<a href="https://symfony.com/bundles/ZenstruckFoundryBundle/current/index.html#stories" target="_blank">stories</a> pour chaque ensemble de cas à
tester.</p>
<p>Voici un extrait de notre <em>story</em> <code class="code-inline" id="cf6798cd0e1e83bab487ab7b24016765">ListAsCustomerRecordsStory</code> : </p>
<pre class="code-multiline language-php"><code class="language-php" id="60ca4e7daf3f0507e3cc4002c67e6a32"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ListAsCustomerRecordsStory</span> <span class="token keyword">extends</span> <span class="token class-name">Story</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * - an opportunity in last month
     * - an opportunity in last 2 months
     * - an opportunity in last 7 months, but with 1st appointment date within the last 2 months
     *
     * =&gt; All of these opportunities MUST appear in the last 6 months listing
     * =&gt; Only the 1st opportunity MUST appear in the last month listing
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token scope">OpportunityFactory<span class="token punctuation">::</span></span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'uid'</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Ulid</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'01JP8C11XJTGK5BAZRVK84PTF8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'crmId'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'id-C01-OP01******'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'createdAt'</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeImmutable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-1 month'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'firstAppointmentDate'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token scope">OpportunityFactory<span class="token punctuation">::</span></span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'uid'</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Ulid</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'01JP8C0XPS4GWC47QZY4QDYEY0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'crmId'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'id-C01-OP02******'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'createdAt'</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeImmutable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-2 months'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'firstAppointmentDate'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token scope">OpportunityFactory<span class="token punctuation">::</span></span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'uid'</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Ulid</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'01JP8CY28NBS5JXEA1FRX81WGK'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'crmId'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'id-C01-OP03******'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'createdAt'</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeImmutable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-7 months'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'firstAppointmentDate'</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateTimeImmutable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-2 months'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Foundry nous permet de décrire les données que nous souhaitons injecter dans notre base de façon relativement
expressive, et son système de <a href="https://symfony.com/bundles/ZenstruckFoundryBundle/current/index.html#factories" target="_blank">factories</a>
nous permet de définir comment générer aléatoirement les données que nous ne souhaitons pas explicitement spécifier pour
ce test.</p>
<p><em>Snapshot testing</em> oblige, nous avons néanmoins besoins de données stables ou prédictibles.
C'est pourquoi l'ensemble des champs qui apparaitront dans notre query GraphQL doivent avoir une valeur fixe et connue.</p>
<div class="admonition danger">
<p class="admonition-title">Problématique</p>
<p>
    Les plus assidus d'entre vous auront déjà repéré le problème : les dates sont exprimées de façon relatives
    (<code class="code-inline" id="8c6c68754c113593801cf71daa2568e3">-1 month</code>, <code class="code-inline" id="f2a5134b8bab3eef1881ab51b954c10f">-2 months</code>, etc.) et dépendent donc du moment de l'exécution des tests.
</p>
</div>
<h3 id="les-snapshots" class="anchor-title"><a href="#les-snapshots">Les snapshots</a></h3>
<p>Voici le contenu du fichier <code class="code-inline" id="17389be5f6a9cead905eea8a8da44ca7">/expected/testListAsCustomerRecords with data set "last month".json</code>, lequel correspond au
scénario où nous ne souhaitons récupérer que les dossiers clients du dernier mois écoulé :</p>
<pre class="code-multiline language-json"><code class="language-json" id="aef72d9da162b7725739e14d3202120f"><span class="token punctuation">{</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"listOpportunities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"uid"</span><span class="token operator">:</span> <span class="token string">"01JP8C11XJTGK5BAZRVK84PTF8"</span><span class="token punctuation">,</span>
        <span class="token property">"crmId"</span><span class="token operator">:</span> <span class="token string">"id-C01-OP01******"</span><span class="token punctuation">,</span>
        <span class="token property">"firstAppointmentDate"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"createdAt"</span><span class="token operator">:</span> <span class="token string">"2025-02-24"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Le contenu de ce fichier est généré sur demande, lors de l'exécution du test, à partir des données de la réponse
elle-même. Lors d'exécutions ultérieures, le contenu de la réponse sera comparé à ce fichier de référence pour vérifier
que celle-ci est toujours conforme à ce qui est attendu (<em>ou bien que ce qui diffère est légitime</em>).</p>
<p>Les éléments apparaissant dans la réponse nous aident à identifier la bonne présence ou non des opportunités attendues :
ici, l'opportunité <code class="code-inline" id="2762e61f7b8a44cbdd87c16be21a2453">id-C01-OP01******</code> a bien été créée dans le dernier mois (à la rédaction de cet article, le 24 Mars
2025).</p>
<div class="admonition danger">
<p class="admonition-title">Problématique</p>
<p>
    Ici encore, nous avons un problème : la date de création de l'opportunité fait partie de la réponse alors que sa
    génération est relative au moment de l'exécution du test (<code class="code-inline" id="8c6c68754c113593801cf71daa2568e3">-1 month</code>).
</p>
</div>
<p>Lors de execution de ce test le lendemain, nous obtiendrons l'échec suivant :</p>
<figure>
    <img src="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/test-failure-cm8obxb0q00042y22w4azddmm.png/410db69e3b6e811e4532e1bbaceeb0eb.png" alt="Failure PHPUnit" srcset="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/test-failure-cm8obxb0q00042y22w4azddmm.png/410db69e3b6e811e4532e1bbaceeb0eb.png 1x,
/elao_/pr/661/%2E%2E/../resized/content/images/blog/2025/dev/ecrire-tests-insensible-au-temps/test-failure-cm8obxb0q00042y22w4azddmm.png/3c669548fc4f285f7d02e264b1bd3f64.png 2x," id="failure-phpunit">
    <figcaption>
        <span class="figure__legend">
            Le test échoue car la date de création de l'opportunité dans les fixtures est relative à la date d'exécution du test, tandis que la date de création dans le snapshot est fixe.
        </span>
    </figcaption>
</figure>
<p>Il ne serait pas possible d'exprimer ce test autrement, en indiquant une date absolue, car on ne pourrait alors pas
tester le fonctionnel <em>« Les dossiers clients du dernier mois »</em>  sans que ce test devienne rapidement caduque.</p>
<p>… <em><strong>à moins de modifier l'horloge de référence.</strong></em></p>
<h2 id="solutions" class="anchor-title"><a href="#solutions">Solutions</a></h2>
<h3 id="modifications-dans-le-code" class="anchor-title"><a href="#modifications-dans-le-code">Modifications dans le code</a></h3>
<p>Moyennant quelques ajustements, il est aisé de résoudre cette situation, à commencer par modifier notre <em>repository</em>
pour calculer la date à partir de laquelle récupérer nos opportunités en utilisant une horloge de référence :</p>
<pre class="code-multiline language-diff"><code class="language-diff" id="f4ada10dabecc796de8a552330f5245c">// […]
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">use Symfony\Component\Clock\ClockAwareTrait;
</span></span>
class OpportunityRepository extends ServiceEntityRepository implements OpportunityRepositoryInterface
{
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    use ClockAwareTrait;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // […]
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   public function findAllForRecords(int $months): array
</span><span class="token prefix unchanged"> </span><span class="token line">   {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">        $since = new \DateTimeImmutable("-$months months"));
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        $since = $this-&gt;now()-&gt;modify("-$months months");
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       // […]
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span></span>}</code></pre>
<p>Au lieu d'utiliser un objet <code class="code-inline" id="f854926c6ee2b49d3385c30295984295">\DateTimeImmutable</code>, basé sur l'horloge système, le trait <a href="https://github.com/symfony/symfony/blob/7.2/src/Symfony/Component/Clock/ClockAwareTrait.php" target="_blank">
<code class="code-inline" id="cbe49891380b06c5ff2769d0853975d5">ClockAwareTrait</code></a> nous
permet d'accéder à un service qui implémente <code class="code-inline" id="976ed25be31992cb3c1f1462cf57e954">ClockInterface</code>. Celui-ci nous permet de récupérer la date et heure
actuelle selon une horloge que nous pouvons contrôler arbitrairement.</p>
<h3 id="modifications-dans-les-tests" class="anchor-title"><a href="#modifications-dans-les-tests">Modifications dans les tests</a></h3>
<p>L'horloge par défaut (<a href="https://github.com/symfony/symfony/blob/7.2/src/Symfony/Component/Clock/NativeClock.php" target="_blank"><code class="code-inline" id="1b46ddd4220992f5c706f84fc64a4efa">NativeClock</code></a>)
se base sur celle du système et est identique à appeler <code class="code-inline" id="518ed7be330b47bcc1d93b4a8b250092">new \DateTimeImmutable()</code>.<br>
Mais il nous est possible de la modifier au besoin. À tout hasard, dans notre test :</p>
<pre class="code-multiline language-diff"><code class="language-diff" id="4115cc9e1982f60d481471fda81dbc35"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">use Symfony\Component\Clock\Test\ClockSensitiveTrait;
</span></span>
// […]

class OpportunityTest extends GraphQLTestCase
{
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    use ClockSensitiveTrait;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   use ResetDatabase;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   public function testListAsCustomerRecords(?array $limit): void
</span><span class="token prefix unchanged"> </span><span class="token line">   {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        // Choix d'une date de référence arbitraire, ici le 1er Septembre 2024:
</span><span class="token prefix inserted">+</span><span class="token line">        static::mockTime('2024-09-01 00:00:00');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       // Chargement des données de test
</span><span class="token prefix unchanged"> </span><span class="token line">       ListAsCustomerRecordsStory::load();
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       // Execution de la requête GraphQL
</span><span class="token prefix unchanged"> </span><span class="token line">       $this-&gt;executeGraphQL(compact('limit'), $this-&gt;getTestCaseInputContent(withDataSetName: false));
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       // Assertions
</span><span class="token prefix unchanged"> </span><span class="token line">       $this-&gt;assertValidGraphQLResponse();
</span><span class="token prefix unchanged"> </span><span class="token line">       $this-&gt;assertJsonResponseMatchesExpectations();
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // […]
</span></span>}</code></pre>
<p>La méthode <code class="code-inline" id="0758bfe800019ac05943364c334c58e8">ClockSensitiveTrait::mockTime()</code> nous permet de fixer l'horloge de référence à une date et heure arbitraire
pour toute l'exécution du test.</p>
<div class="admonition tip">
<p>
    À la fin du test, le trait <code class="code-inline" id="d5a992153f9e671f05562adb45d71780">ClockSensitiveTrait</code> s'occupe de restaurer l'horloge à son état initial.
</p>
</div>
<p>Enfin, nous devons adapter légèrement nos données de test pour utiliser cette même horloge dans notre <em>story</em> :</p>
<pre class="code-multiline language-diff"><code class="language-diff" id="3110beb8fe5355550ddf1ce19ce51fb5">// […]
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">use Symfony\Component\Clock\Clock;
</span></span>
class ListAsCustomerRecordsStory extends Story
{
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   public function build(): void
</span><span class="token prefix unchanged"> </span><span class="token line">   {   
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        $clock = Clock::get(); // Récupération de l'horloge de référence
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       OpportunityFactory::new()-&gt;create([
</span><span class="token prefix unchanged"> </span><span class="token line">           'uid' =&gt; new Ulid('01JP8C11XJTGK5BAZRVK84PTF8'),
</span><span class="token prefix unchanged"> </span><span class="token line">           'crmId' =&gt; 'id-C01-OP01******',
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">            'createdAt' =&gt; new \DateTimeImmutable('-1 month'),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">            'createdAt' =&gt; $clock-&gt;now()-&gt;modify('-1 month'),
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">           'firstAppointmentDate' =&gt; null,
</span><span class="token prefix unchanged"> </span><span class="token line">       ]);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       OpportunityFactory::new()-&gt;create([
</span><span class="token prefix unchanged"> </span><span class="token line">           'uid' =&gt; new Ulid('01JP8C0XPS4GWC47QZY4QDYEY0'),
</span><span class="token prefix unchanged"> </span><span class="token line">           'crmId' =&gt; 'id-C01-OP02******',
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">            'createdAt' =&gt; new \DateTimeImmutable('-2 months'),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">            'createdAt' =&gt; $clock-&gt;now()-&gt;modify('-2 months'),
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">           'firstAppointmentDate' =&gt; null,
</span><span class="token prefix unchanged"> </span><span class="token line">       ]);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       OpportunityFactory::new()-&gt;create([
</span><span class="token prefix unchanged"> </span><span class="token line">           'uid' =&gt; new Ulid('01JP8CY28NBS5JXEA1FRX81WGK'),
</span><span class="token prefix unchanged"> </span><span class="token line">           'crmId' =&gt; 'id-C01-OP03******',
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">            'createdAt' =&gt; new \DateTimeImmutable('-7 months'),
</span><span class="token prefix deleted">-</span><span class="token line">            'firstAppointmentDate' =&gt; new \DateTimeImmutable('-2 months'),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">            'createdAt' =&gt; $clock-&gt;now()-&gt;modify('-7 months'),
</span><span class="token prefix inserted">+</span><span class="token line">            'firstAppointmentDate' =&gt; $clock-&gt;now()-&gt;modify('-2 months'),
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       ]);
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span></span>}</code></pre>
<p>Et voilà ! En seulement quelques lignes peu structurantes, nous avons résolu notre problème : la génération de nos
données de tests reste expressive et se base sur une horloge de référence que nous pouvons contrôler arbitrairement.
Cette même horloge est partagée par notre <em>repository</em> et notre test fournit une date de référence arbitraire pour
garantir leur stabilité dans le temps.  </p>
<p>Les dates qui apparaitront dans nos <em>snapshots</em> sont alors entièrement prédictibles et stables, quel que soit le moment
d'exécution de nos tests, ou la configuration de l'horloge système : </p>
<pre class="code-multiline language-json"><code class="language-json" id="8c9948dfc00da2a9fe752560b96739fe"><span class="token punctuation">{</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"listOpportunities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"uid"</span><span class="token operator">:</span> <span class="token string">"01JP8C11XJTGK5BAZRVK84PTF8"</span><span class="token punctuation">,</span>
        <span class="token property">"crmId"</span><span class="token operator">:</span> <span class="token string">"id-C01-OP01******"</span><span class="token punctuation">,</span>
        <span class="token property">"firstAppointmentDate"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"createdAt"</span><span class="token operator">:</span> <span class="token string">"2024-08-01"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="historique" class="anchor-title"><a href="#historique">Historique</a></h2>
<p>Cette solution n'est pas nouvelle, et historiquement, des bibliothèques de manipulation de dates telles que
<a href="https://github.com/CarbonPHP/carbon" target="_blank">Carbon</a> permettent de surcharger l'horloge de référence : </p>
<pre class="code-multiline language-php"><code class="language-php" id="347975e1b356f66123c4cfa495e05f03"><span class="token scope">Carbon<span class="token punctuation">::</span></span><span class="token function">setTestNow</span><span class="token punctuation">(</span><span class="token scope">Carbon<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">09</span><span class="token punctuation">,</span> <span class="token number">01</span><span class="token punctuation">,</span> <span class="token number">00</span><span class="token punctuation">,</span> <span class="token number">00</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Seulement, cela nous oblige à passer par des objets différents des objets natifs de PHP (bien qu'il les étende) et
demande potentiellement davantage d'adaptation dans notre code si l'on souhaite bénéficier des fonctionnalités qui lui
sont propres.</p>
<p>Symfony quant à lui propose <a href="https://symfony.com/blog/new-in-symfony-2-8-clock-mocking-and-time-sensitive-tests" target="_blank">depuis la version 2.8</a>
une classe <a href="https://symfony.com/doc/current/components/phpunit_bridge.html#clock-mocking" target="_blank"><code class="code-inline" id="ba3ade5b6294de64d0e603edf3b12b41">ClockMock</code></a> au sein de son
<a href="https://symfony.com/doc/current/components/phpunit_bridge.html" target="_blank">bridge PHPUnit</a> modifiant le comportement de plusieurs
fonctions natives de PHP (<code class="code-inline" id="07cc694b9b3fc636710fa08b6922c42b">time</code>, <code class="code-inline" id="605ac13117bae148bd010f610833baad">microtime</code>, <code class="code-inline" id="c9fab33e9458412c527c3fe8a13ee37d">sleep</code>, <code class="code-inline" id="79e11e2e1ecc516520ad19a2c6c38af0">usleep</code>, …), afin de résoudre d'autres problématiques de
<em>transient tests</em> basés sur le temps.<br>
Par exemple, un appel à <code class="code-inline" id="715bc99999ef88ad30eeac2a6aad8ee5">sleep(10)</code> fera avancer l'horloge d'exactement 10 secondes, indépendamment de la charge du
serveur, et en bonus, sans bloquer réellement votre suite de tests pendant ces 10 secondes (<em>le composant Clock fournit
cette même fonctionnalité avec la classe <a href="https://github.com/symfony/symfony/blob/7.2/src/Symfony/Component/Clock/MockClock.php" target="_blank">MockClock</a></em>).</p>
<p><a href="https://github.com/php-fig/fig-standards/pull/1224" target="_blank">En 2021</a>, le groupe <a href="https://www.php-fig.org/" target="_blank">PHP-FIG</a>,
qui vise à établir des standards d'interopérabilité au sein des projets PHP, a proposé la
<a href="https://www.php-fig.org/psr/psr-20/" target="_blank">PSR-20 Clock</a> pour
<a href="https://www.php-fig.org/psr/psr-20/meta/#2-why-bother" target="_blank">analyser les pratiques existantes, leurs avantages et inconvénients</a>,
et proposer une interface qui puisse répondre à ces deux problématiques :</p>
<ul>
<li>Fournir une méthode simple et "mockable" pour obtenir une date et heure de référence </li>
<li>Favoriser l'interopérabilité entre les bibliothèques qui manipuleraient cette horloge</li>
</ul>
<p><a href="https://symfony.com/blog/new-in-symfony-6-2-clock-component" target="_blank">Symfony 6.2</a> introduit alors son composant
<a href="https://symfony.com/doc/current/components/clock.html" target="_blank"><code class="code-inline" id="98a892aea3359481ae30e7b66c44d7a8">Clock</code></a>, conçu autour de cette interface.</p>
<p>D'autres implémentations <code class="code-inline" id="bcd95b321514c6be52927351aa423329">psr/clock-implementation</code>, dont celles qui ont fait office de références pour les auteurs de
la PSR-20, sont disponibles sur Packagist: <a href="https://packagist.org/providers/psr/clock-implementation" target="_blank">https://packagist.org/providers/psr/clock-implementation</a></p>
<h2 id="liens-references" class="anchor-title"><a href="#liens-references">Liens &amp; références</a></h2>
<ul>
<li><a href="https://www.php-fig.org/psr/psr-20/" target="_blank">La PSR-20 Clock</a> et sa <a href="https://www.php-fig.org/psr/psr-20/meta/" target="_blank">méta-analyse de l'écosystème PHP sur le sujet</a></li>
<li><a href="https://symfony.com/doc/current/components/clock.html" target="_blank">La documentation du composant Clock de Symfony</a></li>
<li><a href="https://symfony.com/blog/new-in-symfony-2-8-clock-mocking-and-time-sensitive-tests" target="_blank">New in Symfony 2.8 - Clock mocking and time sensitive tests</a></li>
<li><a href="https://symfony.com/blog/new-in-symfony-6-2-clock-component" target="_blank">New in Symfony 6.2 - Clock Component</a></li>
<li><a href="https://symfony.com/doc/current/components/clock.html#writing-time-sensitive-tests" target="_blank">« Writing Time-Sensitive Tests »</a> dans la doc Symfony</li>
<li><a href="https://symfony.com/doc/current/components/phpunit_bridge.html#clock-mocking" target="_blank">La documentation du ClockMock du bridge PHPUnit de Symfony</a></li>
<li><a href="https://github.com/CarbonPHP/carbon" target="_blank">Carbon PHP</a></li>
</ul>
                                                                </main>
            <aside class="article-content__aside">
                                    <a href="https://twitter.com/intent/like?tweet_id=1909513841374806184" class="kudo" target="_blank">
                        <span class="kudo__button" aria-hidden="true"></span>
                        <span class="screen-reader">Cet article m’a été utile</span>
                        <span class="kudo__label" aria-hidden="true">Kudos</span>
                    </a>
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a href="/elao_/pr/661/blog/auteur/msteinhausser">
                                <img     src="/elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg"
    srcset="
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/082fd0188892e254eb0d7604e793767c.jpg 1x,
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/msteinhausser.jpg/079e97b32e0b5c6cbde07e847b4423d4.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a href="/elao_/pr/661/blog/auteur/msteinhausser">
                                <strong>Maxime Steinhausser</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                            <a
                                    href="https://twitter.com/ogizanagi"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--x" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Twitter de Maxime Steinhausser</span>
                                </a>
                                                                                        <a
                                    href="https://bsky.app/profile/ogizanagi.bsky.social"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--bluesky" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte Bluesky de Maxime Steinhausser</span>
                                </a>
                                                                                        <a
                                    href="https://github.com/ogizanagi"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Maxime Steinhausser</span>
                                </a>
                                                                                        <a href="https://shiningame.maxime-steinhausser.fr/"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--website" aria-hidden="true"></i>
                                    <span class="screen-reader">Site personnel de Maxime Steinhausser</span>
                                </a>
                                                    </div>
                    </div>
                                    </div>

                <div class="bricks">
                            <div class="brick-comment">
                    <p class="title">Commenter</p>
                    <p>
                        Des commentaires ?
                        <a href="https://twitter.com/Elao/status/1909513841374806184" target="_blank" class="animated-link animated-link--light">
                            Poursuivons la discussion sur twitter !
                        </a>
                    </p>
                    <div id="tweet-container" class="tweet-container" data-tweet-id="1909513841374806184"></div>
                </div>
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/fix/carrire-social-links/content/blog/dev/ecrire-tests-insensible-au-temps.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/661/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/661/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                        <a href="/elao_/pr/661/carriere">Page Carrière</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/661/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/661/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                    <li>
                        <a href="https://bsky.app/profile/elao.com" target="_blank">
                            <i class="icon icon--bluesky"></i>
                            Bluesky
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            X
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/pr/661/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2025 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/661/legal">Mentions légales</a>
            <a href="/elao_/pr/661/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
