<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/661/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/661/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/661/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/661/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/661/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/661/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/661/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/661/blog/dev/installation-et-premiers-pas-avec-le-plugin-symfony-sfimagetransformextraplugin" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin." />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/661/blog/dev/installation-et-premiers-pas-avec-le-plugin-symfony-sfimagetransformextraplugin" />
            <meta property="og:site_name" content="elao_" />

                                        <meta property="og:image" content="https://elao.github.io/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/da4b42c9d834d84950f160ae43e86ca1.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin">
            <meta property="twitter:description" content="Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin.">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/a26ce16a320fea8b0508c7f9302fb3c4.jpg">
                            <link rel="alternate" type="application/rss+xml" href="/elao_/pr/661/blog/rss.xml" title="Le blog de l'équipe d'Elao" />
        
                <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin",
    "image": [
        "https://elao.github.io/elao_/pr/661/blog/dev/content/images/blog/thumbnails/toad.jpg"
    ],
    "datePublished": "2010-07-12T00:00:00+00:00",
    "dateModified": "2010-07-12T00:00:00+00:00",
    "author": [
        {
            "@type": "Person",
            "name": "Xavier R",
            "url": "https://elao.github.io/elao_/pr/661/equipe/xavierr"
        }
    ],
    "keywords": [
        "Developpement",
        "Php",
        "Symfony"
    ]
}
    </script>
    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/661/build/app.d7834fff.css">
        
                        <script src="/elao_/pr/661/build/runtime.3f493997.js" defer></script><script src="/elao_/pr/661/build/947.b56b79b1.js" defer></script><script src="/elao_/pr/661/build/769.7dfbbe52.js" defer></script><script src="/elao_/pr/661/build/app.e47fd89c.js" defer></script>

                    

    <script src="https://platform.twitter.com/widgets.js"></script>
    <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

    <script>
        window.onload = (function(){
            var tweets = document.querySelectorAll('.tweet-container');
            tweets.forEach(function(tweet) {
                // https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/guides/embedded-tweet-parameter-reference
                twttr.widgets.createTweet(tweet.getAttribute('data-tweet-id'), tweet, {
                    conversation: 'none',
                    cards: 'hidden',
                    theme: 'light',
                    lang: 'fr',
                    align: 'center',
                    width: 550, // default
                    dnt: true,
                })
            })
        });
    </script>

        <!-- S.E.E. -->
        <meta name="see" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;661&#x5C;&#x2F;build&#x5C;&#x2F;see.80fe75b7.js&quot;&#x5D;">
        <meta name="see_style" content="&#x5B;&quot;&#x5C;&#x2F;elao_&#x5C;&#x2F;pr&#x5C;&#x2F;661&#x5C;&#x2F;build&#x5C;&#x2F;see.d77e78f8.css&quot;&#x5D;">
    </head>
    <body
        data-controller="swup-plugins symfony--ux-swup--swup swup-matomo" data-symfony--ux-swup--swup-containers-value="&#x5B;&quot;&#x23;main&quot;,&quot;&#x23;nav&quot;&#x5D;" data-symfony--ux-swup--swup-cache-value="true" data-symfony--ux-swup--swup-animate-history-browsing-value="true" data-symfony--ux-swup--swup-debug-value="false" data-symfony--ux-swup--swup-link-selector-value="a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;661&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;661&#x2F;_profiler&quot;&#x5D;&#x29;,a&#x5B;href&#x5E;&#x3D;&quot;&#x2F;&quot;&#x5D;&#x3A;not&#x28;&#x5B;data-no-swup&#x5D;&#x29;&#x3A;not&#x28;&#x5B;target&#x3D;&quot;_blank&quot;&#x5D;&#x29;&#x3A;not&#x28;a&#x5B;href&#x5E;&#x3D;&quot;https&#x3A;&#x2F;&#x2F;elao.github.io&#x2F;elao_&#x2F;pr&#x2F;661&#x2F;_profiler&quot;&#x5D;&#x29;" data-swup-matomo-enabled-value="false">
                    <header id="nav" class="header">
                <div class="container">
                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/661/">
                        <span class="screen-reader">Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>

                                            <!-- Desktop nav -->
                        <nav class="nav">
                            <ul>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item nav__item--active">
                                        <a href="/elao_/pr/661/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav__item ">
                                        <a href="/elao_/pr/661/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                    
                                            <!-- Mobile nav -->
                        <nav class="nav-mobile" data-controller="toggle">
                            <div class="nav-mobile__header">
                                <a href="/elao_/pr/661/">
                                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                                </a>
                                <button class="nav-toggle nav-toggle--close">
                                    <i class="icon icon--close" aria-hidden="true"></i>
                                    <span class="screen-reader">Fermer le menu</span>
                                </button>
                            </div>
                            <ul>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/nos-services/">
                                                                                        <span>Services</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/demarche">
                                                                                        <span>Démarche</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/etudes-de-cas">
                                                                                        <span>Études de cas</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/nos-valeurs">
                                                                                        <span>Valeurs</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  ">
                                        <a href="/elao_/pr/661/equipe">
                                                                                        <span>L&#039;équipe</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item nav-mobile__item--active ">
                                        <a href="/elao_/pr/661/blog">
                                                                                        <span>Blog</span>
                                        </a>
                                    </li>
                                                                    <li class="nav-mobile__item  nav-mobile__item--large">
                                        <a href="/elao_/pr/661/contact">
                                                                                            <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                        <span>Contact</span>
                                        </a>
                                    </li>
                                                            </ul>
                        </nav>
                        <button class="nav-toggle nav-toggle--open">
                            <i class="icon icon--hamburger" aria-hidden="true"></i>
                            <span class="screen-reader">Ouvrir le menu</span>
                        </button>
                                    </div>
            </header>
                <main id="main">
                <div class="container">
                                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/661/">
                <span itemprop="name">Accueil</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/661/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/661/blog/dev">
                <span itemprop="name">Dev</span>
            </a>
            <meta itemprop="position" content="3" />
        </li>        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin</span>
            </a>
            <meta itemprop="position" content="4" />
        </li></ol>

        
        <div class="article-banner">
            <div
                class="article-banner__cover"
                style="background: #f1f1f1 url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/b70e8b2ed3aa256ba46a114a87cfe624.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/b70e8b2ed3aa256ba46a114a87cfe624.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/754148e2e330b5342fcc1c8d3dfe354b.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/b70e8b2ed3aa256ba46a114a87cfe624.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/754148e2e330b5342fcc1c8d3dfe354b.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/b70e8b2ed3aa256ba46a114a87cfe624.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/754148e2e330b5342fcc1c8d3dfe354b.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/b70e8b2ed3aa256ba46a114a87cfe624.jpg') 1x,
        url('/elao_/pr/661/%2E%2E/../resized/content/images/blog/thumbnails/toad.jpg/754148e2e330b5342fcc1c8d3dfe354b.jpg') 2x
    );"
                data-aos="fade-down"
            ></div>

            <div class="article-info" data-aos="zoom-in">
                                                    <div class="article-author ">
                        <div class="article-author__image">
                                                            <a href="/elao_/pr/661/blog/auteur/xavierr">
                                    <img     src="/elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/xavierr.jpg/401e4ebf653f048af7a31e583f17e399.jpg"
    srcset="
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/xavierr.jpg/401e4ebf653f048af7a31e583f17e399.jpg 1x,
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/xavierr.jpg/483510c48265ecfc9142de1a8a2bc614.jpg 2x
    "
 />
                                </a>
                                                    </div>
                        <span class="article-author__info">
                            Écrit par
                                                            <a href="/elao_/pr/661/blog/auteur/xavierr">
                                    <strong>Xavier R</strong>
                                </a>
                                                    </span>
                    </div>
                                <div class="article-info__date">
                    <span>Publication <strong>12 juillet 2010</strong></span>
                                                        </div>
            </div>

            <div class="article-header" data-aos="zoom-in-up">
                <h1>Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin</h1>
                <p>Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin.</p>
                <ul class="article-tag-list">
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/661/blog/tag/developpement" rel="nofollow">#Developpement</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/661/blog/tag/php" rel="nofollow">#Php</a>
                        </li>
                                            <li class="article-tag-list__item">
                            <a href="/elao_/pr/661/blog/tag/symfony" rel="nofollow">#Symfony</a>
                        </li>
                                    </ul>
            </div>
        </div>

        
        <div class="article-content">
            <main class="article-content__main">

                
                
                <p>Bonjour,</p>
<p>Nous allons voir aujourd'hui comment installer et utiliser le plugin <a href="http://www.symfony-project.org/plugins/sfImageTransformExtraPlugin" target="_blank">sfImageTransformExtraPlugin</a>.</p>
<p>Il s'agit d'un plugin très puissant permettant d'appliquer des traitements à des images au moyen de fichiers de configuration, sans qu'il soit donc nécessaire de polluer le code métier. Par ailleurs, il permet d'appliquer plusieurs traitements successifs de manière très intuitive. Il gère lui-même l'emplacement des fichiers générés et propose un système de cache réduisant les délais de transmission des images déjà générées.</p>
<p>Le sfImageTransformExtraPlugin est dépendant du plugin <a href="http://www.symfony-project.org/plugins/sfImageTransformPlugin" target="_blank">sfImageTransformPlugin</a> mais ne l'installez pas avant d'avoir lu la suite ! Pour faciliter la lecture et éviter toute confusion (les noms des deux plugins sont très proches), dans la suite de l'article je ferai référence au "plugin de base" pour sfImageTransformPlugin et au "plugin Extra" pour sfImageTransformExtraPlugin.</p>
<p>L'outil est donc très puissant mais sa documentation contient de nombreuses zones d'ombre qui ne facilitent absolument pas sa prise en main. Et les ennuis commencent dès l'installation ! D'où l'intérêt de cet article.</p>
<h3 id="l-installation-des-plugins-ou-le-debut-des-emm-de-nos-demarches" class="anchor-title"><del>des emm...</del> de nos démarches<a href="#l-installation-des-plugins-ou-le-debut-des-emm-de-nos-demarches">L'installation des plugins ou le début </a></h3>
<blockquote>
<p>Le plugin sfImageTransformPlugin nécessite que GD ou ImageMagick soit installé sur votre machine.</p>
</blockquote>
<p>En effet, au moment de la rédaction de ce billet, la version courante du plugin "Extra" est la version 1.0.5 qui requiert la version 1.3.0 ou 1.3.1 du plugin sfImageTransformPlugin. Or, la version courante de ce dernier est 1.4.0, mais elle est incompatible avec la dernière version du plugin "Extra". Si bien que si vous essayez d'installer le plugin "Extra" via la ligne de commande <strong>plugin:install</strong>, l'opération échouera car elle installera préalablement la dernière version de sfImageTransformPlugin, donc une version incompatible ! Vous me suivez ? Oui, je sais que ces histoires de versions ne sont pas passionnantes mais si vous souhaitez utiliser sfImageTransformExtraPlugin (et nous le recommandons !), mieux vaut être au courant de ces incompatibilités. Voici donc la démarche que nous préconisons :</p>
<p>Installer le plugin de base (sfImageTransformPlugin) en ligne de commande en prenant soin de préciser la version souhaitée :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="a2a1a41669c96bf1c66b55da2edf8839">./symfony plugin:install <span class="token parameter variable">--release</span><span class="token operator">=</span><span class="token number">1.3</span>.1 sfImageTransformPlugin</code></pre>
<p>Pour le plugin "Extra", il faut l'installer manuellement. Pour cela :</p>
<ul>
<li>
<p>rendez-vous sur <a title="Télécharger le plugin sfImageTransformExtraPlugin" href="http://www.symfony-project.org/plugins/sfImageTransformExtraPlugin" target="_blank">la page dédiée au plugin</a> et cliquez sur le lien "Download Package"</p>
</li>
<li>
<p>décompressez le contenu de l'archive dans un répertoire temporaire</p>
</li>
<li>
<p>copiez le répertoire "sfImageTransformExtraPlugin-1.0.5″ (la racine de l'archive est un répertoire qui s'appelle "sfImageTransformExtraPlugin-1.0.5″, et il contient lui-même un sous-répertoire qui porte également ce nom ; c'est le sous-répertoire qu'il faut copier et non pas la racine de l'archive) dans le répertoire "plugins" de votre projet Symfony</p>
</li>
<li>
<p>renommez ce répertoire en "plugins/sfImageTransformExtraPlugin" (<strong>ie</strong>, supprimer le tiret et le numéro de version)</p>
</li>
</ul>
<p>Enfin, un article consacré à Symfony qui ne contient pas une instruction <strong>symfony cc</strong> n'est pas digne de ce nom ! Donc :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="1421d703cdd03b206c978bd5f02366c6">./symfony cc</code></pre>
<blockquote>
<p>A ce stade des opérations, nous n'activons pas encore le plugin "Extra". La configuration du plugin se fera plus tard car pour l'heure, nous allons tester le plugin sfImageTransformPlugin. Nous nous soucierons du plugin "Extra" plus tard.</p>
</blockquote>
<h3 id="a-present-essayons-le-plugin-de-base" class="anchor-title"><a href="#a-present-essayons-le-plugin-de-base">A présent, essayons le plugin de base</a></h3>
<p>Nous allons nous assurer dans un premier temps que le plugin de base (sfImageTransformPlugin) est correctement installé et configuré. Pour cela, nous allons créer une page très simple, avec un bouton déclenchant un traitement sur une image de notre choix. Commençons par créer un module "image" dans l'application "Frontend".</p>
<p>Si elle n'existe pas encore, on crée l'application "Frontend" ...</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="202d18af4f857ffd6327defcd8023c88">./symfony generate:app frontend</code></pre>
<p>... puis le module :</p>
<pre class="code-multiline language-bash"><code class="language-bash" id="f183522c0665e16e06613c18ebe45a3b">./symfony generate:module frontend image</code></pre>
<p>Pour notre démonstration, j'ai choisi cette image, partant du principe qu'un prosélytisme de bon aloi ne saurait nuire à la carrière d'un développeur :</p>
<img src="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2010/zf.jpg/4bfe2c196940cd0475e79ee39e740a22.jpg" alt="Installation et premier pas avec le plugin sfImageTransformExtraPlugin" title="Installation et premier pas avec le plugin sfImageTransformExtraPlugin" srcset="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2010/zf.jpg/4bfe2c196940cd0475e79ee39e740a22.jpg 1x,
/elao_/pr/661/%2E%2E/../resized/content/images/blog/2010/zf.jpg/b0c43b4789e58fecd2598f245abe845e.jpg 2x," id="installation-et-premier-pas-avec-le-plugin-sfimagetransformextraplugin">
<p>J'ai nommé cette image zf.jpg et je l'ai placée dans le répertoire web/images de notre projet.</p>
<p>Nous allons dans un premier temps écrire le code de notre template pour y insérer le formulaire par lequel nous allons appeler la transformation de notre image :</p>
<pre class="code-multiline language-html"><code class="language-html" id="b32635f01676b3af1e5d6d0cfd7c2942"># apps/frontend/modules/image/templates/indexSuccess.php
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Image Transform &amp; Extra plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">400</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token color">lightgrey</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token unit">px</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content/images/zf.jpg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Transform image !<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>Comme nous venons juste de créer le module, pensez à supprimer le code par défaut de la méthode executeIndex du fichier <code class="code-inline" id="af2f8d23a83286b4b84675fedb15eb0d">apps/frontend/modules/actions/actions.class.php</code>. Affichons à présent la page dans notre navigateur : <a href="http://mon_hote_virtuel/frontend_dev.php/image" target="_blank">http://mon_hote_virtuel/frontend_dev.php/image</a>. Le résultat est admirable ... je ne m'en lasse pas ...</p>
<img src="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2010/sfImageTransformExtrePlugin.png/9a83dc12844a9c3965e189a83e452f8a.png" alt="indexSuccess.php Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin" title="indexSuccess.php Installation et premiers pas avec le plugin Symfony sfImageTransformExtraPlugin" srcset="/elao_/pr/661/%2E%2E/../resized/content/images/blog/2010/sfImageTransformExtrePlugin.png/9a83dc12844a9c3965e189a83e452f8a.png 1x,
/elao_/pr/661/%2E%2E/../resized/content/images/blog/2010/sfImageTransformExtrePlugin.png/3b8d2b60bcba415e7934846b258639c8.png 2x," id="indexsuccess-php-installation-et-premiers-pas-avec-le-plugin-symfony-sfimagetransformextraplugin">
<p>Cela étant, notre but étant d'utiliser dans un premier temps le plugin sfImageTransformPlugin, nous allons écrire une méthode sans prétention qui va appliquer un traitement à cette image lorsque nous soumettons le formulaire. Pour cela, nous allons modifier le fichier actions.class.php afin de mettre à jour la méthode executeIndex :</p>
<pre class="code-multiline language-php"><code class="language-php" id="77260ecbc1738808bd892e8a548b26ac"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment"># apps/frontend/modules/image/actions/actions.class.php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">imageActions</span> <span class="token keyword">extends</span> <span class="token class-name">sfActions</span>
<span class="token punctuation">{</span>
 <span class="token doc-comment comment">/**
  * Executes index action
  *
  * <span class="token keyword">@param</span> <span class="token class-name">sfRequest</span> <span class="token parameter">$request</span> A request object
  */</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">executeIndex</span><span class="token punctuation">(</span><span class="token class-name type-declaration">sfWebRequest</span> <span class="token variable">$request</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token scope">sfRequest<span class="token punctuation">::</span></span><span class="token constant">POST</span> <span class="token operator">==</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token scope">sfConfig<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sf_web_dir'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token constant">DIRECTORY_SEPARATOR</span><span class="token operator">.</span><span class="token string single-quoted-string">'images'</span><span class="token operator">.</span><span class="token constant">DIRECTORY_SEPARATOR</span><span class="token operator">.</span><span class="token string single-quoted-string">'zf.jpg'</span> <span class="token punctuation">;</span>
      <span class="token variable">$img</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sfImage</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'image/jpg'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
      <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token operator">-&gt;</span><span class="token function">getMIMEType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$img</span><span class="token operator">-&gt;</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
      <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token scope">sfView<span class="token punctuation">::</span></span><span class="token constant">NONE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Rien de très compliqué, à la soumission du formulaire, nous créons une miniature de notre image d'origine (dimension 100 px) et nous l'affichons dans le navigateur. Cette méthode n'est pas d'un grand intérêt, je l'avoue ; elle a pour seule but de s'assurer que nous avons correctement configuré le plugin de base. A présent, attaquons-nous au plat de résistance :</p>
<h3 id="la-bete-le-plugin-extra" class="anchor-title"><a href="#la-bete-le-plugin-extra">La bête : le plugin "Extra"</a></h3>
<p>Nous allons commencer par activer le plugin :</p>
<pre class="code-multiline language-php"><code class="language-php" id="157bf895e34455b629fcad39f2386bc0"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// ...</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">ProjectConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">sfProjectConfiguration</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">enablePlugins</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sfDoctrinePlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">enablePlugins</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sfImageTransformPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">enablePlugins</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sfImageTransformExtraPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Le point d'entrée du plugin "Extra" se trouve dans un module que nous allons activer :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="a72d2bbbc6a34d2bc580163c99ec6560"><span class="token comment"># apps/frontend/config/settings.yml</span>
<span class="token key atrule">all</span><span class="token punctuation">:</span>
  <span class="token key atrule">.settings</span><span class="token punctuation">:</span>
    <span class="token comment"># ....</span>
   <span class="token key atrule">enabled_modules</span><span class="token punctuation">:</span>        <span class="token punctuation">[</span> sfImageTransformator <span class="token punctuation">]</span></code></pre>
<p>Pour faire fonctionner le plugin, il est nécessaire d'activer la détection automatique du tyme MIME. Cela se fait dans le fichier app.yml de l'application :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="4ee3e54c8fa4354f1192acad63c8566d"><span class="token comment"># apps/frontend/config/app.yml</span>
<span class="token key atrule">all</span><span class="token punctuation">:</span>
  <span class="token key atrule">sfImageTransformPlugin</span><span class="token punctuation">:</span>
    <span class="token key atrule">mime_type</span><span class="token punctuation">:</span>
      <span class="token key atrule">auto_detect</span><span class="token punctuation">:</span>  <span class="token boolean important">true</span>
      <span class="token key atrule">library</span><span class="token punctuation">:</span>      gd_mime_type <span class="token comment">#  gd_mime_type (GD), Fileinfo (PECL), MIME_Type (PEAR)</span>
   <span class="token key atrule">font_dir</span><span class="token punctuation">:</span>       %SF_PLUGINS_DIR%/sfImageTransformExtraPlugin/data/example<span class="token punctuation">-</span>resources/fonts</code></pre>
<p>Les routes par défaut du plugin "Extra" sont configurées avec l'URL relative /thumbnails/.. pour générer et/ou afficher les miniatures générées. Pour qu'elles fonctionnent, nous devons créer un répertoire "thumbnails" dans le répertoire "web" et nous assurer que le serveur possède les droits en écriture sur ce répertoire. Dans la console, en nous plaçant sous la racine du projet, nous entrons donc les commandes suivantes :</p>
<pre class="code-multiline"><code id="7630ea85729f9e4b072a82acc6e09c1f">mkdir web/thumbnails
chmod 777 web/thumbnails</code></pre>
<p>Comme cela fait un long moment que nous n'avons pas tapé un <strong>symfony cc</strong>, il est temps d'y remédier :</p>
<pre class="code-multiline"><code id="1421d703cdd03b206c978bd5f02366c6">./symfony cc</code></pre>
<p>Bon, nous avons passé un bon moment à préparer le terrain mais force est de constater que nous n'avons pas été très productifs jusqu'à présent. Il est donc temps d'exploiter ce plugin ! Mais avant toute chose, quelques remarques utiles. Je vous invite dans un premier temps à recharger la page où nous affichons le formulaire et à consulter les informations qui figurent dans la Web Debug Toolbar. Sélectionnez-y l'onglet "config" et affichez le contenu du sous-menu "Settings". Vous noterez tout en bas de la liste, après les constantes app<em>* et sf</em>*, la présence d'une constante nommée "thumbnailing_formats" :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="0646b6245ccafa21bc9dd65e77a65660"><span class="token key atrule">thumbnailing_formats</span><span class="token punctuation">:</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">quality</span><span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token key atrule">mime_type</span><span class="token punctuation">:</span> image/gif<span class="token punctuation">,</span> <span class="token key atrule">transformations</span><span class="token punctuation">:</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
  <span class="token key atrule">original</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">quality</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token key atrule">mime_type</span><span class="token punctuation">:</span> image/jpg<span class="token punctuation">,</span> <span class="token key atrule">transformations</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre>
<p>Mais que sont ces "thumbnailing_formats" et où sont-ils définis exactement ? Pour répondre à la seconde question, ces formats sont définis dans le fichier plugins/sfImageTransformExtraPlugin/thumbnailing.yml et voici son contenu :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="6016038db29833751c36d2ffb5c1265c"><span class="token comment"># plugins/sfImageTransformExtraPlugin/thumbnailing.yml</span>
<span class="token key atrule">all</span><span class="token punctuation">:</span>
  <span class="token key atrule">.settings</span><span class="token punctuation">:</span>
    <span class="token key atrule">formats</span><span class="token punctuation">:</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token comment"># --- // 404 image</span>
     <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">quality</span><span class="token punctuation">:</span>                    <span class="token number">25</span>
        <span class="token key atrule">mime_type</span><span class="token punctuation">:</span>                  image/gif
        <span class="token key atrule">transformations</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">adapter</span><span class="token punctuation">:</span> GD<span class="token punctuation">,</span> <span class="token key atrule">transformation</span><span class="token punctuation">:</span> create<span class="token punctuation">,</span> <span class="token key atrule">param</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">x</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token key atrule">y</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">adapter</span><span class="token punctuation">:</span> GD<span class="token punctuation">,</span> <span class="token key atrule">transformation</span><span class="token punctuation">:</span> text<span class="token punctuation">,</span>   <span class="token key atrule">param</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">'404'</span><span class="token punctuation">,</span> <span class="token key atrule">x</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token key atrule">y</span><span class="token punctuation">:</span>  <span class="token number">50</span><span class="token punctuation">,</span> <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token key atrule">font</span><span class="token punctuation">:</span> accid___<span class="token punctuation">,</span> <span class="token key atrule">color</span><span class="token punctuation">:</span> <span class="token string">'#FF0000'</span><span class="token punctuation">,</span> <span class="token key atrule">angle</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">adapter</span><span class="token punctuation">:</span> GD<span class="token punctuation">,</span> <span class="token key atrule">transformation</span><span class="token punctuation">:</span> text<span class="token punctuation">,</span>   <span class="token key atrule">param</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">'Image could not be found'</span><span class="token punctuation">,</span> <span class="token key atrule">x</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token key atrule">y</span><span class="token punctuation">:</span>  <span class="token number">120</span><span class="token punctuation">,</span> <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token key atrule">font</span><span class="token punctuation">:</span> accid___<span class="token punctuation">,</span> <span class="token key atrule">color</span><span class="token punctuation">:</span> <span class="token string">'#FF0000'</span><span class="token punctuation">,</span> <span class="token key atrule">angle</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token comment"># --- // original image. no transformation</span>
     <span class="token key atrule">original</span><span class="token punctuation">:</span>
        <span class="token key atrule">quality</span><span class="token punctuation">:</span>                    <span class="token number">100</span>
        <span class="token key atrule">mime_type</span><span class="token punctuation">:</span>                  image/jpg
        <span class="token key atrule">transformations</span><span class="token punctuation">:</span>            <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre>
<p>Comme je le disais en préambule, le plugin “Extra” va nous permettre d’appliquer plusieurs traitements successifs sur une image, sans que nous ayons à écrire du code PHP, grâce à des fichiers de configuration. Et c’est dans ce fichier qui occupe une place centrale dans le fonctionnement et l’exploitation du plugin que l’on détermine cette configuration. Noter au passage que la documentation du plugin y fait référence de manière extrêmement maladroite et ambigüe. Ainsi, en analysant ce fichier, nous constatons que le format “default” est prévu pour générer un format de sortie de type “image/gif” ; il crée (create) une nouvelle image de 250 * 200 pixels, lui ajoute le texte ‘404‘, puis le texte ‘Image could not be found‘. Ces transformations successives sont décrites dans l’entrée “transformations” du fichier yaml.</p>
<p>Nous allons à présent copier ce fichier dans le répertoire “config” de notre application et l’adapter pour créer nos propres formats :</p>
<pre class="code-multiline"><code id="4f0f3f328a342043159231b020d66af0">cp plugins/sfImageTransformExtraPlugin/thumbnailing.yml apps/frontend/config/thumbnailing.yml</code></pre>
<p>Modifions le fichier que nous venons de copier afin d’appliquer à une image originale des transformations plus visibles. Pour cela, remplaçons le contenu du fichier :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="59759ad165afe1d8680c19fec06c652e"><span class="token comment"># apps/frontend/config/thumbnailing.yml</span>
<span class="token key atrule">all</span><span class="token punctuation">:</span>
  <span class="token key atrule">.settings</span><span class="token punctuation">:</span>
    <span class="token key atrule">formats</span><span class="token punctuation">:</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>

      <span class="token key atrule">mon_format_1</span><span class="token punctuation">:</span>
        <span class="token key atrule">quality</span><span class="token punctuation">:</span>               <span class="token number">25</span>
        <span class="token key atrule">mime_type</span><span class="token punctuation">:</span>             image/png
        <span class="token key atrule">transformations</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">adapter</span><span class="token punctuation">:</span> GD<span class="token punctuation">,</span> <span class="token key atrule">transformation</span><span class="token punctuation">:</span> crop<span class="token punctuation">,</span> <span class="token key atrule">param</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">left</span><span class="token punctuation">:</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token key atrule">top</span><span class="token punctuation">:</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token key atrule">width</span><span class="token punctuation">:</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token key atrule">height</span><span class="token punctuation">:</span> <span class="token number">120</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">adapter</span><span class="token punctuation">:</span> GD<span class="token punctuation">,</span> <span class="token key atrule">transformation</span><span class="token punctuation">:</span> rotate<span class="token punctuation">,</span> <span class="token key atrule">param</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">angle</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token key atrule">background</span><span class="token punctuation">:</span> <span class="token string">"#FFFFFF"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">adapter</span><span class="token punctuation">:</span> GD<span class="token punctuation">,</span> <span class="token key atrule">transformation</span><span class="token punctuation">:</span> crop<span class="token punctuation">,</span> <span class="token key atrule">param</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">left</span><span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token key atrule">top</span><span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token key atrule">width</span><span class="token punctuation">:</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token key atrule">height</span><span class="token punctuation">:</span> <span class="token number">120</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>
<p>Si nous rechargeons notre page web et que nous consultons les “settings” de la Web Debug Toolbar, nous constatons que notre nouveau format est disponible. Nous allons donc appliquer ces transformations à notre image originale. Le plugin offre la possibilité de modifier une image située dans le répertoire public de l’application, une image distante disponible via le protocole http, ou bien une image située en base de données. Dans le cadre de notre exemple, nous allons transformer l’image de l’exemple précédent, que nous aurons placée dans le répertoire “web/uploads”.</p>
<blockquote>
<p>La documentation du plugin est très floue quant à la manière d’indiquer l’emplacement d’une image dans le répertoire public de notre application. En fait, les images doivent être stockées dans le répertoire web/uploads ou un de ses sous-répertoires, mais la documentation n’est absolument pas claire sur ce point (et sur bien d’autres !).</p>
</blockquote>
<p>Copions l’image du logo ZF dans le répertoire public :</p>
<pre class="code-multiline"><code id="47e75e8f4fe5799d2c0ca096cf08855f">cp web/images/zf.jpg web/uploads/zf.jpg</code></pre>
<p>Nous devons à présent déclarer une route pointant sur le module sfImageTransformator, chargé de transformer les images. Comme nous souhaitons modifier une image du répertoire public de l’application, nous précisons dans l’entrée “options” que l’image source est de type “File” :</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="cd5e8104981601f6784e452dd21ab0d3"><span class="token comment"># apps/frontend/config/routing.yml</span>
<span class="token key atrule">sf_image_file</span><span class="token punctuation">:</span>
  <span class="token key atrule">class</span><span class="token punctuation">:</span> sfImageTransformRoute
  <span class="token key atrule">url</span><span class="token punctuation">:</span>  /thumbnails/<span class="token punctuation">:</span>format/<span class="token punctuation">:</span>filepath.<span class="token punctuation">:</span>sf_format
  <span class="token key atrule">param</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">module</span><span class="token punctuation">:</span> sfImageTransformator<span class="token punctuation">,</span> <span class="token key atrule">action</span><span class="token punctuation">:</span> index <span class="token punctuation">}</span>
  <span class="token key atrule">requirements</span><span class="token punctuation">:</span>
    <span class="token key atrule">format</span><span class="token punctuation">:</span>   <span class="token string">"[\w_-]+"</span>
    <span class="token key atrule">filepath</span><span class="token punctuation">:</span> <span class="token string">"[\w/_.]+"</span>
    <span class="token key atrule">sf_format</span><span class="token punctuation">:</span> <span class="token string">"gif|png|jpg"</span>
    <span class="token key atrule">sf_method</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> get <span class="token punctuation">]</span>
  <span class="token key atrule">options</span><span class="token punctuation">:</span>
    <span class="token key atrule">image_source</span><span class="token punctuation">:</span> File</code></pre>
<p>Et pour finir, nous allons ajouter dans la template indexSuccess.php le lien permettant d’invoquer la transformation de notre image et d’afficher le résultat.</p>
<pre class="code-multiline language-php"><code class="language-php" id="ba5b9d350943da158ad8588a9c85025b"># apps/frontend/modules/image/templates/indexSuccess.php
// ..... affichage du formulaire -- aucun changement
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">image_tag</span><span class="token punctuation">(</span><span class="token function">url_for</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sf_image_file"</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"format"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"mon_format_1"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"filepath"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"zf.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<blockquote>
<p>Le filepath est relatif au répertoire “uploads”. Ainsi, si l’image se trouvait par exemple dans le répertoire web/uploads/mes_fichiers, nous aurions indiqué le filepath de cette manière :
"filepath" =&gt; "mes_fichiers/zf.jpg"</p>
</blockquote>
<p>Si l’on recharge notre page web, le résultat des transformations s’affiche alors sous notre formulaire. Voici le code HTML de la balise image générée par le plugin :</p>
<pre class="code-multiline"><code id="3a12e403c27fa2acbec213cb5159bb49">&lt;img src="/frontend_dev.php/thumbnails/mon_format_1/zf.jpg.png"/&gt;</code></pre>
<p>Cela correspond exactement au pattern de la route que nous avons déclarée précédemment.</p>
<blockquote>
<p>Si l’image ne s’affiche pas, n’hésitez pas à consulter les logs de Symfony ou d’Apache. A titre d’exemple, à mesure que j’écrivais cet article, je développais l’exemple en parallèle sur un poste informatique plutôt “obsolète” et il s’est avéré que ma librairie graphique GD ne me permettait pas d’appliquer des rotations. Résultat sans appel dans le fichier de log de Symfony :</p>
<p>[err] {sfImageTransformException} Cannot perform transform: sfImageRotateGD. Your install of GD does not support imagerotate</p>
</blockquote>
<h3 id="conclusion-provisoire" class="anchor-title"><a href="#conclusion-provisoire">Conclusion (provisoire)</a></h3>
<p>Cet article est beaucoup plus long que ce à quoi je m’attendais et pourtant nous n’avons fait qu’effleurer le sujet, tant sont vastes les possibilités offertes par le plugin. sfImageTransformExtraPlugin est indéniablement un outil qui mérite que l’on s’y intéresse mais sa prise en main est assez délicate, en raison notamment d’une documentation que je juge assez approximative (ce qui est tout de même compréhensible, c’est un peu le revers de la médaille : plus un outil est riche, plus la mise à jour de la documentation est problématique). Cet article n’avait donc pas d’autre prétention que de vous initier à ce plugin et vous mettre le pied à l’étrier en évitant les premiers écueils.</p>
<h3 id="remerciements" class="anchor-title"><a href="#remerciements">Remerciements</a></h3>
<p>Je tiens à remercier chaleureusement Yves Heitz sans qui la rédaction de ce billet n’aurait pas été possible. Il a essuyé les plâtres en mettant en oeuvre le plugin sur un projet réel et il a su contourner les nombreux écueils auxquels on se heurte lorsque l’on souhaite utiliser le plugin.</p>
                                                                </main>
            <aside class="article-content__aside">
                            </aside>
        </div>

        <div class="article-footer" data-aos="fade-in">
                                                <div class="article-author">
                        <div class="article-author__image">
                            <a href="/elao_/pr/661/blog/auteur/xavierr">
                                <img     src="/elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/xavierr.jpg/401e4ebf653f048af7a31e583f17e399.jpg"
    srcset="
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/xavierr.jpg/401e4ebf653f048af7a31e583f17e399.jpg 1x,
        /elao_/pr/661/%2E%2E/../resized/content/images/members/avatars/xavierr.jpg/483510c48265ecfc9142de1a8a2bc614.jpg 2x
    "
 />
                            </a>
                        </div>
                        <span class="article-author__info">
                            Écrit par
                            <a href="/elao_/pr/661/blog/auteur/xavierr">
                                <strong>Xavier R</strong>
                            </a>
                        </span>

                        <div class="article-author__social">
                                                                                                                    <a
                                    href="https://github.com/xavier-rdo"
                                    target="_blank"
                                    rel="noreferrer"
                                    class="social social--small"
                                >
                                    <i class="icon icon--github" aria-hidden="true"></i>
                                    <span class="screen-reader">Compte github de Xavier R</span>
                                </a>
                                                                                </div>
                    </div>
                                    </div>

                <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/fix/carrire-social-links/content/blog/dev/installation-et-premiers-pas-avec-le-plugin-symfony-sfimagetransformextraplugin.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </div>
        </main>
                    
<footer class="footer">
    <div class="container">
        <section class="footer__links">
            <p class="h1">
                elao
                <span>développe</span>
                <span>du lien</span>
            </p>
            <div class="links">
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/661/nos-services/" >Services</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/demarche" >Démarche</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/etudes-de-cas" >Études de cas</a>
                            </li>
                                            </ul>
                                    <ul>
                                                    <li>
                                <a href="/elao_/pr/661/nos-valeurs" >Valeurs</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/equipe" >L&#039;équipe</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/blog" >Blog</a>
                            </li>
                                                    <li>
                                <a href="/elao_/pr/661/blog/rss.xml"  data-no-swup="data-no-swup">RSS</a>
                            </li>
                                            </ul>
                                <ul>
                    <li>
                        <a href="/elao_/pr/661/carriere">Page Carrière</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/661/glossaire/">Glossaire 🧐</a>
                    </li>
                    <li>
                        <a href="/elao_/pr/661/elaomojis">Elaomojis 🎉</a>
                    </li>
                </ul>
            </div>
            <div class="socials">
                <ul>
                    <li>
                        <a href="https://www.linkedin.com/company/elao/" target="_blank">
                            <i class="icon icon--linkedin"></i>
                            Linkedin
                        </a>
                    </li>
                    <li>
                        <a href="https://bsky.app/profile/elao.com" target="_blank">
                            <i class="icon icon--bluesky"></i>
                            Bluesky
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/elao" target="_blank">
                            <i class="icon icon--x"></i>
                            X
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/elao" target="_blank">
                            <i class="icon icon--github"></i>
                            Github
                        </a>
                    </li>
                </ul>
            </div>
            <div class="contacts">
                <ul>
                    <li>
                        <a href="/elao_/pr/661/contact">Contact</a>
                    </li>
                    <li>
                        <a href="tel:04 82 53 37 19">04 82 53 37 19</a>
                    </li>
                    <li>
                        <a href="mailto:contact@elao.com">contact@elao.com</a>
                    </li>
                    <li>34 rue Jean Broquin</li>
                    <li>69006 Lyon</li>
                </ul>
            </div>
        </section>

        <section class="footer__legals">
            <span>© 2005 - 2025 - ELAO - Tous droits réservés</span>
            <a href="/elao_/pr/661/legal">Mentions légales</a>
            <a href="/elao_/pr/661/confidentialite">Protection des données</a>
            <a id="see" href="#ssss">🐍</a>
        </section>
    </div>
</footer>

            </body>
</html>
